<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Sst-commit-watch] r561 - trunk/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/sst-commit-watch/2006-September/index.html" >
   <LINK REL="made" HREF="mailto:sst-commit-watch%40lists.berlios.de?Subject=Re%3A%20%5BSst-commit-watch%5D%20r561%20-%20trunk/src&In-Reply-To=%3C200609142042.k8EKgSNv025348%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000027.html">
   <LINK REL="Next"  HREF="000028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Sst-commit-watch] r561 - trunk/src</H1>
    <B>esr at BerliOS</B> 
    <A HREF="mailto:sst-commit-watch%40lists.berlios.de?Subject=Re%3A%20%5BSst-commit-watch%5D%20r561%20-%20trunk/src&In-Reply-To=%3C200609142042.k8EKgSNv025348%40sheep.berlios.de%3E"
       TITLE="[Sst-commit-watch] r561 - trunk/src">esr at mail.berlios.de
       </A><BR>
    <I>Thu Sep 14 22:42:28 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000027.html">[Sst-commit-watch] r560 - trunk/src
</A></li>
        <LI>Next message: <A HREF="000028.html">[Sst-commit-watch] r562 - trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29">[ date ]</a>
              <a href="thread.html#29">[ thread ]</a>
              <a href="subject.html#29">[ subject ]</a>
              <a href="author.html#29">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: esr
Date: 2006-09-14 22:42:27 +0200 (Thu, 14 Sep 2006)
New Revision: 561

Modified:
   trunk/src/Makefile.am
   trunk/src/Makefile.in
   trunk/src/ai.c
   trunk/src/battle.c
   trunk/src/events.c
   trunk/src/finish.c
   trunk/src/io.c
   trunk/src/moving.c
   trunk/src/planets.c
   trunk/src/reports.c
   trunk/src/setup.c
   trunk/src/sst.c
   trunk/src/sst.h
   trunk/src/xio.c
Log:
Eliminate nasty macro holdovers.  All game structure members are now referred
to by full name,

Also, one more minor step in making xio work.


Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/Makefile.am	2006-09-14 20:42:27 UTC (rev 561)
@@ -19,3 +19,7 @@
 EXTRA_DIST = \
 	sst.h \
 	sstlinux.h
+
+# Experimental XaW code, not yet integrated with the game
+xio: xio.o
+	gcc xio.c -lXaw3d -o xio

Modified: trunk/src/Makefile.in
===================================================================
--- trunk/src/Makefile.in	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/Makefile.in	2006-09-14 20:42:27 UTC (rev 561)
@@ -467,6 +467,10 @@
 	tags uninstall uninstall-am uninstall-binPROGRAMS \
 	uninstall-info-am
 
+
+# Experimental XaW code, not yet integrated with the game
+xio: xio.o
+	gcc xio.c -lXaw3d -o xio
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
 .NOEXPORT:

Modified: trunk/src/ai.c
===================================================================
--- trunk/src/ai.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/ai.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -4,8 +4,8 @@
 {
     int iqx, iqy, l;
 
-    iqx = quadx+(lookx+(QUADSIZE-1))/QUADSIZE - 1;
-    iqy = quady+(looky+(QUADSIZE-1))/QUADSIZE - 1;
+    iqx = game.quadx+(lookx+(QUADSIZE-1))/QUADSIZE - 1;
+    iqy = game.quady+(looky+(QUADSIZE-1))/QUADSIZE - 1;
     if (!VALID_QUADRANT(iqx,iqy) ||
 	game.state.galaxy[iqx][iqy].supernova ||
 	game.state.galaxy[iqx][iqy].klingons &gt; 8)
@@ -17,7 +17,7 @@
 	    for_commanders(l)
 		if (game.state.cx[l]==iqx &amp;&amp; game.state.cy[l]==iqy) return 0;
 	    /* refuse to leave if currently attacking starbase */
-	    if (batx==quadx &amp;&amp; baty==quady) return 0;
+	    if (game.batx==game.quadx &amp;&amp; game.baty==game.quady) return 0;
 	}
 	/* don't leave if over 1000 units of energy */
 	if (game.kpower[loccom] &gt; 1000.) return 0;
@@ -25,29 +25,29 @@
     /* print escape message and move out of quadrant.
        We know this if either short or long range sensors are working */
     if (game.damage[DSRSENS] == 0.0 || game.damage[DLRSENS] == 0.0 ||
-	condit == IHDOCKED) {
+	game.condit == IHDOCKED) {
 	crmena(1, ienm, 2, game.kx[loccom], game.ky[loccom]);
 	prout(&quot; escapes to %s (and regains strength).&quot;,
 	      cramlc(quadrant, iqx, iqy));
     }
     /* handle local matters related to escape */
     game.quad[game.kx[loccom]][game.ky[loccom]] = IHDOT;
-    game.kx[loccom] = game.kx[nenhere];
-    game.ky[loccom] = game.ky[nenhere];
-    game.kavgd[loccom] = game.kavgd[nenhere];
-    game.kpower[loccom] = game.kpower[nenhere];
-    game.kdist[loccom] = game.kdist[nenhere];
-    klhere--;
-    nenhere--;
-    if (condit != IHDOCKED) newcnd();
+    game.kx[loccom] = game.kx[game.nenhere];
+    game.ky[loccom] = game.ky[game.nenhere];
+    game.kavgd[loccom] = game.kavgd[game.nenhere];
+    game.kpower[loccom] = game.kpower[game.nenhere];
+    game.kdist[loccom] = game.kdist[game.nenhere];
+    game.klhere--;
+    game.nenhere--;
+    if (game.condit != IHDOCKED) newcnd();
     /* Handle global matters related to escape */
-    game.state.galaxy[quadx][quady].klingons--;
+    game.state.galaxy[game.quadx][game.quady].klingons--;
     game.state.galaxy[iqx][iqy].klingons++;
     if (ienm==IHS) {
-	ishere=0;
-	iscate=0;
-	ientesc=0;
-	isatb=0;
+	game.ishere=0;
+	game.iscate=0;
+	game.ientesc=0;
+	game.isatb=0;
 	game.future[FSCMOVE]=0.2777+game.state.date;
 	game.future[FSCDBAS]=FOREVER;
 	game.state.isx=iqx;
@@ -55,13 +55,13 @@
     }
     else {
 	for_commanders(l) {
-	    if (game.state.cx[l]==quadx &amp;&amp; game.state.cy[l]==quady) {
+	    if (game.state.cx[l]==game.quadx &amp;&amp; game.state.cy[l]==game.quady) {
 		game.state.cx[l]=iqx;
 		game.state.cy[l]=iqy;
 		break;
 	    }
 	}
-	comhere = 0;
+	game.comhere = 0;
     }
     return 1; /* success */
 }
@@ -74,10 +74,10 @@
     int krawlx, krawly;
     int success;
     int attempts;
-    /* This should probably be just comhere + ishere */
-    int nbaddys = skill &gt;= SKILL_EXPERT ?
-	(int)((comhere*2 + ishere*2+klhere*1.23+irhere*1.5)/2.0):
-	(comhere + ishere);
+    /* This should probably be just game.comhere + game.ishere */
+    int nbaddys = game.skill &gt;= SKILL_EXPERT ?
+	(int)((game.comhere*2 + game.ishere*2+game.klhere*1.23+game.irhere*1.5)/2.0):
+	(game.comhere + game.ishere);
     double dist1, forces;
 
     dist1 = game.kdist[loccom];
@@ -85,7 +85,7 @@
 
     /* If SC, check with spy to see if should hi-tail it */
     if (ienm==IHS &amp;&amp;
-	(game.kpower[loccom] &lt;= 500.0 || (condit==IHDOCKED &amp;&amp; game.damage[DPHOTON]==0))) {
+	(game.kpower[loccom] &lt;= 500.0 || (game.condit==IHDOCKED &amp;&amp; game.damage[DPHOTON]==0))) {
 	irun = 1;
 	motion = -QUADSIZE;
     }
@@ -123,39 +123,39 @@
  advantage with a 650 advantage being to hold ground, 800 to move forward
  1, 950 for two, 150 for back 4, etc. Variance of 100.
 
- If docked, is reduced by roughly 1.75*skill, generally forcing a
+ If docked, is reduced by roughly 1.75*game.skill, generally forcing a
  retreat, especially at high skill levels.
 
  *  Motion is limited to skill level, except for SC hi-tailing it out.
  */
 
-	forces = game.kpower[loccom]+100.0*nenhere+400*(nbaddys-1);
-	if (shldup==0) forces += 1000; /* Good for enemy if shield is down! */
+	forces = game.kpower[loccom]+100.0*game.nenhere+400*(nbaddys-1);
+	if (game.shldup==0) forces += 1000; /* Good for enemy if shield is down! */
 	if (game.damage[DPHASER] == 0.0 || game.damage[DPHOTON] == 0.0) {
 	    if (game.damage[DPHASER] != 0) /* phasers damaged */
 		forces += 300.0;
 	    else
-		forces -= 0.2*(energy - 2500.0);
+		forces -= 0.2*(game.energy - 2500.0);
 	    if (game.damage[DPHOTON] != 0) /* photon torpedoes damaged */
 		forces += 300.0;
 	    else
-		forces -= 50.0*torps;
+		forces -= 50.0*game.torps;
 	}
 	else {
 	    /* phasers and photon tubes both out! */
 	    forces += 1000.0;
 	}
 	motion = 0;
-	if (forces &lt;= 1000.0 &amp;&amp; condit != IHDOCKED) /* Typical situation */
+	if (forces &lt;= 1000.0 &amp;&amp; game.condit != IHDOCKED) /* Typical situation */
 	    motion = ((forces+200.0*Rand())/150.0) - 5.0;
 	else {
 	    if (forces &gt; 1000.0) /* Very strong -- move in for kill */
 		motion = (1.0-square(Rand()))*dist1 + 1.0;
-	    if (condit==IHDOCKED &amp;&amp; (game.options &amp; OPTION_BASE)) /* protected by base -- back off ! */
-		motion -= skill*(2.0-square(Rand()));
+	    if (game.condit==IHDOCKED &amp;&amp; (game.options &amp; OPTION_BASE)) /* protected by base -- back off ! */
+		motion -= game.skill*(2.0-square(Rand()));
 	}
 #ifdef DEBUG
-	if (idebug) {
+	if (game.idebug) {
 	    proutn(&quot;MOTION = %1.2f&quot;, motion);
 	    proutn(&quot;  FORCES = %1,2f&quot;, forces);
 	}
@@ -163,7 +163,7 @@
 	/* don't move if no motion */
 	if (motion==0) return;
 	/* Limit motion according to skill */
-	if (abs(motion) &gt; skill) motion = (motion &lt; 0) ? -skill : skill;
+	if (abs(motion) &gt; game.skill) motion = (motion &lt; 0) ? -game.skill : game.skill;
     }
     /* calculate preferred number of steps */
     nsteps = motion &lt; 0 ? -motion : motion;
@@ -171,15 +171,15 @@
     if (nsteps &gt; QUADSIZE) nsteps = QUADSIZE; /* This shouldn't be necessary */
     if (nsteps &lt; 1) nsteps = 1; /* This shouldn't be necessary */
 #ifdef DEBUG
-    if (idebug) {
+    if (game.idebug) {
 	prout(&quot;NSTEPS = %d&quot;, nsteps);
     }
 #endif
     /* Compute preferred values of delta X and Y */
-    mx = sectx - comx;
-    my = secty - comy;
+    mx = game.sectx - comx;
+    my = game.secty - comy;
     if (2.0 * abs(mx) &lt; abs(my)) mx = 0;
-    if (2.0 * abs(my) &lt; abs(sectx-comx)) my = 0;
+    if (2.0 * abs(my) &lt; abs(game.sectx-comx)) my = 0;
     if (mx != 0) mx = mx*motion &lt; 0 ? -1 : 1;
     if (my != 0) my = my*motion &lt; 0 ? -1 : 1;
     nextx = comx;
@@ -187,7 +187,7 @@
     /* main move loop */
     for (ll = 0; ll &lt; nsteps; ll++) {
 #ifdef DEBUG
-	if (idebug) {
+	if (game.idebug) {
 	    prout(&quot;%d&quot;, ll+1);
 	}
 #endif
@@ -215,7 +215,7 @@
 	    }
 	    else if ((game.options &amp; OPTION_RAMMING) &amp;&amp; game.quad[lookx][looky] != IHDOT) {
 		/* See if we should ram ship */
-		if (game.quad[lookx][looky] == ship &amp;&amp;
+		if (game.quad[lookx][looky] == game.ship &amp;&amp;
 		    (ienm == IHC || ienm == IHS)) {
 		    ram(1, ienm, comx, comy);
 		    return;
@@ -236,7 +236,7 @@
 	    nextx = lookx;
 	    nexty = looky;
 #ifdef DEBUG
-	    if (idebug) {
+	    if (game.idebug) {
 		prout(cramlc(neither, nextx, nexty));
 	    }
 #endif
@@ -251,8 +251,8 @@
 	game.kx[loccom] = nextx;
 	game.ky[loccom] = nexty;
 	game.kdist[loccom] = game.kavgd[loccom] =
-	    sqrt(square(sectx-nextx)+square(secty-nexty));
-	if (game.damage[DSRSENS] == 0 || condit == IHDOCKED) {
+	    sqrt(square(game.sectx-nextx)+square(game.secty-nexty));
+	if (game.damage[DSRSENS] == 0 || game.condit == IHDOCKED) {
 	    proutn(&quot;***&quot;);
 	    cramen(ienm);
 	    proutn(&quot; from %s&quot;, cramlc(2, comx, comy));
@@ -268,12 +268,12 @@
     int ix, iy, i;
 
 #ifdef DEBUG
-    if (idebug) prout(&quot;MOVCOM&quot;);
+    if (game.idebug) prout(&quot;MOVCOM&quot;);
 #endif
 
     /* Figure out which Klingon is the commander (or Supercommander)
        and do move */
-    if (comhere) 
+    if (game.comhere) 
 	for_local_enemies(i) {
 	    ix = game.kx[i];
 	    iy = game.ky[i];
@@ -282,7 +282,7 @@
 		break;
 	    }
 	}
-    if (ishere) 
+    if (game.ishere) 
 	for_local_enemies(i) {
 	    ix = game.kx[i];
 	    iy = game.ky[i];
@@ -294,7 +294,7 @@
     /* if skill level is high, move other Klingons and Romulans too!
        Move these last so they can base their actions on what the
        commander(s) do. */
-    if (skill &gt;= SKILL_EXPERT &amp;&amp; (game.options &amp; OPTION_MVBADDY)) 
+    if (game.skill &gt;= SKILL_EXPERT &amp;&amp; (game.options &amp; OPTION_MVBADDY)) 
 	for_local_enemies(i) {
 	    ix = game.kx[i];
 	    iy = game.ky[i];
@@ -309,7 +309,7 @@
 {
     int i;
 
-    if ((iqx==quadx &amp;&amp; iqy==quady) ||
+    if ((iqx==game.quadx &amp;&amp; iqy==game.quady) ||
 	!VALID_QUADRANT(iqx, iqy) ||
 	game.state.galaxy[iqx][iqy].supernova ||
 	game.state.galaxy[iqx][iqy].klingons &gt; 8) 
@@ -319,40 +319,40 @@
 	for_starbases(i)
 	    if (game.state.baseqx[i]==iqx &amp;&amp; game.state.baseqy[i]==iqy) return 1;
     }
-    if (justin &amp;&amp; !iscate) return 1;
+    if (game.justin &amp;&amp; !game.iscate) return 1;
     /* do the move */
     game.state.galaxy[game.state.isx][game.state.isy].klingons--;
     game.state.isx = iqx;
     game.state.isy = iqy;
     game.state.galaxy[game.state.isx][game.state.isy].klingons++;
-    if (ishere) {
+    if (game.ishere) {
 	/* SC has scooted, Remove him from current quadrant */
-	iscate=0;
-	isatb=0;
-	ishere=0;
-	ientesc=0;
+	game.iscate=0;
+	game.isatb=0;
+	game.ishere=0;
+	game.ientesc=0;
 	game.future[FSCDBAS]=FOREVER;
 	for_local_enemies(i) 
 	    if (game.quad[game.kx[i]][game.ky[i]] == IHS) break;
 	game.quad[game.kx[i]][game.ky[i]] = IHDOT;
-	game.kx[i] = game.kx[nenhere];
-	game.ky[i] = game.ky[nenhere];
-	game.kdist[i] = game.kdist[nenhere];
-	game.kavgd[i] = game.kavgd[nenhere];
-	game.kpower[i] = game.kpower[nenhere];
-	klhere--;
-	nenhere--;
-	if (condit!=IHDOCKED) newcnd();
+	game.kx[i] = game.kx[game.nenhere];
+	game.ky[i] = game.ky[game.nenhere];
+	game.kdist[i] = game.kdist[game.nenhere];
+	game.kavgd[i] = game.kavgd[game.nenhere];
+	game.kpower[i] = game.kpower[game.nenhere];
+	game.klhere--;
+	game.nenhere--;
+	if (game.condit!=IHDOCKED) newcnd();
 	sortkl();
     }
     /* check for a helpful planet */
-    for (i = 0; i &lt; inplan; i++) {
+    for (i = 0; i &lt; game.inplan; i++) {
 	if (game.state.plnets[i].x==game.state.isx &amp;&amp; game.state.plnets[i].y==game.state.isy &amp;&amp;
 	    game.state.plnets[i].crystals == 1) {
 	    /* destroy the planet */
 	    DESTROY(&amp;game.state.plnets[i]);
 	    game.state.galaxy[game.state.isx][game.state.isy].planets -= 1;
-	    if (game.damage[DRADIO] == 0.0 || condit == IHDOCKED) {
+	    if (game.damage[DRADIO] == 0.0 || game.condit == IHDOCKED) {
 		if (*ipage==0) pause_game(1);
 		*ipage = 1;
 		prout(&quot;Lt. Uhura-  \&quot;Captain, Starfleet Intelligence reports&quot;);
@@ -375,20 +375,20 @@
     double bdist[BASEMAX+1];
     int flag;
 #ifdef DEBUG
-    if (idebug) prout(&quot;SCOM&quot;);
+    if (game.idebug) prout(&quot;SCOM&quot;);
 #endif
 
     /* Decide on being active or passive */
-    flag = ((NKILLC+NKILLK)/(game.state.date+0.01-indate) &lt; 0.1*skill*(skill+1.0) ||
-	    (game.state.date-indate) &lt; 3.0);
-    if (iscate==0 &amp;&amp; flag) {
+    flag = ((NKILLC+NKILLK)/(game.state.date+0.01-game.indate) &lt; 0.1*game.skill*(game.skill+1.0) ||
+	    (game.state.date-game.indate) &lt; 3.0);
+    if (game.iscate==0 &amp;&amp; flag) {
 	/* compute move away from Enterprise */
-	ideltax = game.state.isx-quadx;
-	ideltay = game.state.isy-quady;
+	ideltax = game.state.isx-game.quadx;
+	ideltay = game.state.isy-game.quady;
 	if (sqrt(ideltax*(double)ideltax+ideltay*(double)ideltay) &gt; 2.0) {
 	    /* circulate in space */
-	    ideltax = game.state.isy-quady;
-	    ideltay = quadx-game.state.isx;
+	    ideltax = game.state.isy-game.quady;
+	    ideltay = game.quadx-game.state.isx;
 	}
     }
     else {
@@ -432,8 +432,8 @@
 	    i = basetbl[i2];	/* bug in original had it not finding nearest*/
 	    ibqx = game.state.baseqx[i];
 	    ibqy = game.state.baseqy[i];
-	    if ((ibqx == quadx &amp;&amp; ibqy == quady) ||
-		(ibqx == batx &amp;&amp; ibqy == baty) ||
+	    if ((ibqx == game.quadx &amp;&amp; ibqy == game.quady) ||
+		(ibqx == game.batx &amp;&amp; ibqy == game.baty) ||
 		game.state.galaxy[ibqx][ibqy].supernova ||
 		game.state.galaxy[ibqx][ibqy].klingons &gt; 8) 
 		continue;
@@ -504,17 +504,17 @@
     else for_starbases(i) {
 	ibqx = game.state.baseqx[i];
 	ibqy = game.state.baseqy[i];
-	if (ibqx==game.state.isx &amp;&amp; ibqy == game.state.isy &amp;&amp; game.state.isx != batx &amp;&amp; game.state.isy != baty) {
+	if (ibqx==game.state.isx &amp;&amp; ibqy == game.state.isy &amp;&amp; game.state.isx != game.batx &amp;&amp; game.state.isy != game.baty) {
 	    /* attack the base */
 	    if (flag) return; /* no, don't attack base! */
-	    iseenit = 0;
-	    isatb=1;
+	    game.iseenit = 0;
+	    game.isatb=1;
 	    game.future[FSCDBAS] = game.state.date + 1.0 +2.0*Rand();
 	    if (game.future[FCDBAS] &lt; FOREVER) game.future[FSCDBAS] +=
 		game.future[FCDBAS]-game.state.date;
-	    if (game.damage[DRADIO] &gt; 0 &amp;&amp; condit != IHDOCKED)
+	    if (game.damage[DRADIO] &gt; 0 &amp;&amp; game.condit != IHDOCKED)
 		return; /* no warning */
-	    iseenit = 1;
+	    game.iseenit = 1;
 	    if (*ipage == 0)  pause_game(1);
 	    *ipage=1;
 	    proutn(&quot;Lt. Uhura-  \&quot;Captain, the starbase in &quot;);
@@ -523,21 +523,21 @@
 	    prout(&quot;   reports that it is under attack from the Klingon Super-commander.&quot;);
 	    proutn(&quot;   It can survive until stardate %d.\&quot;&quot;,
 		   (int)game.future[FSCDBAS]);
-	    if (resting==0) return;
+	    if (game.resting==0) return;
 	    prout(&quot;Mr. Spock-  \&quot;Captain, shall we cancel the rest period?\&quot;&quot;);
 	    if (ja()==0) return;
-	    resting = 0;
-	    Time = 0.0; /* actually finished */
+	    game.resting = 0;
+	    game.optime = 0.0; /* actually finished */
 	    return;
 	}
     }
     /* Check for intelligence report */
     if (
 #ifdef DEBUG
-	idebug==0 &amp;&amp;
+	game.idebug==0 &amp;&amp;
 #endif
 	(Rand() &gt; 0.2 ||
-	 (game.damage[DRADIO] &gt; 0.0 &amp;&amp; condit != IHDOCKED) ||
+	 (game.damage[DRADIO] &gt; 0.0 &amp;&amp; game.condit != IHDOCKED) ||
 	 !game.state.galaxy[game.state.isx][game.state.isy].charted))
 	return;
     if (*ipage==0) pause_game(1);
@@ -553,49 +553,49 @@
 {
     int idx, idy, im, i, dum, my;
     /* Move the Tholian */
-    if (ithere==0 || justin == 1) return;
+    if (game.ithere==0 || game.justin == 1) return;
 
-    if (ithx == 1 &amp;&amp; ithy == 1) {
+    if (game.ithx == 1 &amp;&amp; game.ithy == 1) {
 	idx = 1; idy = QUADSIZE;
     }
-    else if (ithx == 1 &amp;&amp; ithy == QUADSIZE) {
+    else if (game.ithx == 1 &amp;&amp; game.ithy == QUADSIZE) {
 	idx = QUADSIZE; idy = QUADSIZE;
     }
-    else if (ithx == QUADSIZE &amp;&amp; ithy == QUADSIZE) {
+    else if (game.ithx == QUADSIZE &amp;&amp; game.ithy == QUADSIZE) {
 	idx = QUADSIZE; idy = 1;
     }
-    else if (ithx == QUADSIZE &amp;&amp; ithy == 1) {
+    else if (game.ithx == QUADSIZE &amp;&amp; game.ithy == 1) {
 	idx = 1; idy = 1;
     }
     else {
 	/* something is wrong! */
-	ithere = 0;
+	game.ithere = 0;
 	return;
     }
 
     /* Do nothing if we are blocked */
     if (game.quad[idx][idy]!= IHDOT &amp;&amp; game.quad[idx][idy]!= IHWEB) return;
-    game.quad[ithx][ithy] = IHWEB;
+    game.quad[game.ithx][game.ithy] = IHWEB;
 
-    if (ithx != idx) {
+    if (game.ithx != idx) {
 	/* move in x axis */
-	im = fabs((double)idx - ithx)/((double)idx - ithx);
-	while (ithx != idx) {
-	    ithx += im;
-	    if (game.quad[ithx][ithy]==IHDOT) game.quad[ithx][ithy] = IHWEB;
+	im = fabs((double)idx - game.ithx)/((double)idx - game.ithx);
+	while (game.ithx != idx) {
+	    game.ithx += im;
+	    if (game.quad[game.ithx][game.ithy]==IHDOT) game.quad[game.ithx][game.ithy] = IHWEB;
 	}
     }
-    else if (ithy != idy) {
+    else if (game.ithy != idy) {
 	/* move in y axis */
-	im = fabs((double)idy - ithy)/((double)idy - ithy);
-	while (ithy != idy) {
-	    ithy += im;
-	    if (game.quad[ithx][ithy]==IHDOT) game.quad[ithx][ithy] = IHWEB;
+	im = fabs((double)idy - game.ithy)/((double)idy - game.ithy);
+	while (game.ithy != idy) {
+	    game.ithy += im;
+	    if (game.quad[game.ithx][game.ithy]==IHDOT) game.quad[game.ithx][game.ithy] = IHWEB;
 	}
     }
-    game.quad[ithx][ithy] = IHT;
-    game.kx[nenhere]=ithx;
-    game.ky[nenhere]=ithy;
+    game.quad[game.ithx][game.ithy] = IHT;
+    game.kx[game.nenhere]=game.ithx;
+    game.ky[game.nenhere]=game.ithy;
 
     /* check to see if all holes plugged */
     for_sectors(i) {
@@ -605,11 +605,11 @@
 	if (game.quad[i][QUADSIZE]!=IHWEB &amp;&amp; game.quad[i][QUADSIZE]!=IHT) return;
     }
     /* All plugged up -- Tholian splits */
-    game.quad[ithx][ithy]=IHWEB;
+    game.quad[game.ithx][game.ithy]=IHWEB;
     dropin(IHBLANK, &amp;dum, &amp;my);
-    crmena(1,IHT, 2, ithx, ithy);
+    crmena(1,IHT, 2, game.ithx, game.ithy);
     prout(&quot; completes web.&quot;);
-    ithere = ithx = ithy = 0;
-    nenhere--;
+    game.ithere = game.ithx = game.ithy = 0;
+    game.nenhere--;
     return;
 }

Modified: trunk/src/battle.c
===================================================================
--- trunk/src/battle.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/battle.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -5,7 +5,7 @@
     int key;
     enum {NONE, SHUP, SHDN, NRG} action = NONE;
 
-    ididit = 0;
+    game.ididit = 0;
 
     if (i == 2) action = SHUP;
     else {
@@ -35,7 +35,7 @@
 		prout(&quot;Shields damaged and down.&quot;);
 		return;
 	    }
-	    else if (shldup) {
+	    else if (game.shldup) {
 		proutn(&quot;Shields are up. Do you want them down? &quot;);
 		if (ja()) action = SHDN;
 		else {
@@ -55,31 +55,31 @@
     }
     switch (action) {
     case SHUP: /* raise shields */
-	if (shldup) {
+	if (game.shldup) {
 	    prout(&quot;Shields already up.&quot;);
 	    return;
 	}
-	shldup = 1;
-	shldchg = 1;
-	if (condit != IHDOCKED) energy -= 50.0;
+	game.shldup = 1;
+	game.shldchg = 1;
+	if (game.condit != IHDOCKED) game.energy -= 50.0;
 	prout(&quot;Shields raised.&quot;);
-	if (energy &lt;= 0) {
+	if (game.energy &lt;= 0) {
 	    skip(1);
 	    prout(&quot;Shields raising uses up last of energy.&quot;);
 	    finish(FNRG);
 	    return;
 	}
-	ididit=1;
+	game.ididit=1;
 	return;
     case SHDN:
-	if (shldup==0) {
+	if (game.shldup==0) {
 	    prout(&quot;Shields already down.&quot;);
 	    return;
 	}
-	shldup=0;
-	shldchg=1;
+	game.shldup=0;
+	game.shldchg=1;
 	prout(&quot;Shields lowered.&quot;);
-	ididit=1;
+	game.ididit=1;
 	return;
     case NRG:
 	while (scan() != IHREAL) {
@@ -88,33 +88,33 @@
 	}
 	chew();
 	if (aaitem==0) return;
-	if (aaitem &gt; energy) {
+	if (aaitem &gt; game.energy) {
 	    prout(&quot;Insufficient ship energy.&quot;);
 	    return;
 	}
-	ididit = 1;
-	if (shield+aaitem &gt;= inshld) {
+	game.ididit = 1;
+	if (game.shield+aaitem &gt;= game.inshld) {
 	    prout(&quot;Shield energy maximized.&quot;);
-	    if (shield+aaitem &gt; inshld) {
+	    if (game.shield+aaitem &gt; game.inshld) {
 		prout(&quot;Excess energy requested returned to ship energy&quot;);
 	    }
-	    energy -= inshld-shield;
-	    shield = inshld;
+	    game.energy -= game.inshld-game.shield;
+	    game.shield = game.inshld;
 	    return;
 	}
-	if (aaitem &lt; 0.0 &amp;&amp; energy-aaitem &gt; inenrg) {
+	if (aaitem &lt; 0.0 &amp;&amp; game.energy-aaitem &gt; game.inenrg) {
 	    /* Prevent shield drain loophole */
 	    skip(1);
 	    prout(&quot;Engineering to bridge--&quot;);
 	    prout(&quot;  Scott here. Power circuit problem, Captain.&quot;);
 	    prout(&quot;  I can't drain the shields.&quot;);
-	    ididit = 0;
+	    game.ididit = 0;
 	    return;
 	}
-	if (shield+aaitem &lt; 0) {
+	if (game.shield+aaitem &lt; 0) {
 	    prout(&quot;All shield energy transferred to ship.&quot;);
-	    energy += shield;
-	    shield = 0.0;
+	    game.energy += game.shield;
+	    game.shield = 0.0;
 	    return;
 	}
 	proutn(&quot;Scotty- \&quot;&quot;);
@@ -122,8 +122,8 @@
 	    prout(&quot;Transferring energy to shields.\&quot;&quot;);
 	else
 	    prout(&quot;Draining energy from shields.\&quot;&quot;);
-	shield += aaitem;
-	energy -= aaitem;
+	game.shield += aaitem;
+	game.energy -= aaitem;
 	return;
     case NONE:;	/* avoid gcc warning */
     }
@@ -151,22 +151,22 @@
     crmena(0, ienm, 2, ix, iy);
     if (ibumpd) proutn(&quot; (original position)&quot;);
     skip(1);
-    deadkl(ix, iy, ienm, sectx, secty);
+    deadkl(ix, iy, ienm, game.sectx, game.secty);
     proutn(&quot;***&quot;);
     crmshp();
     prout(&quot; heavily damaged.&quot;);
     icas = 10.0+20.0*Rand();
     prout(&quot;***Sickbay reports %d casualties&quot;, icas);
-    casual += icas;
+    game.casual += icas;
     for (l=0; l &lt; NDEVICES; l++) {
 	if (l == DDRAY) 
 	    continue; // Don't damage deathray 
 	if (game.damage[l] &lt; 0) 
 	    continue;
-	extradm = (10.0*type*Rand()+1.0)*damfac;
-	game.damage[l] += Time + extradm; /* Damage for at least time of travel! */
+	extradm = (10.0*type*Rand()+1.0)*game.damfac;
+	game.damage[l] += game.optime + extradm; /* Damage for at least time of travel! */
     }
-    shldup = 0;
+    game.shldup = 0;
     if (KLINGREM) {
 	pause_game(2);
 	dreprt();
@@ -189,7 +189,7 @@
     if (fabs(deltay) &gt; bigger) bigger = fabs(deltay);
     deltax /= bigger;
     deltay /= bigger;
-    if (game.damage[DSRSENS]==0 || condit==IHDOCKED) 
+    if (game.damage[DSRSENS]==0 || game.condit==IHDOCKED) 
 	setwnd(srscan_window);
     else 
 	setwnd(message_window);
@@ -219,7 +219,7 @@
 	    *hit = fabs(*hit);
 	    newcnd(); /* we're blown out of dock */
 	    /* We may be displaced. */
-	    if (landed==1 || condit==IHDOCKED) return; /* Cheat if on a planet */
+	    if (game.landed==1 || game.condit==IHDOCKED) return; /* Cheat if on a planet */
 	    ang = angle + 2.5*(Rand()-0.5);
 	    temp = fabs(sin(ang));
 	    if (fabs(cos(ang)) &gt; temp) temp = fabs(cos(ang));
@@ -236,8 +236,8 @@
 		/* can't move into object */
 		return;
 	    }
-	    sectx = jx;
-	    secty = jy;
+	    game.sectx = jx;
+	    game.secty = jy;
 	    crmshp();
 	    shoved = 1;
 	    break;
@@ -298,7 +298,7 @@
 	    skip(1);
 	    prout(&quot;***STARBASE DESTROYED..&quot;);
 	    for_starbases(ll) {
-		if (game.state.baseqx[ll]==quadx &amp;&amp; game.state.baseqy[ll]==quady) {
+		if (game.state.baseqx[ll]==game.quadx &amp;&amp; game.state.baseqy[ll]==game.quady) {
 		    game.state.baseqx[ll]=game.state.baseqx[game.state.rembase];
 		    game.state.baseqy[ll]=game.state.baseqy[game.state.rembase];
 		    break;
@@ -306,9 +306,9 @@
 	    }
 	    game.quad[ix][iy]=IHDOT;
 	    game.state.rembase--;
-	    basex=basey=0;
-	    game.state.galaxy[quadx][quady].starbase--;
-	    game.state.chart[quadx][quady].starbase--;
+	    game.basex=game.basey=0;
+	    game.state.galaxy[game.quadx][game.quady].starbase--;
+	    game.state.chart[game.quadx][game.quady].starbase--;
 	    game.state.basekl++;
 	    newcnd();
 	    return;
@@ -316,12 +316,12 @@
 	    crmena(1, iquad, 2, ix, iy);
 	    prout(&quot; destroyed.&quot;);
 	    game.state.nplankl++;
-	    game.state.galaxy[quadx][quady].planets--;
-	    DESTROY(&amp;game.state.plnets[iplnet]);
-	    iplnet = 0;
-	    plnetx = plnety = 0;
+	    game.state.galaxy[game.quadx][game.quady].planets--;
+	    DESTROY(&amp;game.state.plnets[game.iplnet]);
+	    game.iplnet = 0;
+	    game.plnetx = game.plnety = 0;
 	    game.quad[ix][iy] = IHDOT;
-	    if (landed==1) {
+	    if (game.landed==1) {
 		/* captain perishes on planet */
 		finish(FDPLANET);
 	    }
@@ -371,8 +371,8 @@
 	    h1 = fabs(h1);
 	    if (h1 &gt;= 600) {
 		game.quad[ix][iy] = IHDOT;
-		ithere = 0;
-		ithx = ithy = 0;
+		game.ithere = 0;
+		game.ithx = game.ithy = 0;
 		deadkl(ix, iy, iquad, ix, iy);
 		return;
 	    }
@@ -384,8 +384,8 @@
 	    }
 	    prout(&quot; disappears.&quot;);
 	    game.quad[ix][iy] = IHWEB;
-	    ithere = ithx = ithy = 0;
-	    nenhere--;
+	    game.ithere = game.ithx = game.ithy = 0;
+	    game.nenhere--;
 	    {
 		int dum, my;
 		dropin(IHBLANK, &amp;dum, &amp;my);
@@ -409,7 +409,7 @@
 	game.quad[ix][iy]=IHDOT;
 	prout(&quot; displaced by blast to %s &quot;, cramlc(sector, jx, jy));
 	for_local_enemies(ll)
-	    game.kdist[ll] = game.kavgd[ll] = sqrt(square(sectx-game.kx[ll])+square(secty-game.ky[ll]));
+	    game.kdist[ll] = game.kavgd[ll] = sqrt(square(game.sectx-game.kx[ll])+square(game.secty-game.ky[ll]));
 	sortkl();
 	return;
     }
@@ -424,7 +424,7 @@
     int ktr=1, l, ll, j, cdam[NDEVICES];
 
     /* a critical hit occured */
-    if (hit &lt; (275.0-25.0*skill)*(1.0+0.5*Rand())) return;
+    if (hit &lt; (275.0-25.0*game.skill)*(1.0+0.5*Rand())) return;
 
     ncrit = 1.0 + hit/(500.0+100.0*Rand());
     proutn(&quot;***CRITICAL HIT--&quot;);
@@ -434,9 +434,9 @@
 	    j = NDEVICES*Rand();
 	    /* Cheat to prevent shuttle damage unless on ship */
 	} while 
-	      (game.damage[j]&lt;0.0 || (j==DSHUTTL &amp;&amp; iscraft!=1) || j==DDRAY);
+	      (game.damage[j]&lt;0.0 || (j==DSHUTTL &amp;&amp; game.iscraft!=1) || j==DDRAY);
 	cdam[l] = j;
-	extradm = (hit*damfac)/(ncrit*(75.0+25.0*Rand()));
+	extradm = (hit*game.damfac)/(ncrit*(75.0+25.0*Rand()));
 	game.damage[j] += extradm;
 	if (l &gt; 0) {
 	    for (ll=2; ll&lt;=l &amp;&amp; j != cdam[ll-1]; ll++) ;
@@ -448,9 +448,9 @@
 	proutn(device[j]);
     }
     prout(&quot; damaged.&quot;);
-    if (game.damage[DSHIELD] &amp;&amp; shldup) {
+    if (game.damage[DSHIELD] &amp;&amp; game.shldup) {
 	prout(&quot;***Shields knocked down.&quot;);
-	shldup=0;
+	game.shldup=0;
     }
 }
 
@@ -462,30 +462,30 @@
     double hit;
     double pfac, dustfac, hitmax=0.0, hittot=0.0, chgfac=1.0, r;
 
-    iattak = 1;
-    if (alldone) return;
+    game.iattak = 1;
+    if (game.alldone) return;
 #ifdef DEBUG
-    if (idebug) prout(&quot;ATTACK!&quot;);
+    if (game.idebug) prout(&quot;ATTACK!&quot;);
 #endif
 
-    if (ithere) movetho();
+    if (game.ithere) movetho();
 
-    if (neutz) { /* The one chance not to be attacked */
-	neutz = 0;
+    if (game.neutz) { /* The one chance not to be attacked */
+	game.neutz = 0;
 	return;
     }
-    if ((((comhere || ishere) &amp;&amp; (justin == 0)) || skill == SKILL_EMERITUS)&amp;&amp;(torps_ok!=0)) movcom();
-    if (nenhere==0 || (nenhere==1 &amp;&amp; iqhere &amp;&amp; iqengry==0)) return;
-    pfac = 1.0/inshld;
-    if (shldchg == 1) chgfac = 0.25+0.5*Rand();
+    if ((((game.comhere || game.ishere) &amp;&amp; (game.justin == 0)) || game.skill == SKILL_EMERITUS)&amp;&amp;(torps_ok!=0)) movcom();
+    if (game.nenhere==0 || (game.nenhere==1 &amp;&amp; iqhere &amp;&amp; iqengry==0)) return;
+    pfac = 1.0/game.inshld;
+    if (game.shldchg == 1) chgfac = 0.25+0.5*Rand();
     skip(1);
-    if (skill &lt;= SKILL_FAIR) i = 2;
+    if (game.skill &lt;= SKILL_FAIR) i = 2;
     for_local_enemies(l) {
 	if (game.kpower[l] &lt; 0) continue;	/* too weak to attack */
 	/* compute hit strength and diminsh shield power */
 	r = Rand();
 	/* Increase chance of photon torpedos if docked or enemy energy low */
-	if (condit == IHDOCKED) r *= 0.25;
+	if (game.condit == IHDOCKED) r *= 0.25;
 	if (game.kpower[l] &lt; 500) r *= 0.25; 
 	jx = game.kx[l];
 	jy = game.ky[l];
@@ -498,14 +498,14 @@
 	    (iquad==IHQUEST &amp;&amp; r &gt; 0.05);
 	if (itflag) {
 	    /* Enemy uses phasers */
-	    if (condit == IHDOCKED) continue; /* Don't waste the effort! */
+	    if (game.condit == IHDOCKED) continue; /* Don't waste the effort! */
 	    attempt = 1; /* Attempt to attack */
 	    dustfac = 0.8+0.05*Rand();
 	    hit = game.kpower[l]*pow(dustfac,game.kavgd[l]);
 	    game.kpower[l] *= 0.75;
 	}
 	else { /* Enemy used photon torpedo */
-	    double course = 1.90985*atan2((double)secty-jy, (double)jx-sectx);
+	    double course = 1.90985*atan2((double)game.secty-jy, (double)jx-game.sectx);
 	    hit = 0;
 	    proutn(&quot;***TORPEDO INCOMING&quot;);
 	    if (game.damage[DSRSENS] &lt;= 0.0) {
@@ -519,22 +519,22 @@
 	    torpedo(course, r, jx, jy, &amp;hit, 1, 1);
 	    if (KLINGREM==0) 
 		finish(FWON); /* Klingons did themselves in! */
-	    if (game.state.galaxy[quadx][quady].supernova || alldone) 
+	    if (game.state.galaxy[game.quadx][game.quady].supernova || game.alldone) 
 		return; /* Supernova or finished */
 	    if (hit == 0) continue;
 	}
-	if (shldup != 0 || shldchg != 0 || condit==IHDOCKED) {
+	if (game.shldup != 0 || game.shldchg != 0 || game.condit==IHDOCKED) {
 	    /* shields will take hits */
-	    double absorb, hitsh, propor = pfac*shield*(condit==IHDOCKED ? 2.1 : 1.0);
+	    double absorb, hitsh, propor = pfac*game.shield*(game.condit==IHDOCKED ? 2.1 : 1.0);
 	    if(propor &lt; 0.1) propor = 0.1;
 	    hitsh = propor*chgfac*hit+1.0;
 	    atackd=1;
 	    absorb = 0.8*hitsh;
-	    if (absorb &gt; shield) absorb = shield;
-	    shield -= absorb;
+	    if (absorb &gt; game.shield) absorb = game.shield;
+	    game.shield -= absorb;
 	    hit -= hitsh;
-	    if (condit==IHDOCKED) dock(0);
-	    if (propor &gt; 0.1 &amp;&amp; hit &lt; 0.005*energy) continue;
+	    if (game.condit==IHDOCKED) dock(0);
+	    if (propor &gt; 0.1 &amp;&amp; hit &lt; 0.005*game.energy) continue;
 	}
 	/* It's a hit -- print out hit size */
 	atackd = 1; /* We weren't going to check casualties, etc. if
@@ -542,7 +542,7 @@
 		       doesn't make any sense, so I've fixed it */
 	ihurt = 1;
 	proutn(&quot;%d unit hit&quot;, (int)hit);
-	if ((game.damage[DSRSENS] &gt; 0 &amp;&amp; itflag) || skill&lt;=SKILL_FAIR) {
+	if ((game.damage[DSRSENS] &gt; 0 &amp;&amp; itflag) || game.skill&lt;=SKILL_FAIR) {
 	    proutn(&quot; on the &quot;);
 	    crmshp();
 	}
@@ -555,20 +555,20 @@
 	if (hit &gt; hitmax) hitmax = hit;
 	hittot += hit;
 	fry(hit);
-	prout(&quot;Hit %g energy %g&quot;, hit, energy);
-	energy -= hit;
-	if (condit==IHDOCKED) 
+	prout(&quot;Hit %g energy %g&quot;, hit, game.energy);
+	game.energy -= hit;
+	if (game.condit==IHDOCKED) 
 	    dock(0);
     }
-    if (energy &lt;= 0) {
+    if (game.energy &lt;= 0) {
 	/* Returning home upon your shield, not with it... */
 	finish(FBATTLE);
 	return;
     }
-    if (attempt == 0 &amp;&amp; condit == IHDOCKED)
+    if (attempt == 0 &amp;&amp; game.condit == IHDOCKED)
 	prout(&quot;***Enemies decide against attacking your ship.&quot;);
     if (atackd == 0) return;
-    percent = 100.0*pfac*shield+0.5;
+    percent = 100.0*pfac*game.shield+0.5;
     if (ihurt==0) {
 	/* Shields fully protect ship */
 	proutn(&quot;Enemy attack reduces shield strength to &quot;);
@@ -576,12 +576,12 @@
     else {
 	/* Print message if starship suffered hit(s) */
 	skip(1);
-	proutn(&quot;Energy left %2d    shields &quot;, (int)energy);
-	if (shldup) proutn(&quot;up &quot;);
+	proutn(&quot;Energy left %2d    shields &quot;, (int)game.energy);
+	if (game.shldup) proutn(&quot;up &quot;);
 	else if (game.damage[DSHIELD] == 0) proutn(&quot;down &quot;);
 	else proutn(&quot;damaged, &quot;);
     }
-    prout(&quot;%d%%,   torpedoes left %d&quot;, percent, torps);
+    prout(&quot;%d%%,   torpedoes left %d&quot;, percent, game.torps);
     /* Check if anyone was hurt */
     if (hitmax &gt;= 200 || hittot &gt;= 500) {
 	int icas= hittot*Rand()*0.015;
@@ -589,7 +589,7 @@
 	    skip(1);
 	    prout(&quot;Mc Coy-  \&quot;Sickbay to bridge.  We suffered %d casualties&quot;, icas);
 	    prout(&quot;   in that last attack.\&quot;&quot;);
-	    casual += icas;
+	    game.casual += icas;
 	}
     }
     /* After attack, reset average distance to enemies */
@@ -610,13 +610,13 @@
     /* Decide what kind of enemy it is and update approriately */
     if (type == IHR) {
 	/* chalk up a Romulan */
-	game.state.galaxy[quadx][quady].romulans--;
-	irhere--;
+	game.state.galaxy[game.quadx][game.quady].romulans--;
+	game.irhere--;
 	game.state.nromrem--;
     }
     else if (type == IHT) {
 	/* Killed a Tholian */
-	ithere = 0;
+	game.ithere = 0;
     }
     else if (type == IHQUEST) {
 	/* Killed a Thingy */
@@ -624,13 +624,13 @@
     }
     else {
 	/* Some type of a Klingon */
-	game.state.galaxy[quadx][quady].klingons--;
-	klhere--;
+	game.state.galaxy[game.quadx][game.quady].klingons--;
+	game.klhere--;
 	switch (type) {
 	case IHC:
-	    comhere = 0;
+	    game.comhere = 0;
 	    for_commanders (i)
-		if (game.state.cx[i]==quadx &amp;&amp; game.state.cy[i]==quady) break;
+		if (game.state.cx[i]==game.quadx &amp;&amp; game.state.cy[i]==game.quady) break;
 	    game.state.cx[i] = game.state.cx[game.state.remcom];
 	    game.state.cy[i] = game.state.cy[game.state.remcom];
 	    game.state.cx[game.state.remcom] = 0;
@@ -638,14 +638,14 @@
 	    game.state.remcom--;
 	    game.future[FTBEAM] = FOREVER;
 	    if (game.state.remcom != 0)
-		game.future[FTBEAM] = game.state.date + expran(1.0*incom/game.state.remcom);
+		game.future[FTBEAM] = game.state.date + expran(1.0*game.incom/game.state.remcom);
 	    break;
 	case IHK:
 	    game.state.remkl--;
 	    break;
 	case IHS:
 	    game.state.nscrem--;
-	    ishere = game.state.isx = game.state.isy = isatb = iscate = 0;
+	    game.ishere = game.state.isx = game.state.isy = game.isatb = game.iscate = 0;
 	    game.future[FSCMOVE] = game.future[FSCDBAS] = FOREVER;
 	    break;
 	}
@@ -658,25 +658,25 @@
 
     game.state.remtime = game.state.remres/(game.state.remkl + 4*game.state.remcom);
 
-    /* Remove enemy ship from arrays describing local conditions */
-    if (game.future[FCDBAS] &lt; FOREVER &amp;&amp; batx==quadx &amp;&amp; baty==quady &amp;&amp; type==IHC)
+    /* Remove enemy ship from arrays describing local game.conditions */
+    if (game.future[FCDBAS] &lt; FOREVER &amp;&amp; game.batx==game.quadx &amp;&amp; game.baty==game.quady &amp;&amp; type==IHC)
 	game.future[FCDBAS] = FOREVER;
     for_local_enemies(i)
 	if (game.kx[i]==ix &amp;&amp; game.ky[i]==iy) break;
-    nenhere--;
-    if (i &lt;= nenhere)  {
-	for (j=i; j&lt;=nenhere; j++) {
+    game.nenhere--;
+    if (i &lt;= game.nenhere)  {
+	for (j=i; j&lt;=game.nenhere; j++) {
 	    game.kx[j] = game.kx[j+1];
 	    game.ky[j] = game.ky[j+1];
 	    game.kpower[j] = game.kpower[j+1];
 	    game.kavgd[j] = game.kdist[j] = game.kdist[j+1];
 	}
     }
-    game.kx[nenhere+1] = 0;
-    game.ky[nenhere+1] = 0;
-    game.kdist[nenhere+1] = 0;
-    game.kavgd[nenhere+1] = 0;
-    game.kpower[nenhere+1] = 0;
+    game.kx[game.nenhere+1] = 0;
+    game.ky[game.nenhere+1] = 0;
+    game.kdist[game.nenhere+1] = 0;
+    game.kavgd[game.nenhere+1] = 0;
+    game.kpower[game.nenhere+1] = 0;
     return;
 }
 
@@ -688,8 +688,8 @@
 	huh();
 	return 1;
     }
-    deltx = 0.1*(y - secty);
-    delty = 0.1*(sectx - x);
+    deltx = 0.1*(y - game.secty);
+    delty = 0.1*(game.sectx - x);
     if (deltx==0 &amp;&amp; delty== 0) {
 	skip(1);
 	prout(&quot;Spock-  \&quot;Bridge to sickbay.  Dr. McCoy,&quot;);
@@ -708,14 +708,14 @@
     double r, dummy;
     int key, n, i, osuabor;
 
-    ididit = 0;
+    game.ididit = 0;
 
     if (game.damage[DPHOTON]) {
 	prout(&quot;Photon tubes damaged.&quot;);
 	chew();
 	return;
     }
-    if (torps == 0) {
+    if (game.torps == 0) {
 	prout(&quot;No torpedoes left.&quot;);
 	chew();
 	return;
@@ -727,7 +727,7 @@
 	    return;
 	}
 	else if (key == IHEOL) {
-	    prout(&quot;%d torpedoes left.&quot;, torps);
+	    prout(&quot;%d torpedoes left.&quot;, game.torps);
 	    proutn(&quot;Number of torpedoes to fire- &quot;);
 	    key = scan();
 	}
@@ -743,7 +743,7 @@
 		key = IHEOL;
 		return;
 	    }
-	    if (n &lt;= torps) break;
+	    if (n &lt;= game.torps) break;
 	    chew();
 	    key = IHEOL;
 	}
@@ -797,11 +797,11 @@
 	    if (targetcheck(targ[i][1], targ[i][2], &amp;course[i])) return;
 	}
     }
-    ididit = 1;
+    game.ididit = 1;
     /* Loop for moving &lt;n&gt; torpedoes */
     osuabor = 0;
     for (i = 1; i &lt;= n &amp;&amp; !osuabor; i++) {
-	if (condit != IHDOCKED) torps--;
+	if (game.condit != IHDOCKED) game.torps--;
 	r = (Rand()+Rand())*0.5 -0.5;
 	if (fabs(r) &gt;= 0.47) {
 	    /* misfire! */
@@ -816,14 +816,14 @@
 	    osuabor=1;
 	    if (Rand() &lt;= 0.2) {
 		prout(&quot;***Photon tubes damaged by misfire.&quot;);
-		game.damage[DPHOTON] = damfac*(1.0+2.0*Rand());
+		game.damage[DPHOTON] = game.damfac*(1.0+2.0*Rand());
 		break;
 	    }
 	}
-	if (shldup || condit == IHDOCKED) 
-	    r *= 1.0 + 0.0001*shield;
-	torpedo(course[i], r, sectx, secty, &amp;dummy, i, n);
-	if (alldone || game.state.galaxy[quadx][quady].supernova)
+	if (game.shldup || game.condit == IHDOCKED) 
+	    r *= 1.0 + 0.0001*game.shield;
+	torpedo(course[i], r, game.sectx, game.secty, &amp;dummy, i, n);
+	if (game.alldone || game.state.galaxy[game.quadx][game.quady].supernova)
 	    return;
     }
     if (KLINGREM==0) finish(FWON);
@@ -837,7 +837,7 @@
 	double chekbrn = (rpow-1500.)*0.00038;
 	if (Rand() &lt;= chekbrn) {
 	    prout(&quot;Weapons officer Sulu-  \&quot;Phasers overheated, sir.\&quot;&quot;);
-	    game.damage[DPHASER] = damfac*(1.0 + Rand()) * (1.0+chekbrn);
+	    game.damage[DPHASER] = game.damfac*(1.0 + Rand()) * (1.0+chekbrn);
 	}
     }
 }
@@ -855,10 +855,10 @@
     /* Something bad has happened */
     prouts(&quot;***RED ALERT!  RED ALERT!&quot;);
     skip(2);
-    hit = rpow*shield/inshld;
-    energy -= rpow+hit*0.8;
-    shield -= hit*0.2;
-    if (energy &lt;= 0.0) {
+    hit = rpow*game.shield/game.inshld;
+    game.energy -= rpow+hit*0.8;
+    game.shield -= hit*0.2;
+    if (game.energy &lt;= 0.0) {
 	prouts(&quot;Sulu-  \&quot;Captain! Shield malf***********************\&quot;&quot;);
 	skip(1);
 	stars();
@@ -875,7 +875,7 @@
 	skip(1);
 	prout(&quot;McCoy to bridge- \&quot;Severe radiation burns, Jim.&quot;);
 	prout(&quot;  %d casualties so far.\&quot;&quot;, icas);
-	casual -= icas;
+	game.casual -= icas;
     }
     skip(1);
     prout(&quot;Phaser energy dispersed by shields.&quot;);
@@ -896,7 +896,7 @@
     skip(1);
     /* SR sensors and Computer */
     if (game.damage[DSRSENS]+game.damage[DCOMPTR] &gt; 0) ipoop = 0;
-    if (condit == IHDOCKED) {
+    if (game.condit == IHDOCKED) {
 	prout(&quot;Phasers can't be fired through base shields.&quot;);
 	chew();
 	return;
@@ -906,13 +906,13 @@
 	chew();
 	return;
     }
-    if (shldup) {
+    if (game.shldup) {
 	if (game.damage[DSHCTRL]) {
 	    prout(&quot;High speed shield control damaged.&quot;);
 	    chew();
 	    return;
 	}
-	if (energy &lt;= 200.0) {
+	if (game.energy &lt;= 200.0) {
 	    prout(&quot;Insufficient energy to activate high-speed shield control.&quot;);
 	    chew();
 	    return;
@@ -926,7 +926,7 @@
 	key=scan();
 	if (key == IHALPHA) {
 	    if (isit(&quot;manual&quot;)) {
-		if (nenhere==0) {
+		if (game.nenhere==0) {
 		    prout(&quot;There is no enemy present to select.&quot;);
 		    chew();
 		    key = IHEOL;
@@ -938,11 +938,11 @@
 		}
 	    }
 	    else if (isit(&quot;automatic&quot;)) {
-		if ((!ipoop) &amp;&amp; nenhere != 0) {
+		if ((!ipoop) &amp;&amp; game.nenhere != 0) {
 		    automode = FORCEMAN;
 		}
 		else {
-		    if (nenhere==0)
+		    if (game.nenhere==0)
 			prout(&quot;Energy will be expended into space.&quot;);
 		    automode = AUTOMATIC;
 		    key = scan();
@@ -957,7 +957,7 @@
 	    }
 	}
 	else if (key == IHREAL) {
-	    if (nenhere==0) {
+	    if (game.nenhere==0) {
 		prout(&quot;Energy will be expended into space.&quot;);
 		automode = AUTOMATIC;
 	    }
@@ -968,7 +968,7 @@
 	}
 	else {
 	    /* IHEOL */
-	    if (nenhere==0) {
+	    if (game.nenhere==0) {
 		prout(&quot;Energy will be expended into space.&quot;);
 		automode = AUTOMATIC;
 	    }
@@ -985,9 +985,9 @@
 	    no = 1;
 	    key = scan();
 	}
-	if (key != IHREAL &amp;&amp; nenhere != 0) {
+	if (key != IHREAL &amp;&amp; game.nenhere != 0) {
 	    prout(&quot;Phasers locked on target. Energy available: %.2f&quot;,
-		  ifast?energy-200.0:energy,1,2);
+		  ifast?game.energy-200.0:game.energy,1,2);
 	}
 	irec=0;
 	do {
@@ -1002,13 +1002,13 @@
 	    key = scan();
 	    if (key!=IHREAL) return;
 	    rpow = aaitem;
-	    if (rpow &gt; (ifast?energy-200:energy)) {
+	    if (rpow &gt; (ifast?game.energy-200:game.energy)) {
 		proutn(&quot;Energy available= %.2f&quot;,
-		       ifast?energy-200:energy);
+		       ifast?game.energy-200:game.energy);
 		skip(1);
 		key = IHEOL;
 	    }
-	} while (rpow &gt; (ifast?energy-200:energy));
+	} while (rpow &gt; (ifast?game.energy-200:game.energy));
 	if (rpow&lt;=0) {
 	    /* chicken out */
 	    chew();
@@ -1018,13 +1018,13 @@
 	    no = 1;
 	}
 	if (ifast) {
-	    energy -= 200; /* Go and do it! */
+	    game.energy -= 200; /* Go and do it! */
 	    if (checkshctrl(rpow)) return;
 	}
 	chew();
-	energy -= rpow;
+	game.energy -= rpow;
 	extra = rpow;
-	if (nenhere) {
+	if (game.nenhere) {
 	    extra = 0.0;
 	    powrem = rpow;
 	    for_local_enemies(i) {
@@ -1040,12 +1040,12 @@
 	    }
 	    if (powrem &gt; 0.0) extra += powrem;
 	    hittem(hits);
-	    ididit=1;
+	    game.ididit=1;
 	}
-	if (extra &gt; 0 &amp;&amp; alldone == 0) {
-	    if (ithere) {
+	if (extra &gt; 0 &amp;&amp; game.alldone == 0) {
+	    if (game.ithere) {
 		proutn(&quot;*** Tholian web absorbs &quot;);
-		if (nenhere&gt;0) proutn(&quot;excess &quot;);
+		if (game.nenhere&gt;0) proutn(&quot;excess &quot;);
 		prout(&quot;phaser energy.&quot;);
 	    }
 	    else {
@@ -1070,17 +1070,17 @@
 	}
     case MANUAL:
 	rpow = 0.0;
-	for (k = 1; k &lt;= nenhere;) {
+	for (k = 1; k &lt;= game.nenhere;) {
 	    int ii = game.kx[k], jj = game.ky[k];
 	    int ienm = game.quad[ii][jj];
 	    if (msgflag) {
 		proutn(&quot;Energy available= %.2f&quot;,
-		       energy-.006-(ifast?200:0));
+		       game.energy-.006-(ifast?200:0));
 		skip(1);
 		msgflag = 0;
 		rpow = 0.0;
 	    }
-	    if (game.damage[DSRSENS] &amp;&amp; !(abs(sectx-ii) &lt; 2 &amp;&amp; abs(secty-jj) &lt; 2) &amp;&amp;
+	    if (game.damage[DSRSENS] &amp;&amp; !(abs(game.sectx-ii) &lt; 2 &amp;&amp; abs(game.secty-jj) &lt; 2) &amp;&amp;
 		(ienm == IHC || ienm == IHS)) {
 		cramen(ienm);
 		prout(&quot; can't be located without short range scan.&quot;);
@@ -1129,7 +1129,7 @@
 	    rpow += aaitem;
 	    /* If total requested is too much, inform and start over */
 				
-	    if (rpow &gt; (ifast?energy-200:energy)) {
+	    if (rpow &gt; (ifast?game.energy-200:game.energy)) {
 		prout(&quot;Available energy exceeded -- try again.&quot;);
 		chew();
 		return;
@@ -1145,18 +1145,18 @@
 	if (key == IHALPHA &amp;&amp; isit(&quot;no&quot;)) {
 	    no = 1;
 	}
-	energy -= rpow;
+	game.energy -= rpow;
 	chew();
 	if (ifast) {
-	    energy -= 200.0;
+	    game.energy -= 200.0;
 	    if (checkshctrl(rpow)) return;
 	}
 	hittem(hits);
-	ididit=1;
+	game.ididit=1;
     case NOTSET:;	/* avoid gcc warning */
     }
     /* Say shield raised or malfunction, if necessary */
-    if (alldone) 
+    if (game.alldone) 
 	return;
     if (ifast) {
 	skip(1);
@@ -1165,13 +1165,13 @@
 		prout(&quot;Sulu-  \&quot;Sir, the high-speed shield control has malfunctioned . . .&quot;);
 		prouts(&quot;         CLICK   CLICK   POP  . . .&quot;);
 		prout(&quot; No  response, sir!&quot;);
-		shldup = 0;
+		game.shldup = 0;
 	    }
 	    else
 		prout(&quot;Shields raised.&quot;);
 	}
 	else
-	    shldup = 0;
+	    game.shldup = 0;
     }
     overheat(rpow);
 }
@@ -1179,7 +1179,7 @@
 void hittem(double *hits) 
 {
     double kp, kpow, wham, hit, dustfac, kpini;
-    int nenhr2=nenhere, k=1, kk=1, ii, jj, ienm;
+    int nenhr2=game.nenhere, k=1, kk=1, ii, jj, ienm;
 
     skip(1);
 
@@ -1208,7 +1208,7 @@
 	if (kpow == 0) {
 	    deadkl(ii, jj, ienm, ii, jj);
 	    if (KLINGREM==0) finish(FWON);
-	    if (alldone) return;
+	    if (game.alldone) return;
 	    kk--; /* don't do the increment */
 	}
 	else /* decide whether or not to emasculate klingon */

Modified: trunk/src/events.c
===================================================================
--- trunk/src/events.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/events.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -4,11 +4,11 @@
 void events(void) 
 {
     int ictbeam=0, ipage=0, istract=0, line, i=0, j, k, l, ixhold=0, iyhold=0;
-    double fintim = game.state.date + Time, datemin, xtime, repair, yank=0;
+    double fintim = game.state.date + game.optime, datemin, xtime, repair, yank=0;
     int radio_was_broken;
 
 #ifdef DEBUG
-    if (idebug) prout(&quot;EVENTS&quot;);
+    if (game.idebug) prout(&quot;EVENTS&quot;);
 #endif
 
     radio_was_broken = (game.damage[DRADIO] != 0.0);
@@ -16,7 +16,7 @@
     for (;;) {
 	/* Select earliest extraneous event, line==0 if no events */
 	line = FSPY;
-	if (alldone) return;
+	if (game.alldone) return;
 	datemin = fintim;
 	for (l = 1; l &lt; NEVENTS; l++)
 	    if (game.future[l] &lt; datemin) {
@@ -33,17 +33,17 @@
 	    return;
 	}
 	/* Is life support adequate? */
-	if (game.damage[DLIFSUP] &amp;&amp; condit != IHDOCKED) {
-	    if (lsupres &lt; xtime &amp;&amp; game.damage[DLIFSUP] &gt; lsupres) {
+	if (game.damage[DLIFSUP] &amp;&amp; game.condit != IHDOCKED) {
+	    if (game.lsupres &lt; xtime &amp;&amp; game.damage[DLIFSUP] &gt; game.lsupres) {
 		finish(FLIFESUP);
 		return;
 	    }
-	    lsupres -= xtime;
-	    if (game.damage[DLIFSUP] &lt;= xtime) lsupres = inlsr;
+	    game.lsupres -= xtime;
+	    if (game.damage[DLIFSUP] &lt;= xtime) game.lsupres = game.inlsr;
 	}
 	/* Fix devices */
 	repair = xtime;
-	if (condit == IHDOCKED) repair /= docfac;
+	if (game.condit == IHDOCKED) repair /= game.docfac;
 	/* Don't fix Deathray here */
 	for (l=0; l&lt;NDEVICES; l++)
 	    if (game.damage[l] &gt; 0.0 &amp;&amp; l != DDRAY)
@@ -53,37 +53,37 @@
 	    prout(&quot;Lt. Uhura- \&quot;Captain, the sub-space radio is working and&quot;);
 	    prout(&quot;   surveillance reports are coming in.&quot;);
 	    skip(1);
-	    if (iseenit==0) {
+	    if (game.iseenit==0) {
 		attakreport(0);
-		iseenit = 1;
+		game.iseenit = 1;
 	    }
 	    rechart();
 	    prout(&quot;   The star chart is now up to date.\&quot;&quot;);
 	    skip(1);
 	}
 	/* Cause extraneous event LINE to occur */
-	Time -= xtime;
+	game.optime -= xtime;
 	switch (line) {
 	case FSNOVA: /* Supernova */
 	    if (ipage==0) pause_game(1);
 	    ipage=1;
 	    snova(0,0);
-	    game.future[FSNOVA] = game.state.date + expran(0.5*intime);
-	    if (game.state.galaxy[quadx][quady].supernova) return;
+	    game.future[FSNOVA] = game.state.date + expran(0.5*game.intime);
+	    if (game.state.galaxy[game.quadx][game.quady].supernova) return;
 	    break;
 	case FSPY: /* Check with spy to see if S.C. should tractor beam */
 	    if (game.state.nscrem == 0 ||
 		ictbeam+istract &gt; 0 ||
-		condit==IHDOCKED || isatb==1 || iscate==1) return;
-	    if (ientesc ||
-		(energy &lt; 2000 &amp;&amp; torps &lt; 4 &amp;&amp; shield &lt; 1250) ||
-		(game.damage[DPHASER]&gt;0 &amp;&amp; (game.damage[DPHOTON]&gt;0 || torps &lt; 4)) ||
+		game.condit==IHDOCKED || game.isatb==1 || game.iscate==1) return;
+	    if (game.ientesc ||
+		(game.energy &lt; 2000 &amp;&amp; game.torps &lt; 4 &amp;&amp; game.shield &lt; 1250) ||
+		(game.damage[DPHASER]&gt;0 &amp;&amp; (game.damage[DPHOTON]&gt;0 || game.torps &lt; 4)) ||
 		(game.damage[DSHIELD] &gt; 0 &amp;&amp;
-		 (energy &lt; 2500 || game.damage[DPHASER] &gt; 0) &amp;&amp;
-		 (torps &lt; 5 || game.damage[DPHOTON] &gt; 0))) {
+		 (game.energy &lt; 2500 || game.damage[DPHASER] &gt; 0) &amp;&amp;
+		 (game.torps &lt; 5 || game.damage[DPHOTON] &gt; 0))) {
 		/* Tractor-beam her! */
 		istract=1;
-		yank = square(game.state.isx-quadx) + square(game.state.isy-quady);
+		yank = square(game.state.isx-game.quadx) + square(game.state.isy-game.quady);
 		/********* fall through to FTBEAM code ***********/
 	    }
 	    else return;
@@ -94,11 +94,11 @@
 		    break;
 		}
 		i = Rand()*game.state.remcom+1.0;
-		yank = square(game.state.cx[i]-quadx) + square(game.state.cy[i]-quady);
-		if (istract || condit == IHDOCKED || yank == 0) {
+		yank = square(game.state.cx[i]-game.quadx) + square(game.state.cy[i]-game.quady);
+		if (istract || game.condit == IHDOCKED || yank == 0) {
 		    /* Drats! Have to reschedule */
-		    game.future[FTBEAM] = game.state.date + Time +
-			expran(1.5*intime/game.state.remcom);
+		    game.future[FTBEAM] = game.state.date + game.optime +
+			expran(1.5*game.intime/game.state.remcom);
 		    break;
 		}
 	    }
@@ -106,7 +106,7 @@
 	    yank = sqrt(yank);
 	    if (ipage==0) pause_game(1);
 	    ipage=1;
-	    Time = (10.0/(7.5*7.5))*yank; /* 7.5 is yank rate (warp 7.5) */
+	    game.optime = (10.0/(7.5*7.5))*yank; /* 7.5 is yank rate (warp 7.5) */
 	    ictbeam = 1;
 	    skip(1);
 	    proutn(&quot;***&quot;);
@@ -114,60 +114,60 @@
 	    prout(&quot; caught in long range tractor beam--&quot;);
 	    /* If Kirk &amp; Co. screwing around on planet, handle */
 	    atover(1); /* atover(1) is Grab */
-	    if (alldone) return;
-	    if (icraft == 1) { /* Caught in Galileo? */
+	    if (game.alldone) return;
+	    if (game.icraft == 1) { /* Caught in Galileo? */
 		finish(FSTRACTOR);
 		return;
 	    }
 	    /* Check to see if shuttle is aboard */
-	    if (iscraft==0) {
+	    if (game.iscraft==0) {
 		skip(1);
 		if (Rand() &gt; 0.5) {
 		    prout(&quot;Galileo, left on the planet surface, is captured&quot;);
 		    prout(&quot;by aliens and made into a flying McDonald's.&quot;);
 		    game.damage[DSHUTTL] = -10;
-		    iscraft = -1;
+		    game.iscraft = -1;
 		}
 		else {
 		    prout(&quot;Galileo, left on the planet surface, is well hidden.&quot;);
 		}
 	    }
 	    if (line==0) {
-		quadx = game.state.isx;
-		quady = game.state.isy;
+		game.quadx = game.state.isx;
+		game.quady = game.state.isy;
 	    }
 	    else {
-		quadx = game.state.cx[i];
-		quady = game.state.cy[i];
+		game.quadx = game.state.cx[i];
+		game.quady = game.state.cy[i];
 	    }
-	    iran(QUADSIZE, &amp;sectx, &amp;secty);
+	    iran(QUADSIZE, &amp;game.sectx, &amp;game.secty);
 	    crmshp();
 	    proutn(&quot; is pulled to &quot;);
-	    proutn(cramlc(quadrant, quadx, quady));
+	    proutn(cramlc(quadrant, game.quadx, game.quady));
 	    proutn(&quot;, &quot;);
-	    prout(cramlc(sector, sectx, secty));
-	    if (resting) {
+	    prout(cramlc(sector, game.sectx, game.secty));
+	    if (game.resting) {
 		prout(&quot;(Remainder of rest/repair period cancelled.)&quot;);
-		resting = 0;
+		game.resting = 0;
 	    }
-	    if (shldup==0) {
-		if (game.damage[DSHIELD]==0 &amp;&amp; shield &gt; 0) {
+	    if (game.shldup==0) {
+		if (game.damage[DSHIELD]==0 &amp;&amp; game.shield &gt; 0) {
 		    doshield(2); /* Shldsup */
-		    shldchg=0;
+		    game.shldchg=0;
 		}
 		else prout(&quot;(Shields not currently useable.)&quot;);
 	    }
 	    newqad(0);
 	    /* Adjust finish time to time of tractor beaming */
-	    fintim = game.state.date+Time;
+	    fintim = game.state.date+game.optime;
 	    attack(0);
 	    if (game.state.remcom &lt;= 0) game.future[FTBEAM] = FOREVER;
-	    else game.future[FTBEAM] = game.state.date+Time+expran(1.5*intime/game.state.remcom);
+	    else game.future[FTBEAM] = game.state.date+game.optime+expran(1.5*game.intime/game.state.remcom);
 	    break;
 	case FSNAP: /* Snapshot of the universe (for time warp) */
 	    game.snapsht = game.state;
 	    game.state.snap = 1;
-	    game.future[FSNAP] = game.state.date + expran(0.5 * intime);
+	    game.future[FSNAP] = game.state.date + expran(0.5 * game.intime);
 	    break;
 	case FBATTAK: /* Commander attacks starbase */
 	    if (game.state.remcom==0 || game.state.rembase==0) {
@@ -179,7 +179,7 @@
 	    for_starbases(j) {
 		for_commanders(k)
 		    if (game.state.baseqx[j]==game.state.cx[k] &amp;&amp; game.state.baseqy[j]==game.state.cy[k] &amp;&amp;
-			(game.state.baseqx[j]!=quadx || game.state.baseqy[j]!=quady) &amp;&amp;
+			(game.state.baseqx[j]!=game.quadx || game.state.baseqy[j]!=game.quady) &amp;&amp;
 			(game.state.baseqx[j]!=game.state.isx || game.state.baseqy[j]!=game.state.isy)) {
 			i = 1;
 			break;
@@ -188,125 +188,125 @@
 	    }
 	    if (j&gt;game.state.rembase) {
 		/* no match found -- try later */
-		game.future[FBATTAK] = game.state.date + expran(0.3*intime);
+		game.future[FBATTAK] = game.state.date + expran(0.3*game.intime);
 		game.future[FCDBAS] = FOREVER;
 		break;
 	    }
 	    /* commander + starbase combination found -- launch attack */
-	    batx = game.state.baseqx[j];
-	    baty = game.state.baseqy[j];
+	    game.batx = game.state.baseqx[j];
+	    game.baty = game.state.baseqy[j];
 	    game.future[FCDBAS] = game.state.date+1.0+3.0*Rand();
-	    if (isatb) /* extra time if SC already attacking */
+	    if (game.isatb) /* extra time if SC already attacking */
 		game.future[FCDBAS] += game.future[FSCDBAS]-game.state.date;
-	    game.future[FBATTAK] = game.future[FCDBAS] +expran(0.3*intime);
-	    iseenit = 0;
+	    game.future[FBATTAK] = game.future[FCDBAS] +expran(0.3*game.intime);
+	    game.iseenit = 0;
 	    if (game.damage[DRADIO] != 0.0 &amp;&amp;
-		condit != IHDOCKED) break; /* No warning :-( */
-	    iseenit = 1;
+		game.condit != IHDOCKED) break; /* No warning :-( */
+	    game.iseenit = 1;
 	    if (ipage==0) pause_game(1);
 	    ipage = 1;
 	    skip(1);
 	    proutn(&quot;Lt. Uhura-  \&quot;Captain, the starbase in &quot;);
-	    prout(cramlc(quadrant, batx, baty));
+	    prout(cramlc(quadrant, game.batx, game.baty));
 	    prout(&quot;   reports that it is under attack and that it can&quot;);
 	    proutn(&quot;   hold out only until stardate %d&quot;,
 		   (int)game.future[FCDBAS]);
 	    prout(&quot;.\&quot;&quot;);
-	    if (resting) {
+	    if (game.resting) {
 		skip(1);
 		proutn(&quot;Mr. Spock-  \&quot;Captain, shall we cancel the rest period?\&quot; &quot;);
 		if (ja()) {
-		    resting = 0;
-		    Time = 0.0;
+		    game.resting = 0;
+		    game.optime = 0.0;
 		    return;
 		}
 	    }
 	    break;
 	case FSCDBAS: /* Supercommander destroys base */
 	    game.future[FSCDBAS] = FOREVER;
-	    isatb = 2;
+	    game.isatb = 2;
 	    if (!game.state.galaxy[game.state.isx][game.state.isy].starbase) 
 		break; /* WAS RETURN! */
-	    ixhold = batx;
-	    iyhold = baty;
-	    batx = game.state.isx;
-	    baty = game.state.isy;
+	    ixhold = game.batx;
+	    iyhold = game.baty;
+	    game.batx = game.state.isx;
+	    game.baty = game.state.isy;
 	case FCDBAS: /* Commander succeeds in destroying base */
 	    if (line==FCDBAS) {
 		game.future[FCDBAS] = FOREVER;
 		/* find the lucky pair */
 		for_commanders(i)
-		    if (game.state.cx[i]==batx &amp;&amp; game.state.cy[i]==baty) 
+		    if (game.state.cx[i]==game.batx &amp;&amp; game.state.cy[i]==game.baty) 
 			break;
 		if (i &gt; game.state.remcom || game.state.rembase == 0 ||
-		    !game.state.galaxy[batx][baty].starbase) {
+		    !game.state.galaxy[game.batx][game.baty].starbase) {
 		    /* No action to take after all */
-		    batx = baty = 0;
+		    game.batx = game.baty = 0;
 		    break;
 		}
 	    }
 	    /* Code merges here for any commander destroying base */
 	    /* Not perfect, but will have to do */
 	    /* Handle case where base is in same quadrant as starship */
-	    if (batx==quadx &amp;&amp; baty==quady) {
-		game.state.chart[batx][baty].starbase = FALSE;
-		game.quad[basex][basey]= IHDOT;
-		basex=basey=0;
+	    if (game.batx==game.quadx &amp;&amp; game.baty==game.quady) {
+		game.state.chart[game.batx][game.baty].starbase = FALSE;
+		game.quad[game.basex][game.basey]= IHDOT;
+		game.basex=game.basey=0;
 		newcnd();
 		skip(1);
 		prout(&quot;Spock-  \&quot;Captain, I believe the starbase has been destroyegame.state.\&quot;&quot;);
 	    }
 	    else if (game.state.rembase != 1 &amp;&amp;
-		     (game.damage[DRADIO] &lt;= 0.0 || condit == IHDOCKED)) {
+		     (game.damage[DRADIO] &lt;= 0.0 || game.condit == IHDOCKED)) {
 		/* Get word via subspace radio */
 		if (ipage==0) pause_game(1);
 		ipage = 1;
 		skip(1);
 		prout(&quot;Lt. Uhura-  \&quot;Captain, Starfleet Command reports that&quot;);
 		proutn(&quot;   the starbase in &quot;);
-		proutn(cramlc(quadrant, batx, baty));
+		proutn(cramlc(quadrant, game.batx, game.baty));
 		prout(&quot; has been destroyed by&quot;);
-		if (isatb==2) prout(&quot;the Klingon Super-Commander&quot;);
+		if (game.isatb==2) prout(&quot;the Klingon Super-Commander&quot;);
 		else prout(&quot;a Klingon Commander&quot;);
-		game.state.chart[batx][baty].starbase = FALSE;
+		game.state.chart[game.batx][game.baty].starbase = FALSE;
 	    }
 	    /* Remove Starbase from galaxy */
-	    game.state.galaxy[batx][baty].starbase = FALSE;
+	    game.state.galaxy[game.batx][game.baty].starbase = FALSE;
 	    for_starbases(i)
-		if (game.state.baseqx[i]==batx &amp;&amp; game.state.baseqy[i]==baty) {
+		if (game.state.baseqx[i]==game.batx &amp;&amp; game.state.baseqy[i]==game.baty) {
 		    game.state.baseqx[i]=game.state.baseqx[game.state.rembase];
 		    game.state.baseqy[i]=game.state.baseqy[game.state.rembase];
 		}
 	    game.state.rembase--;
-	    if (isatb == 2) {
+	    if (game.isatb == 2) {
 		/* reinstate a commander's base attack */
-		batx = ixhold;
-		baty = iyhold;
-		isatb = 0;
+		game.batx = ixhold;
+		game.baty = iyhold;
+		game.isatb = 0;
 	    }
 	    else {
-		batx = baty = 0;
+		game.batx = game.baty = 0;
 	    }
 	    break;
 	case FSCMOVE: /* Supercommander moves */
 	    game.future[FSCMOVE] = game.state.date+0.2777;
-	    if (ientesc+istract==0 &amp;&amp;
-		isatb!=1 &amp;&amp;
-		(iscate!=1 || justin==1)) scom(&amp;ipage);
+	    if (game.ientesc+istract==0 &amp;&amp;
+		game.isatb!=1 &amp;&amp;
+		(game.iscate!=1 || game.justin==1)) scom(&amp;ipage);
 	    break;
 	case FDSPROB: /* Move deep space probe */
 	    game.future[FDSPROB] = game.state.date + 0.01;
-	    probex += probeinx;
-	    probey += probeiny;
-	    i = (int)(probex/QUADSIZE +0.05);
-	    j = (int)(probey/QUADSIZE + 0.05);
-	    if (probecx != i || probecy != j) {
-		probecx = i;
-		probecy = j;
+	    game.probex += game.probeinx;
+	    game.probey += game.probeiny;
+	    i = (int)(game.probex/QUADSIZE +0.05);
+	    j = (int)(game.probey/QUADSIZE + 0.05);
+	    if (game.probecx != i || game.probecy != j) {
+		game.probecx = i;
+		game.probecy = j;
 		if (!VALID_QUADRANT(i, j) ||
-		    game.state.galaxy[probecx][probecy].supernova) {
+		    game.state.galaxy[game.probecx][game.probecy].supernova) {
 		    // Left galaxy or ran into supernova
-		    if (game.damage[DRADIO]==0.0 || condit == IHDOCKED) {
+		    if (game.damage[DRADIO]==0.0 || game.condit == IHDOCKED) {
 			if (ipage==0) pause_game(1);
 			ipage = 1;
 			skip(1);
@@ -320,30 +320,30 @@
 		    game.future[FDSPROB] = FOREVER;
 		    break;
 		}
-		if (game.damage[DRADIO]==0.0   || condit == IHDOCKED) {
+		if (game.damage[DRADIO]==0.0   || game.condit == IHDOCKED) {
 		    if (ipage==0) pause_game(1);
 		    ipage = 1;
 		    skip(1);
 		    proutn(&quot;Lt. Uhura-  \&quot;The deep space probe is now in &quot;);
-		    proutn(cramlc(quadrant, probecx, probecy));
+		    proutn(cramlc(quadrant, game.probecx, game.probecy));
 		    prout(&quot;.\&quot;&quot;);
 		}
 	    }
 	    /* Update star chart if Radio is working or have access to
 	       radio. */
-	    if (game.damage[DRADIO] == 0.0 || condit == IHDOCKED) {
-		game.state.chart[probecx][probecy].klingons = game.state.galaxy[probecx][probecy].klingons;
-		game.state.chart[probecx][probecy].starbase = game.state.galaxy[probecx][probecy].starbase;
-		game.state.chart[probecx][probecy].stars = game.state.galaxy[probecx][probecy].stars;
-		game.state.galaxy[probecx][probecy].charted = TRUE;
+	    if (game.damage[DRADIO] == 0.0 || game.condit == IHDOCKED) {
+		game.state.chart[game.probecx][game.probecy].klingons = game.state.galaxy[game.probecx][game.probecy].klingons;
+		game.state.chart[game.probecx][game.probecy].starbase = game.state.galaxy[game.probecx][game.probecy].starbase;
+		game.state.chart[game.probecx][game.probecy].stars = game.state.galaxy[game.probecx][game.probecy].stars;
+		game.state.galaxy[game.probecx][game.probecy].charted = TRUE;
 	    }
-	    proben--; // One less to travel
-	    if (proben == 0 &amp;&amp; isarmed &amp;&amp;
-		game.state.galaxy[probecx][probecy].stars) {
+	    game.proben--; // One less to travel
+	    if (game.proben == 0 &amp;&amp; game.isarmed &amp;&amp;
+		game.state.galaxy[game.probecx][game.probecy].stars) {
 		/* lets blow the sucker! */
 		snova(1,0);
 		game.future[FDSPROB] = FOREVER;
-		if (game.state.galaxy[quadx][quady].supernova) 
+		if (game.state.galaxy[game.quadx][game.quady].supernova) 
 		    return;
 	    }
 	    break;
@@ -357,7 +357,7 @@
     int key;
     double temp, delay, origTime;
 
-    ididit = 0;
+    game.ididit = 0;
     for (;;) {
 	key = scan();
 	if (key  != IHEOL) break;
@@ -370,42 +370,42 @@
     }
     origTime = delay = aaitem;
     if (delay &lt;= 0.0) return;
-    if (delay &gt;= game.state.remtime || nenhere != 0) {
+    if (delay &gt;= game.state.remtime || game.nenhere != 0) {
 	proutn(&quot;Are you sure? &quot;);
 	if (ja() == 0) return;
     }
 
     /* Alternate resting periods (events) with attacks */
 
-    resting = 1;
+    game.resting = 1;
     do {
-	if (delay &lt;= 0) resting = 0;
-	if (resting == 0) {
+	if (delay &lt;= 0) game.resting = 0;
+	if (game.resting == 0) {
 	    prout(&quot;%d stardates left.&quot;, (int)game.state.remtime);
 	    return;
 	}
-	temp = Time = delay;
+	temp = game.optime = delay;
 
-	if (nenhere) {
+	if (game.nenhere) {
 	    double rtime = 1.0 + Rand();
 	    if (rtime &lt; temp) temp = rtime;
-	    Time = temp;
+	    game.optime = temp;
 	}
-	if (Time &lt; delay) attack(0);
-	if (alldone) return;
+	if (game.optime &lt; delay) attack(0);
+	if (game.alldone) return;
 	events();
-	ididit = 1;
-	if (alldone) return;
+	game.ididit = 1;
+	if (game.alldone) return;
 	delay -= temp;
 	/* Repair Deathray if long rest at starbase */
-	if (origTime-delay &gt;= 9.99 &amp;&amp; condit == IHDOCKED)
+	if (origTime-delay &gt;= 9.99 &amp;&amp; game.condit == IHDOCKED)
 	    game.damage[DDRAY] = 0.0;
     } while 
 	// leave if quadrant supernovas
-	(!game.state.galaxy[quadx][quady].supernova);
+	(!game.state.galaxy[game.quadx][game.quady].supernova);
 
-    resting = 0;
-    Time = 0;
+    game.resting = 0;
+    game.optime = 0;
 }
 
 void nova(int ix, int iy) 
@@ -424,7 +424,7 @@
     game.quad[ix][iy] = IHDOT;
     crmena(1, IHSTAR, 2, ix, iy);
     prout(&quot; novas.&quot;);
-    game.state.galaxy[quadx][quady].stars--;
+    game.state.galaxy[game.quadx][game.quady].stars--;
     game.state.starkl++;
 	
     /* Set up stack to recursively trigger adjacent stars */
@@ -459,34 +459,34 @@
 			top2++;
 			hits[top2][1]=ii;
 			hits[top2][2]=jj;
-			game.state.galaxy[quadx][quady].stars -= 1;
+			game.state.galaxy[game.quadx][game.quady].stars -= 1;
 			game.state.starkl++;
 			crmena(1, IHSTAR, 2, ii, jj);
 			prout(&quot; novas.&quot;);
 			game.quad[ii][jj] = IHDOT;
 			break;
 		    case IHP: /* Destroy planet */
-			game.state.galaxy[quadx][quady].planets -= 1;
+			game.state.galaxy[game.quadx][game.quady].planets -= 1;
 			game.state.nplankl++;
 			crmena(1, IHP, 2, ii, jj);
 			prout(&quot; destroyed.&quot;);
-			DESTROY(&amp;game.state.plnets[iplnet]);
-			iplnet = plnetx = plnety = 0;
-			if (landed == 1) {
+			DESTROY(&amp;game.state.plnets[game.iplnet]);
+			game.iplnet = game.plnetx = game.plnety = 0;
+			if (game.landed == 1) {
 			    finish(FPNOVA);
 			    return;
 			}
 			game.quad[ii][jj] = IHDOT;
 			break;
 		    case IHB: /* Destroy base */
-			game.state.galaxy[quadx][quady].starbase = FALSE;
+			game.state.galaxy[game.quadx][game.quady].starbase = FALSE;
 			for_starbases(i)
-			    if (game.state.baseqx[i]==quadx &amp;&amp; game.state.baseqy[i]==quady) 
+			    if (game.state.baseqx[i]==game.quadx &amp;&amp; game.state.baseqy[i]==game.quady) 
 				break;
 			game.state.baseqx[i] = game.state.baseqx[game.state.rembase];
 			game.state.baseqy[i] = game.state.baseqy[game.state.rembase];
 			game.state.rembase--;
-			basex = basey = 0;
+			game.basex = game.basey = 0;
 			game.state.basekl++;
 			newcnd();
 			crmena(1, IHB, 2, ii, jj);
@@ -496,25 +496,25 @@
 		    case IHE: /* Buffet ship */
 		    case IHF:
 			prout(&quot;***Starship buffeted by nova.&quot;);
-			if (shldup) {
-			    if (shield &gt;= 2000.0) shield -= 2000.0;
+			if (game.shldup) {
+			    if (game.shield &gt;= 2000.0) game.shield -= 2000.0;
 			    else {
-				double diff = 2000.0 - shield;
-				energy -= diff;
-				shield = 0.0;
-				shldup = 0;
+				double diff = 2000.0 - game.shield;
+				game.energy -= diff;
+				game.shield = 0.0;
+				game.shldup = 0;
 				prout(&quot;***Shields knocked out.&quot;);
-				game.damage[DSHIELD] += 0.005*damfac*Rand()*diff;
+				game.damage[DSHIELD] += 0.005*game.damfac*Rand()*diff;
 			    }
 			}
-			else energy -= 2000.0;
-			if (energy &lt;= 0) {
+			else game.energy -= 2000.0;
+			if (game.energy &lt;= 0) {
 			    finish(FNOVA);
 			    return;
 			}
 			/* add in course nova contributes to kicking starship*/
-			icx += sectx-hits[mm][1];
-			icy += secty-hits[mm][2];
+			icx += game.sectx-hits[mm][1];
+			icy += game.secty-hits[mm][2];
 			kount++;
 			break;
 		    case IHK: /* kill klingon */
@@ -558,7 +558,7 @@
 			game.quad[newcx][newcy] = iquad;
 			game.kx[ll] = newcx;
 			game.ky[ll] = newcy;
-			game.kavgd[ll] = sqrt(square(sectx-newcx)+square(secty-newcy));
+			game.kavgd[ll] = sqrt(square(game.sectx-newcx)+square(game.secty-newcy));
 			game.kdist[ll] = game.kavgd[ll];
 			skip(1);
 			break;
@@ -573,18 +573,18 @@
 	return;
 
     /* Starship affected by nova -- kick it away. */
-    dist = kount*0.1;
+    game.dist = kount*0.1;
     if (icx) icx = (icx &lt; 0 ? -1 : 1);
     if (icy) icy = (icy &lt; 0 ? -1 : 1);
-    direc = course[3*(icx+1)+icy+2];
-    if (direc == 0.0) dist = 0.0;
-    if (dist == 0.0) return;
-    Time = 10.0*dist/16.0;
+    game.direc = course[3*(icx+1)+icy+2];
+    if (game.direc == 0.0) game.dist = 0.0;
+    if (game.dist == 0.0) return;
+    game.optime = 10.0*game.dist/16.0;
     skip(1);
     prout(&quot;Force of nova displaces starship.&quot;);
-    iattak=2;	/* Eliminates recursion problem */
+    game.iattak=2;	/* Eliminates recursion problem */
     imove();
-    Time = 10.0*dist/16.0;
+    game.optime = 10.0*game.dist/16.0;
     return;
 }
 	
@@ -601,8 +601,8 @@
     if (insy== 0) {
 	if (insx == 1) {
 	    /* NOVAMAX being used */
-	    nqx = probecx;
-	    nqy = probecy;
+	    nqx = game.probecx;
+	    nqy = game.probecy;
 	}
 	else {
 	    int stars = 0;
@@ -624,19 +624,19 @@
 		if (num &lt;=0) break;
 	    }
 #ifdef DEBUG
-	    if (idebug) {
+	    if (game.idebug) {
 		proutn(&quot;Super nova here?&quot;);
 		if (ja()==1) {
-		    nqx = quadx;
-		    nqy = quady;
+		    nqx = game.quadx;
+		    nqy = game.quady;
 		}
 	    }
 #endif
 	}
 
-	if (nqx != quady || nqy != quady || justin != 0) {
+	if (nqx != game.quady || nqy != game.quady || game.justin != 0) {
 	    /* it isn't here, or we just entered (treat as inroute) */
-	    if (game.damage[DRADIO] == 0.0 || condit == IHDOCKED) {
+	    if (game.damage[DRADIO] == 0.0 || game.condit == IHDOCKED) {
 		skip(1);
 		prout(&quot;Message from Starfleet Command       Stardate %.2f&quot;, game.state.date);
 		prout(&quot;     Supernova in %s; caution advised.&quot;,
@@ -667,14 +667,14 @@
 	prouts(&quot;***RED ALERT!  RED ALERT!&quot;);
 	skip(1);
 	prout(&quot;***Incipient supernova detected at &quot;, cramlc(sector, nsx, nsy));
-	nqx = quadx;
-	nqy = quady;
-	if (square(nsx-sectx) + square(nsy-secty) &lt;= 2.1) {
+	nqx = game.quadx;
+	nqy = game.quady;
+	if (square(nsx-game.sectx) + square(nsy-game.secty) &lt;= 2.1) {
 	    proutn(&quot;Emergency override attempts t&quot;);
 	    prouts(&quot;***************&quot;);
 	    skip(1);
 	    stars();
-	    alldone=1;
+	    game.alldone=1;
 	}
     }
     /* destroy any Klingons in supernovaed quadrant */
@@ -683,7 +683,7 @@
     comdead = iscdead = 0;
     if (nqx==game.state.isx &amp;&amp; nqy == game.state.isy) {
 	/* did in the Supercommander! */
-	game.state.nscrem = game.state.isx = game.state.isy = isatb = iscate = 0;
+	game.state.nscrem = game.state.isx = game.state.isy = game.isatb = game.iscate = 0;
 	iscdead = 1;
 	game.future[FSCMOVE] = game.future[FSCDBAS] = FOREVER;
     }
@@ -710,7 +710,7 @@
     npdead = num - nrmdead*10;
     if (npdead) {
 	int l;
-	for (l = 0; l &lt; inplan; l++)
+	for (l = 0; l &lt; game.inplan; l++)
 	    if (game.state.plnets[l].x == nqx &amp;&amp; game.state.plnets[l].y == nqy) {
 		DESTROY(&amp;game.state.plnets[l]);
 	    }
@@ -734,12 +734,12 @@
 	game.state.nplankl += npdead;
     }
     /* mark supernova in galaxy and in star chart */
-    if ((quadx == nqx &amp;&amp; quady == nqy) ||
+    if ((game.quadx == nqx &amp;&amp; game.quady == nqy) ||
 	game.damage[DRADIO] == 0 ||
-	condit == IHDOCKED)
+	game.condit == IHDOCKED)
 	game.state.galaxy[nqx][nqy].supernova = TRUE;
     /* If supernova destroys last klingons give special message */
-    if (KLINGREM==0 &amp;&amp; (nqx != quadx || nqy != quady)) {
+    if (KLINGREM==0 &amp;&amp; (nqx != game.quadx || nqy != game.quady)) {
 	skip(2);
 	if (insx == 0) prout(&quot;Lucky you!&quot;);
 	proutn(&quot;A supernova in %s has just destroyed the last Klingons.&quot;,
@@ -748,7 +748,7 @@
 	return;
     }
     /* if some Klingons remain, continue or die in supernova */
-    if (alldone) finish(FSNOVAED);
+    if (game.alldone) finish(FSNOVAED);
     return;
 }
 		

Modified: trunk/src/finish.c
===================================================================
--- trunk/src/finish.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/finish.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -48,17 +48,17 @@
 void kaboom(void) 
 {
     stars();
-    if (ship==IHE) prouts(&quot;***&quot;);
+    if (game.ship==IHE) prouts(&quot;***&quot;);
     prouts(&quot;********* Entropy of &quot;);
     crmshp();
     prouts(&quot; maximized *********&quot;);
     skip(1);
     stars();
     skip(1);
-    if (nenhere != 0) {
-	double whammo = 25.0 * energy;
+    if (game.nenhere != 0) {
+	double whammo = 25.0 * game.energy;
 	int l=1;
-	while (l &lt;= nenhere) {
+	while (l &lt;= game.nenhere) {
 	    if (game.kpower[l]*game.kdist[l] &lt;= whammo) 
 		deadkl(game.kx[l],game.ky[l], game.quad[game.kx[l]][game.ky[l]], game.kx[l], game.ky[l]);
 	    l++;
@@ -71,7 +71,7 @@
 void finish(FINTYPE ifin) 
 {
     int igotit = 0;
-    alldone = 1;
+    game.alldone = 1;
     skip(3);
     prout(&quot;It is stardate %.1f.&quot;, game.state.date);
     skip(1);
@@ -83,21 +83,21 @@
 
 	prout(&quot;You have smashed the Klingon invasion fleet and saved&quot;);
 	prout(&quot;the Federation.&quot;);
-	gamewon=1;
-	if (alive) {
+	game.gamewon=1;
+	if (game.alive) {
 	    double badpt;
-	    badpt = 5.0*game.state.starkl + casual + 10.0*game.state.nplankl +
-		45.*nhelp+100.*game.state.basekl;
-	    if (ship == IHF) badpt += 100.0;
-	    else if (ship == 0) badpt += 200.0;
+	    badpt = 5.0*game.state.starkl + game.casual + 10.0*game.state.nplankl +
+		45.*game.nhelp+100.*game.state.basekl;
+	    if (game.ship == IHF) badpt += 100.0;
+	    else if (game.ship == 0) badpt += 200.0;
 	    if (badpt &lt; 100.0) badpt = 0.0;	// Close enough!
-	    if (game.state.date-indate &lt; 5.0 ||
+	    if (game.state.date-game.indate &lt; 5.0 ||
 		// killsPerDate &gt;= RateMax
-		KLINGKILLED/(game.state.date-indate) &gt;=
-		0.1*skill*(skill+1.0) + 0.1 + 0.008*badpt) {
+		KLINGKILLED/(game.state.date-game.indate) &gt;=
+		0.1*game.skill*(game.skill+1.0) + 0.1 + 0.008*badpt) {
 		skip(1);
 		prout(&quot;In fact, you have done so well that Starfleet Command&quot;);
-		switch (skill) {
+		switch (game.skill) {
 		case SKILL_NOVICE:
 		    prout(&quot;promotes you one step in rank from \&quot;Novice\&quot; to \&quot;Fair\&quot;.&quot;);
 		    break;
@@ -132,10 +132,10 @@
 		    skip(1);
 		    break;
 		}
-		if (skill &gt;= SKILL_EXPERT) {
-		    if (thawed
+		if (game.skill &gt;= SKILL_EXPERT) {
+		    if (game.thawed
 #ifdef DEBUG
-			&amp;&amp; !idebug
+			&amp;&amp; !game.idebug
 #endif
 			)
 			prout(&quot;You cannot get a citation, so...&quot;);
@@ -168,7 +168,7 @@
 	else {
 	    prout(&quot;found guilty and&quot;);
 	    prout(&quot;sentenced to death by slow torture.&quot;);
-	    alive = 0;
+	    game.alive = 0;
 	}
 	score();
 	return;
@@ -282,12 +282,12 @@
 	prout(&quot;You are crushed into extremely dense matter.&quot;);
 	break;
     }
-    if (ship==IHF) ship= 0;
-    else if (ship == IHE) ship = IHF;
-    alive = 0;
+    if (game.ship==IHF) game.ship= 0;
+    else if (game.ship == IHE) game.ship = IHF;
+    game.alive = 0;
     if (KLINGREM != 0) {
-	double goodies = game.state.remres/inresor;
-	double baddies = (game.state.remkl + 2.0*game.state.remcom)/(inkling+2.0*incom);
+	double goodies = game.state.remres/game.inresor;
+	double baddies = (game.state.remkl + 2.0*game.state.remcom)/(game.inkling+2.0*game.incom);
 	if (goodies/baddies &gt;= 1.0+0.5*Rand()) {
 	    prout(&quot;As a result of your actions, a treaty with the Klingon&quot;);
 	    prout(&quot;Empire has been signed. The terms of the treaty are&quot;);
@@ -307,30 +307,30 @@
 	prout(&quot;martyr and a hero. Someday maybe they'll erect a&quot;);
 	prout(&quot;statue in your memory. Rest in peace, and try not&quot;);
 	prout(&quot;to think about pigeons.&quot;);
-	gamewon = 1;
+	game.gamewon = 1;
     }
     score();
 }
 
 void score(void) 
 {
-    double timused = game.state.date - indate;
+    double timused = game.state.date - game.indate;
     int ithperd, iwon, klship;
 
-    iskill = skill;
+    iskill = game.skill;
     if ((timused == 0 || KLINGREM != 0) &amp;&amp; timused &lt; 5.0) timused = 5.0;
     perdate = KLINGKILLED/timused;
     ithperd = 500*perdate + 0.5;
     iwon = 0;
-    if (gamewon) iwon = 100*skill;
-    if (ship == IHE) klship = 0;
-    else if (ship == IHF) klship = 1;
+    if (game.gamewon) iwon = 100*game.skill;
+    if (game.ship == IHE) klship = 0;
+    else if (game.ship == IHF) klship = 1;
     else klship = 2;
-    if (gamewon == 0) game.state.nromrem = 0; // None captured if no win
+    if (game.gamewon == 0) game.state.nromrem = 0; // None captured if no win
     iscore = 10*NKILLK + 50*NKILLC + ithperd + iwon
-	- 100*game.state.basekl - 100*klship - 45*nhelp -5*game.state.starkl - casual
+	- 100*game.state.basekl - 100*klship - 45*game.nhelp -5*game.state.starkl - game.casual
 	+ 20*NKILLROM + 200*NKILLSC - 10*game.state.nplankl + game.state.nromrem;
-    if (alive == 0) iscore -= 200;
+    if (game.alive == 0) iscore -= 200;
     skip(2);
     prout(&quot;Your score --&quot;);
     if (NKILLROM)
@@ -360,20 +360,20 @@
     if (game.state.basekl)
 	prout(&quot;%6d bases destroyed by your action     %5d&quot;,
 	      game.state.basekl, -100*game.state.basekl);
-    if (nhelp)
+    if (game.nhelp)
 	prout(&quot;%6d calls for help from starbase       %5d&quot;,
-	      nhelp, -45*nhelp);
-    if (casual)
+	      game.nhelp, -45*game.nhelp);
+    if (game.casual)
 	prout(&quot;%6d casualties incurred                %5d&quot;,
-	      casual, -casual);
+	      game.casual, -game.casual);
     if (klship)
 	prout(&quot;%6d ship(s) lost or destroyed          %5d&quot;,
 	      klship, -100*klship);
-    if (alive==0)
+    if (game.alive==0)
 	prout(&quot;Penalty for getting yourself killed        -200&quot;);
-    if (gamewon) {
+    if (game.gamewon) {
 	proutn(&quot;Bonus for winning &quot;);
-	switch (skill) {
+	switch (game.skill) {
 	case SKILL_NOVICE:   proutn(&quot;Novice game  &quot;); break;
 	case SKILL_FAIR:     proutn(&quot;Fair game    &quot;); break;
 	case SKILL_GOOD:     proutn(&quot;Good game    &quot;); break;

Modified: trunk/src/io.c
===================================================================
--- trunk/src/io.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/io.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -81,13 +81,13 @@
     char *prompt;
     char buf[BUFSIZ];
     if (i==1) {
-	if (skill &gt; SKILL_FAIR)
+	if (game.skill &gt; SKILL_FAIR)
 	    prompt = &quot;[ANOUNCEMENT ARRIVING...]&quot;;
 	else
 	    prompt = &quot;[IMPORTANT ANNOUNCEMENT ARRIVING -- PRESS ENTER TO CONTINUE]&quot;;
     }
     else {
-	if (skill &gt; SKILL_FAIR)
+	if (game.skill &gt; SKILL_FAIR)
 	    prompt = &quot;[CONTINUE?]&quot;;
 	else
 	    prompt = &quot;[PRESS ENTER TO CONTINUE]&quot;;
@@ -383,7 +383,7 @@
 	    skip(1);
 	proutn(&quot;%d - %d   &quot;, ix, iy);
     } else {
-	if (game.damage[DSRSENS]==0 || condit==IHDOCKED) {
+	if (game.damage[DSRSENS]==0 || game.condit==IHDOCKED) {
 	    if (i != 1 &amp;&amp; l == 1) {
 		drawmaps(2);
 		delay(400);

Modified: trunk/src/moving.c
===================================================================
--- trunk/src/moving.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/moving.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -10,12 +10,12 @@
         finald, finalx, finaly, stopegy, probf;
     int trbeam = 0, n, l, ix=0, iy=0, kink, kinks, iquad;
 
-    if (inorbit) {
+    if (game.inorbit) {
 	prout(&quot;Helmsman Sulu- \&quot;Leaving standard orbit.\&quot;&quot;);
-	inorbit = FALSE;
+	game.inorbit = FALSE;
     }
 
-    angle = ((15.0 - direc) * 0.5235988);
+    angle = ((15.0 - game.direc) * 0.5235988);
     deltax = -sin(angle);
     deltay = cos(angle);
     if (fabs(deltax) &gt; fabs(deltay))
@@ -27,17 +27,17 @@
     deltax /= bigger;
 
     /* If tractor beam is to occur, don't move full distance */
-    if (game.state.date+Time &gt;= game.future[FTBEAM]) {
+    if (game.state.date+game.optime &gt;= game.future[FTBEAM]) {
 	trbeam = 1;
-	condit = IHRED;
-	dist = dist*(game.future[FTBEAM]-game.state.date)/Time + 0.1;
-	Time = game.future[FTBEAM] - game.state.date + 1e-5;
+	game.condit = IHRED;
+	game.dist = game.dist*(game.future[FTBEAM]-game.state.date)/game.optime + 0.1;
+	game.optime = game.future[FTBEAM] - game.state.date + 1e-5;
     }
     /* Move within the quadrant */
-    game.quad[sectx][secty] = IHDOT;
-    x = sectx;
-    y = secty;
-    n = 10.0*dist*bigger+0.5;
+    game.quad[game.sectx][game.secty] = IHDOT;
+    x = game.sectx;
+    y = game.secty;
+    n = 10.0*game.dist*bigger+0.5;
 
     if (n &gt; 0) {
 	for (l = 1; l &lt;= n; l++) {
@@ -46,7 +46,7 @@
 	    if (!VALID_SECTOR(ix, iy)) {
 		/* Leaving quadrant -- allow final enemy attack */
 		/* Don't do it if being pushed by Nova */
-		if (nenhere != 0 &amp;&amp; iattak != 2) {
+		if (game.nenhere != 0 &amp;&amp; game.iattak != 2) {
 		    newcnd();
 		    for_local_enemies(l) {
 			finald = sqrt((ix-game.kx[l])*(double)(ix-game.kx[l]) +
@@ -54,19 +54,19 @@
 			game.kavgd[l] = 0.5 * (finald+game.kdist[l]);
 		    }
 		    /*
-		     * Stas Sergeev added the condition
+		     * Stas Sergeev added the game.condition
 		     * that attacks only happen if Klingons
 		     * are present and your skill is good.
 		     */
-		    if (skill &gt; SKILL_GOOD &amp;&amp; klhere &gt; 0 &amp;&amp; !game.state.galaxy[quadx][quady].supernova)
+		    if (game.skill &gt; SKILL_GOOD &amp;&amp; game.klhere &gt; 0 &amp;&amp; !game.state.galaxy[game.quadx][game.quady].supernova)
 			attack(0);
-		    if (alldone) return;
+		    if (game.alldone) return;
 		}
 		/* compute final position -- new quadrant and sector */
-		x = QUADSIZE*(quadx-1)+sectx;
-		y = QUADSIZE*(quady-1)+secty;
-		ix = x+10.0*dist*bigger*deltax+0.5;
-		iy = y+10.0*dist*bigger*deltay+0.5;
+		x = QUADSIZE*(game.quadx-1)+game.sectx;
+		y = QUADSIZE*(game.quady-1)+game.secty;
+		ix = x+10.0*game.dist*bigger*deltax+0.5;
+		iy = y+10.0*game.dist*bigger*deltay+0.5;
 		/* check for edge of galaxy */
 		kinks = 0;
 		do {
@@ -91,8 +91,8 @@
 		} while (kink);
 
 		if (kinks) {
-		    nkinks += 1;
-		    if (nkinks == 3) {
+		    game.nkinks += 1;
+		    if (game.nkinks == 3) {
 			/* Three strikes -- you're out! */
 			finish(FNEG3);
 			return;
@@ -104,24 +104,24 @@
 		}
 		/* Compute final position in new quadrant */
 		if (trbeam) return; /* Don't bother if we are to be beamed */
-		quadx = (ix+(QUADSIZE-1))/QUADSIZE;
-		quady = (iy+(QUADSIZE-1))/QUADSIZE;
-		sectx = ix - QUADSIZE*(quadx-1);
-		secty = iy - QUADSIZE*(quady-1);
+		game.quadx = (ix+(QUADSIZE-1))/QUADSIZE;
+		game.quady = (iy+(QUADSIZE-1))/QUADSIZE;
+		game.sectx = ix - QUADSIZE*(game.quadx-1);
+		game.secty = iy - QUADSIZE*(game.quady-1);
 		skip(1);
 		prout(&quot;Entering %s.&quot;,
-		      cramlc(quadrant, quadx, quady));
-		game.quad[sectx][secty] = ship;
+		      cramlc(quadrant, game.quadx, game.quady));
+		game.quad[game.sectx][game.secty] = game.ship;
 		newqad(0);
-		if (skill&gt;SKILL_NOVICE) attack(0);
+		if (game.skill&gt;SKILL_NOVICE) attack(0);
 		return;
 	    }
 	    iquad = game.quad[ix][iy];
 	    if (iquad != IHDOT) {
 		/* object encountered in flight path */
-		stopegy = 50.0*dist/Time;
-		dist=0.1*sqrt((sectx-ix)*(double)(sectx-ix) +
-			      (secty-iy)*(double)(secty-iy));
+		stopegy = 50.0*game.dist/game.optime;
+		game.dist=0.1*sqrt((game.sectx-ix)*(double)(game.sectx-ix) +
+			      (game.secty-iy)*(double)(game.secty-iy));
 		switch (iquad) {
 		case IHT: /* Ram a Tholian */
 		case IHK: /* Ram enemy ship */
@@ -129,11 +129,11 @@
 		case IHS:
 		case IHR:
 		case IHQUEST:
-		    sectx = ix;
-		    secty = iy;
-		    ram(0, iquad, sectx, secty);
-		    finalx = sectx;
-		    finaly = secty;
+		    game.sectx = ix;
+		    game.secty = iy;
+		    ram(0, iquad, game.sectx, game.secty);
+		    finalx = game.sectx;
+		    finaly = game.secty;
 		    break;
 		case IHBLANK:
 		    skip(1);
@@ -152,7 +152,7 @@
 		    for (l=0;l&lt;NDEVICES;l++)
 			if (game.damage[l]&gt;0) 
 			    n++;
-		    probf=pow(1.4,(energy+shield)/5000.0-1.0)*pow(1.3,1.0/(n+1)-1.0);
+		    probf=pow(1.4,(game.energy+game.shield)/5000.0-1.0)*pow(1.3,1.0/(n+1)-1.0);
 		    if ((game.options &amp; OPTION_BLKHOLE) &amp;&amp; Rand()&gt;probf) 
 			timwrp();
 		    else 
@@ -170,12 +170,12 @@
 		    prout(&quot;;&quot;);
 		    proutn(&quot;Emergency stop required &quot;);
 		    prout(&quot;%2d units of energy.&quot;, (int)stopegy);
-		    energy -= stopegy;
+		    game.energy -= stopegy;
 		    finalx = x-deltax+0.5;
-		    sectx = finalx;
+		    game.sectx = finalx;
 		    finaly = y-deltay+0.5;
-		    secty = finaly;
-		    if (energy &lt;= 0) {
+		    game.secty = finaly;
+		    if (game.energy &lt;= 0) {
 			finish(FNRG);
 			return;
 		    }
@@ -184,17 +184,17 @@
 		goto no_quad_change;	/* sorry! */
 	    }
 	}
-	dist = 0.1*sqrt((sectx-ix)*(double)(sectx-ix) +
-			(secty-iy)*(double)(secty-iy));
-	sectx = ix;
-	secty = iy;
+	game.dist = 0.1*sqrt((game.sectx-ix)*(double)(game.sectx-ix) +
+			(game.secty-iy)*(double)(game.secty-iy));
+	game.sectx = ix;
+	game.secty = iy;
     }
-    finalx = sectx;
-    finaly = secty;
+    finalx = game.sectx;
+    finaly = game.secty;
 no_quad_change:
     /* No quadrant change -- compute new avg enemy distances */
-    game.quad[sectx][secty] = ship;
-    if (nenhere) {
+    game.quad[game.sectx][game.secty] = game.ship;
+    if (game.nenhere) {
 	for_local_enemies(l) {
 	    finald = sqrt((ix-game.kx[l])*(double)(ix-game.kx[l]) +
 			  (iy-game.ky[l])*(double)(iy-game.ky[l]));
@@ -202,12 +202,12 @@
 	    game.kdist[l] = finald;
 	}
 	sortkl();
-	if (!game.state.galaxy[quadx][quady].supernova &amp;&amp; iattak == 0)
+	if (!game.state.galaxy[game.quadx][game.quady].supernova &amp;&amp; game.iattak == 0)
 	    attack(0);
 	for_local_enemies(l) game.kavgd[l] = game.kdist[l];
     }
     newcnd();
-    iattak = 0;
+    game.iattak = 0;
     drawmaps(0);
     setwnd(message_window);
     return;
@@ -216,32 +216,32 @@
 void dock(int l) 
 {
     chew();
-    if (condit == IHDOCKED &amp;&amp; l) {
+    if (game.condit == IHDOCKED &amp;&amp; l) {
 	prout(&quot;Already docked.&quot;);
 	return;
     }
-    if (inorbit) {
+    if (game.inorbit) {
 	prout(&quot;You must first leave standard orbit.&quot;);
 	return;
     }
-    if (basex==0 || abs(sectx-basex) &gt; 1 || abs(secty-basey) &gt; 1) {
+    if (game.basex==0 || abs(game.sectx-game.basex) &gt; 1 || abs(game.secty-game.basey) &gt; 1) {
 	crmshp();
 	prout(&quot; not adjacent to base.&quot;);
 	return;
     }
-    condit = IHDOCKED;
+    game.condit = IHDOCKED;
     if (l) prout(&quot;Docked.&quot;);
-    ididit=1;
-    if (energy &lt; inenrg) energy = inenrg;
-    shield = inshld;
-    torps = intorps;
-    lsupres = inlsr;
+    game.ididit=1;
+    if (game.energy &lt; game.inenrg) game.energy = game.inenrg;
+    game.shield = game.inshld;
+    game.torps = game.intorps;
+    game.lsupres = game.inlsr;
     if (game.damage[DRADIO] == 0.0 &amp;&amp;
-	(game.future[FCDBAS] &lt; FOREVER || isatb == 1) &amp;&amp; iseenit == 0) {
+	(game.future[FCDBAS] &lt; FOREVER || game.isatb == 1) &amp;&amp; game.iseenit == 0) {
 	/* get attack report from base */
 	prout(&quot;Lt. Uhura- \&quot;Captain, an important message from the starbase:\&quot;&quot;);
 	attakreport(0);
-	iseenit = 1;
+	game.iseenit = 1;
     }
 }
 
@@ -255,7 +255,7 @@
 	   are always displayed y - x, where +y is downward! */
 
 	
-        int irowq=quadx, icolq=quady, irows, icols, itemp=0, iprompt=0, key=0;
+        int irowq=game.quadx, icolq=game.quady, irows, icols, itemp=0, iprompt=0, key=0;
 	double xi, xj, xk, xl;
 	double deltax, deltay;
 	int automatic = -1;
@@ -263,9 +263,9 @@
 	/* Get course direction and distance. If user types bad values, return
 	   with DIREC = -1.0. */
 
-	direc = -1.0;
+	game.direc = -1.0;
 	
-	if (landed == 1 &amp;&amp; !isprobe) {
+	if (game.landed == 1 &amp;&amp; !isprobe) {
 		prout(&quot;Dummy! You can't leave standard orbit until you&quot;);
 		proutn(&quot;are back aboard the &quot;);
 		crmshp();
@@ -389,8 +389,8 @@
 			}
 			else prout(&quot;Ensign Chekov- \&quot;Course laid in, Captain.\&quot;&quot;);
 		}
-		deltax = icolq - quady + 0.1*(icols-secty);
-		deltay = quadx - irowq + 0.1*(sectx-irows);
+		deltax = icolq - game.quady + 0.1*(icols-game.secty);
+		deltay = game.quadx - irowq + 0.1*(game.sectx-irows);
 	}
 	else { /* manual */
 		while (key == IHEOL) {
@@ -421,9 +421,9 @@
 		skip(1);
 		prout(&quot;Helmsman Sulu- \&quot;Aye, Sir.\&quot;&quot;);
 	}
-	dist = sqrt(deltax*deltax + deltay*deltay);
-	direc = atan2(deltax, deltay)*1.90985932;
-	if (direc &lt; 0.0) direc += 12.0;
+	game.dist = sqrt(deltax*deltax + deltay*deltay);
+	game.direc = atan2(deltax, deltay)*1.90985932;
+	if (game.direc &lt; 0.0) game.direc += 12.0;
 	chew();
 	return;
 
@@ -435,7 +435,7 @@
 {
     double power;
 
-    ididit = 0;
+    game.ididit = 0;
     if (game.damage[DIMPULS]) {
 	chew();
 	skip(1);
@@ -443,22 +443,22 @@
 	return;
     }
 
-    if (energy &gt; 30.0) {
+    if (game.energy &gt; 30.0) {
 	getcd(FALSE, 0);
-	if (direc == -1.0) return;
-	power = 20.0 + 100.0*dist;
+	if (game.direc == -1.0) return;
+	power = 20.0 + 100.0*game.dist;
     }
     else
 	power = 30.0;
 
-    if (power &gt;= energy) {
+    if (power &gt;= game.energy) {
 	/* Insufficient power for trip */
 	skip(1);
 	prout(&quot;First Officer Spock- \&quot;Captain, the impulse engines&quot;);
 	prout(&quot;require 20.0 units to engage, plus 100.0 units per&quot;);
-	if (energy &gt; 30) {
+	if (game.energy &gt; 30) {
 	    proutn(&quot;quadrant.  We can go, therefore, a maximum of %d&quot;, 
-		   (int)(0.01 * (energy-20.0)-0.05));
+		   (int)(0.01 * (game.energy-20.0)-0.05));
 	    prout(&quot; quadrants.\&quot;&quot;);
 	}
 	else {
@@ -468,8 +468,8 @@
 	return;
     }
     /* Make sure enough time is left for the trip */
-    Time = dist/0.095;
-    if (Time &gt;= game.state.remtime) {
+    game.optime = game.dist/0.095;
+    if (game.optime &gt;= game.state.remtime) {
 	prout(&quot;First Officer Spock- \&quot;Captain, our speed under impulse&quot;);
 	prout(&quot;power is only 0.95 sectors per stardate. Are you sure&quot;);
 	proutn(&quot;we dare spend the time?\&quot; &quot;);
@@ -477,12 +477,12 @@
     }
     /* Activate impulse engines and pay the cost */
     imove();
-    ididit = 1;
-    if (alldone) return;
-    power = 20.0 + 100.0*dist;
-    energy -= power;
-    Time = dist/0.095;
-    if (energy &lt;= 0) finish(FNRG);
+    game.ididit = 1;
+    if (game.alldone) return;
+    power = 20.0 + 100.0*game.dist;
+    game.energy -= power;
+    game.optime = game.dist/0.095;
+    if (game.energy &lt;= 0) finish(FNRG);
     return;
 }
 
@@ -493,14 +493,14 @@
     double power;
 
     if (i!=2) { /* Not WARPX entry */
-	ididit = 0;
+	game.ididit = 0;
 	if (game.damage[DWARPEN] &gt; 10.0) {
 	    chew();
 	    skip(1);
 	    prout(&quot;Engineer Scott- \&quot;The impulse engines are damaged, Sir.\&quot;&quot;);
 	    return;
 	}
-	if (game.damage[DWARPEN] &gt; 0.0 &amp;&amp; warpfac &gt; 4.0) {
+	if (game.damage[DWARPEN] &gt; 0.0 &amp;&amp; game.warpfac &gt; 4.0) {
 	    chew();
 	    skip(1);
 	    prout(&quot;Engineer Scott- \&quot;Sorry, Captain. Until this damage&quot;);
@@ -510,25 +510,25 @@
 			
 	/* Read in course and distance */
 	getcd(FALSE, 0);
-	if (direc == -1.0) return;
+	if (game.direc == -1.0) return;
 
 	/* Make sure starship has enough energy for the trip */
-	power = (dist+0.05)*warpfac*warpfac*warpfac*(shldup+1);
+	power = (game.dist+0.05)*game.warpfac*game.warpfac*game.warpfac*(game.shldup+1);
 
 
-	if (power &gt;= energy) {
+	if (power &gt;= game.energy) {
 	    /* Insufficient power for trip */
-	    ididit = 0;
+	    game.ididit = 0;
 	    skip(1);
 	    prout(&quot;Engineering to bridge--&quot;);
-	    if (shldup==0 || 0.5*power &gt; energy) {
-		iwarp = pow((energy/(dist+0.05)), 0.333333333);
+	    if (game.shldup==0 || 0.5*power &gt; game.energy) {
+		iwarp = pow((game.energy/(game.dist+0.05)), 0.333333333);
 		if (iwarp &lt;= 0) {
 		    prout(&quot;We can't do it, Captain. We haven't the energy.&quot;);
 		}
 		else {
 		    proutn(&quot;We haven't the energy, but we could do it at warp %d&quot;, iwarp);
-		    if (shldup) {
+		    if (game.shldup) {
 			prout(&quot;,&quot;);
 			prout(&quot;if you'll lower the shields.&quot;);
 		    }
@@ -542,29 +542,29 @@
 	}
 						
 	/* Make sure enough time is left for the trip */
-	Time = 10.0*dist/wfacsq;
-	if (Time &gt;= 0.8*game.state.remtime) {
+	game.optime = 10.0*game.dist/game.wfacsq;
+	if (game.optime &gt;= 0.8*game.state.remtime) {
 	    skip(1);
 	    prout(&quot;First Officer Spock- \&quot;Captain, I compute that such&quot;);
 	    proutn(&quot;  a trip would require approximately %2.0f&quot;,
-		   100.0*Time/game.state.remtime);
+		   100.0*game.optime/game.state.remtime);
 	    prout(&quot; percent of our&quot;);
 	    proutn(&quot;  remaining time.  Are you sure this is wise?\&quot; &quot;);
-	    if (ja() == 0) { ididit = 0; Time=0; return;}
+	    if (ja() == 0) { game.ididit = 0; game.optime=0; return;}
 	}
     }
     /* Entry WARPX */
-    if (warpfac &gt; 6.0) {
+    if (game.warpfac &gt; 6.0) {
 	/* Decide if engine damage will occur */
-	double prob = dist*(6.0-warpfac)*(6.0-warpfac)/66.666666666;
+	double prob = game.dist*(6.0-game.warpfac)*(6.0-game.warpfac)/66.666666666;
 	if (prob &gt; Rand()) {
 	    blooey = 1;
-	    dist = Rand()*dist;
+	    game.dist = Rand()*game.dist;
 	}
 	/* Decide if time warp will occur */
-	if (0.5*dist*pow(7.0,warpfac-10.0) &gt; Rand()) twarp=1;
+	if (0.5*game.dist*pow(7.0,game.warpfac-10.0) &gt; Rand()) twarp=1;
 #ifdef DEBUG
-	if (idebug &amp;&amp;warpfac==10 &amp;&amp; twarp==0) {
+	if (game.idebug &amp;&amp;game.warpfac==10 &amp;&amp; twarp==0) {
 	    blooey=0;
 	    proutn(&quot;Force time warp? &quot;);
 	    if (ja()==1) twarp=1;
@@ -573,7 +573,7 @@
 	if (blooey || twarp) {
 	    /* If time warp or engine damage, check path */
 	    /* If it is obstructed, don't do warp or damage */
-	    double angle = ((15.0-direc)*0.5235998);
+	    double angle = ((15.0-game.direc)*0.5235998);
 	    double deltax = -sin(angle);
 	    double deltay = cos(angle);
 	    double bigger, x, y;
@@ -585,9 +585,9 @@
 			
 	    deltax /= bigger;
 	    deltay /= bigger;
-	    n = 10.0 * dist * bigger +0.5;
-	    x = sectx;
-	    y = secty;
+	    n = 10.0 * game.dist * bigger +0.5;
+	    x = game.sectx;
+	    y = game.secty;
 	    for (l = 1; l &lt;= n; l++) {
 		x += deltax;
 		ix = x + 0.5;
@@ -605,19 +605,19 @@
 
     /* Activate Warp Engines and pay the cost */
     imove();
-    if (alldone) return;
-    energy -= dist*warpfac*warpfac*warpfac*(shldup+1);
-    if (energy &lt;= 0) finish(FNRG);
-    Time = 10.0*dist/wfacsq;
+    if (game.alldone) return;
+    game.energy -= game.dist*game.warpfac*game.warpfac*game.warpfac*(game.shldup+1);
+    if (game.energy &lt;= 0) finish(FNRG);
+    game.optime = 10.0*game.dist/game.wfacsq;
     if (twarp) timwrp();
     if (blooey) {
-	game.damage[DWARPEN] = damfac*(3.0*Rand()+1.0);
+	game.damage[DWARPEN] = game.damfac*(3.0*Rand()+1.0);
 	skip(1);
 	prout(&quot;Engineering to bridge--&quot;);
 	prout(&quot;  Scott here.  The warp engines are damaged.&quot;);
 	prout(&quot;  We'll have to reduce speed to warp 4.&quot;);
     }
-    ididit = 1;
+    game.ididit = 1;
     return;
 }
 
@@ -654,19 +654,19 @@
 	prout(&quot;Helmsman Sulu- \&quot;We can't go below warp 1, Captain.\&quot;&quot;);
 	return;
     }
-    oldfac = warpfac;
-    warpfac = aaitem;
-    wfacsq=warpfac*warpfac;
-    if (warpfac &lt;= oldfac || warpfac &lt;= 6.0) {
+    oldfac = game.warpfac;
+    game.warpfac = aaitem;
+    game.wfacsq=game.warpfac*game.warpfac;
+    if (game.warpfac &lt;= oldfac || game.warpfac &lt;= 6.0) {
 	proutn(&quot;Helmsman Sulu- \&quot;Warp factor %d, Captain.\&quot;&quot;, 
-	       (int)warpfac);
+	       (int)game.warpfac);
 	return;
     }
-    if (warpfac &lt; 8.00) {
+    if (game.warpfac &lt; 8.00) {
 	prout(&quot;Engineer Scott- \&quot;Aye, but our maximum safe speed is warp 6.\&quot;&quot;);
 	return;
     }
-    if (warpfac == 10.0) {
+    if (game.warpfac == 10.0) {
 	prout(&quot;Engineer Scott- \&quot;Aye, Captain, we'll try it.\&quot;&quot;);
 	return;
     }
@@ -680,13 +680,13 @@
 
     chew();
     /* is captain on planet? */
-    if (landed==1) {
+    if (game.landed==1) {
 	if (game.damage[DTRANSP]) {
 	    finish(FPNOVA);
 	    return;
 	}
 	prout(&quot;Scotty rushes to the transporter controls.&quot;);
-	if (shldup) {
+	if (game.shldup) {
 	    prout(&quot;But with the shields up it's hopeless.&quot;);
 	    finish(FPNOVA);
 	}
@@ -697,28 +697,28 @@
 	    return;
 	}
 	prout(&quot;SUCCEEDS!&quot;);
-	if (imine) {
-	    imine = 0;
+	if (game.imine) {
+	    game.imine = 0;
 	    proutn(&quot;The crystals mined were &quot;);
 	    if (Rand() &lt;= 0.25) {
 		prout(&quot;lost.&quot;);
 	    }
 	    else {
 		prout(&quot;saved.&quot;);
-		icrystl = 1;
+		game.icrystl = 1;
 	    }
 	}
     }
     if (igrab) return;
 
     /* Check to see if captain in shuttle craft */
-    if (icraft) finish(FSTRACTOR);
-    if (alldone) return;
+    if (game.icraft) finish(FSTRACTOR);
+    if (game.alldone) return;
 
     /* Inform captain of attempt to reach safety */
     skip(1);
     do {
-	if (justin) {
+	if (game.justin) {
 	    prouts(&quot;***RED ALERT!  READ ALERT!&quot;);
 	    skip(1);
 	    proutn(&quot;The &quot;);
@@ -732,7 +732,7 @@
 	skip(1);
 	prout(&quot;safely out of quadrant.&quot;);
 	if (game.damage[DRADIO] == 0.0)
-	    game.state.galaxy[quadx][quady].charted = TRUE;
+	    game.state.galaxy[game.quadx][game.quady].charted = TRUE;
 	/* Try to use warp engines */
 	if (game.damage[DWARPEN]) {
 	    skip(1);
@@ -740,21 +740,21 @@
 	    finish(FSNOVAED);
 	    return;
 	}
-	warpfac = 6.0+2.0*Rand();
-	wfacsq = warpfac * warpfac;
-	prout(&quot;Warp factor set to %d&quot;, (int)warpfac);
-	power = 0.75*energy;
-	dist = power/(warpfac*warpfac*warpfac*(shldup+1));
+	game.warpfac = 6.0+2.0*Rand();
+	game.wfacsq = game.warpfac * game.warpfac;
+	prout(&quot;Warp factor set to %d&quot;, (int)game.warpfac);
+	power = 0.75*game.energy;
+	game.dist = power/(game.warpfac*game.warpfac*game.warpfac*(game.shldup+1));
 	distreq = 1.4142+Rand();
-	if (distreq &lt; dist) dist = distreq;
-	Time = 10.0*dist/wfacsq;
-	direc = 12.0*Rand();	/* How dumb! */
-	justin = 0;
-	inorbit = 0;
+	if (distreq &lt; game.dist) game.dist = distreq;
+	game.optime = 10.0*game.dist/game.wfacsq;
+	game.direc = 12.0*Rand();	/* How dumb! */
+	game.justin = 0;
+	game.inorbit = 0;
 	warp(2);
-	if (justin == 0) {
+	if (game.justin == 0) {
 	    /* This is bad news, we didn't leave quadrant. */
-	    if (alldone) return;
+	    if (game.alldone) return;
 	    skip(1);
 	    prout(&quot;Insufficient energy to leave quadrant.&quot;);
 	    finish(FSNOVAED);
@@ -762,7 +762,7 @@
 	}
     } while 
 	/* Repeat if another snova */
-	(game.state.galaxy[quadx][quady].supernova);
+	(game.state.galaxy[game.quadx][game.quady].supernova);
     if (KLINGREM==0) 
 	finish(FWON); /* Snova killed remaining enemy. */
 }
@@ -778,34 +778,34 @@
 	game.state = game.snapsht;
 	game.state.snap = 0;
 	if (game.state.remcom) {
-	    game.future[FTBEAM] = game.state.date + expran(intime/game.state.remcom);
-	    game.future[FBATTAK] = game.state.date + expran(0.3*intime);
+	    game.future[FTBEAM] = game.state.date + expran(game.intime/game.state.remcom);
+	    game.future[FBATTAK] = game.state.date + expran(0.3*game.intime);
 	}
-	game.future[FSNOVA] = game.state.date + expran(0.5*intime);
+	game.future[FSNOVA] = game.state.date + expran(0.5*game.intime);
 	game.future[FSNAP] = game.state.date +expran(0.25*game.state.remtime); /* next snapshot will
 										  be sooner */
 	if (game.state.nscrem) game.future[FSCMOVE] = 0.2777;
-	isatb = 0;
+	game.isatb = 0;
 	game.future[FCDBAS] = game.future[FSCDBAS] = FOREVER;
-	batx = baty = 0;
+	game.batx = game.baty = 0;
 
 	/* Make sure Galileo is consistant -- Snapshot may have been taken
 	   when on planet, which would give us two Galileos! */
 	gotit = 0;
-	for (l = 0; l &lt; inplan; l++) {
+	for (l = 0; l &lt; game.inplan; l++) {
 	    if (game.state.plnets[l].known == shuttle_down) {
 		gotit = 1;
-		if (iscraft==1 &amp;&amp; ship==IHE) {
+		if (game.iscraft==1 &amp;&amp; game.ship==IHE) {
 		    prout(&quot;Checkov-  \&quot;Security reports the Galileo has disappeared, Sir!&quot;);
-		    iscraft = 0;
+		    game.iscraft = 0;
 		}
 	    }
 	}
 	/* Likewise, if in the original time the Galileo was abandoned, but
 	   was on ship earlier, it would have vanished -- lets restore it */
-	if (iscraft==0 &amp;&amp; gotit==0 &amp;&amp; game.damage[DSHUTTL] &gt;= 0.0) {
+	if (game.iscraft==0 &amp;&amp; gotit==0 &amp;&amp; game.damage[DSHUTTL] &gt;= 0.0) {
 	    prout(&quot;Checkov-  \&quot;Security reports the Galileo has reappeared in the dock!\&quot;&quot;);
-	    iscraft = 1;
+	    game.iscraft = 1;
 	}
 	/* 
 	 * There used to be code to do the actual reconstrction here,
@@ -815,11 +815,11 @@
     }
     else {
 	/* Go forward in time */
-	Time = -0.5*intime*log(Rand());
-	prout(&quot;You are traveling forward in time %d stardates.&quot;, (int)Time);
+	game.optime = -0.5*game.intime*log(Rand());
+	prout(&quot;You are traveling forward in time %d stardates.&quot;, (int)game.optime);
 	/* cheat to make sure no tractor beams occur during time warp */
-	game.future[FTBEAM] += Time;
-	game.damage[DRADIO] += Time;
+	game.future[FTBEAM] += game.optime;
+	game.damage[DRADIO] += game.optime;
     }
     newqad(0);
     events();	/* Stas Sergeev added this -- do pending events */
@@ -830,10 +830,10 @@
     double angle, bigger;
     int key;
     /* New code to launch a deep space probe */
-    if (nprobes == 0) {
+    if (game.nprobes == 0) {
 	chew();
 	skip(1);
-	if (ship == IHE) 
+	if (game.ship == IHE) 
 	    prout(&quot;Engineer Scott- \&quot;We have no more deep space probes, Sir.\&quot;&quot;);
 	else
 	    prout(&quot;Ye Faerie Queene has no deep space probes.&quot;);
@@ -848,7 +848,7 @@
     if (game.future[FDSPROB] != FOREVER) {
 	chew();
 	skip(1);
-	if (game.damage[DRADIO] != 0 &amp;&amp; condit != IHDOCKED) {
+	if (game.damage[DRADIO] != 0 &amp;&amp; game.condit != IHDOCKED) {
 	    prout(&quot;Spock-  \&quot;Records show the previous probe has not yet&quot;);
 	    prout(&quot;   reached its destination.\&quot;&quot;);
 	}
@@ -860,41 +860,41 @@
 
     if (key == IHEOL) {
 	/* slow mode, so let Kirk know how many probes there are left */
-	prout(nprobes==1 ? &quot;%d probe left.&quot; : &quot;%d probes left.&quot;, nprobes);
+	prout(game.nprobes==1 ? &quot;%d probe left.&quot; : &quot;%d probes left.&quot;, game.nprobes);
 	proutn(&quot;Are you sure you want to fire a probe? &quot;);
 	if (ja()==0) return;
     }
 
-    isarmed = FALSE;
+    game.isarmed = FALSE;
     if (key == IHALPHA &amp;&amp; strcmp(citem,&quot;armed&quot;) == 0) {
-	isarmed = TRUE;
+	game.isarmed = TRUE;
 	key = scan();
     }
     else if (key == IHEOL) {
 	proutn(&quot;Arm NOVAMAX warhead? &quot;);
-	isarmed = ja();
+	game.isarmed = ja();
     }
     getcd(TRUE, key);
-    if (direc == -1.0) return;
-    nprobes--;
-    angle = ((15.0 - direc) * 0.5235988);
-    probeinx = -sin(angle);
-    probeiny = cos(angle);
-    if (fabs(probeinx) &gt; fabs(probeiny))
-	bigger = fabs(probeinx);
+    if (game.direc == -1.0) return;
+    game.nprobes--;
+    angle = ((15.0 - game.direc) * 0.5235988);
+    game.probeinx = -sin(angle);
+    game.probeiny = cos(angle);
+    if (fabs(game.probeinx) &gt; fabs(game.probeiny))
+	bigger = fabs(game.probeinx);
     else
-	bigger = fabs(probeiny);
+	bigger = fabs(game.probeiny);
 		
-    probeiny /= bigger;
-    probeinx /= bigger;
-    proben = 10.0*dist*bigger +0.5;
-    probex = quadx*QUADSIZE + sectx - 1;	// We will use better packing than original
-    probey = quady*QUADSIZE + secty - 1;
-    probecx = quadx;
-    probecy = quady;
+    game.probeiny /= bigger;
+    game.probeinx /= bigger;
+    game.proben = 10.0*game.dist*bigger +0.5;
+    game.probex = game.quadx*QUADSIZE + game.sectx - 1;	// We will use better packing than original
+    game.probey = game.quady*QUADSIZE + game.secty - 1;
+    game.probecx = game.quadx;
+    game.probecy = game.quady;
     game.future[FDSPROB] = game.state.date + 0.01; // Time to move one sector
     prout(&quot;Ensign Chekov-  \&quot;The deep space probe is launched, Captain.\&quot;&quot;);
-    ididit = 1;
+    game.ididit = 1;
     return;
 }
 
@@ -905,8 +905,8 @@
     int line = 0, l, ix, iy;
 
     chew();
-    /* Test for conditions which prevent calling for help */
-    if (condit == IHDOCKED) {
+    /* Test for game.conditions which prevent calling for help */
+    if (game.condit == IHDOCKED) {
 	prout(&quot;Lt. Uhura-  \&quot;But Captain, we're already docked.\&quot;&quot;);
 	return;
     }
@@ -918,50 +918,50 @@
 	prout(&quot;Lt. Uhura-  \&quot;Captain, I'm not getting any response from Starbase.\&quot;&quot;);
 	return;
     }
-    if (landed == 1) {
+    if (game.landed == 1) {
 	proutn(&quot;You must be aboard the &quot;);
 	crmshp();
 	prout(&quot;.&quot;);
 	return;
     }
     /* OK -- call for help from nearest starbase */
-    nhelp++;
-    if (basex!=0) {
+    game.nhelp++;
+    if (game.basex!=0) {
 	/* There's one in this quadrant */
-	ddist = sqrt(square(basex-sectx)+square(basey-secty));
+	ddist = sqrt(square(game.basex-game.sectx)+square(game.basey-game.secty));
     }
     else {
 	ddist = FOREVER;
 	for_starbases(l) {
-	    xdist=10.0*sqrt(square(game.state.baseqx[l]-quadx)+square(game.state.baseqy[l]-quady));
+	    xdist=10.0*sqrt(square(game.state.baseqx[l]-game.quadx)+square(game.state.baseqy[l]-game.quady));
 	    if (xdist &lt; ddist) {
 		ddist = xdist;
 		line = l;
 	    }
 	}
 	/* Since starbase not in quadrant, set up new quadrant */
-	quadx = game.state.baseqx[line];
-	quady = game.state.baseqy[line];
+	game.quadx = game.state.baseqx[line];
+	game.quady = game.state.baseqy[line];
 	newqad(1);
     }
     /* dematerialize starship */
-    game.quad[sectx][secty]=IHDOT;
-    proutn(&quot;Starbase in %s responds--&quot;, cramlc(quadrant, quadx, quady));
+    game.quad[game.sectx][game.secty]=IHDOT;
+    proutn(&quot;Starbase in %s responds--&quot;, cramlc(quadrant, game.quadx, game.quady));
     proutn(&quot;&quot;);
     crmshp();
     prout(&quot; dematerializes.&quot;);
-    sectx=0;
+    game.sectx=0;
     for (l = 1; l &lt;= 5; l++) {
-	ix = basex+3.0*Rand()-1;
-	iy = basey+3.0*Rand()-1;
+	ix = game.basex+3.0*Rand()-1;
+	iy = game.basey+3.0*Rand()-1;
 	if (VALID_SECTOR(ix,iy) &amp;&amp; game.quad[ix][iy]==IHDOT) {
 	    /* found one -- finish up */
-	    sectx=ix;
-	    secty=iy;
+	    game.sectx=ix;
+	    game.secty=iy;
 	    break;
 	}
     }
-    if (sectx==0){
+    if (game.sectx==0){
 	prout(&quot;You have been lost in space...&quot;);
 	finish(FMATERIALIZE);
 	return;
@@ -993,13 +993,13 @@
     }
     if (l &gt; 3) {
 	game.quad[ix][iy]=IHQUEST;
-	alive = 0;
+	game.alive = 0;
 	drawmaps(1);
 	setwnd(message_window);
 	finish(FMATERIALIZE);
 	return;
     }
-    game.quad[ix][iy]=ship;
+    game.quad[ix][iy]=game.ship;
     textcolor(GREEN);
     prout(&quot;succeeds.&quot;);
     textcolor(DEFAULT);

Modified: trunk/src/planets.c
===================================================================
--- trunk/src/planets.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/planets.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -8,10 +8,10 @@
    Let's see what happens if all events can occur here */
 
 //  double asave;
-    ididit = 1;
+    game.ididit = 1;
 #if 0
     /* Don't worry about this */
-    if (future[FTBEAM] &lt;= game.state.date+Time &amp;&amp; game.state.remcom != 0 &amp;&amp; condit != IHDOCKED) {
+    if (future[FTBEAM] &lt;= game.state.date+game.optime &amp;&amp; game.state.remcom != 0 &amp;&amp; game.condit != IHDOCKED) {
 	/* We are about to be tractor beamed -- operation fails */
 	return 1;
     }
@@ -21,7 +21,7 @@
     events();	/* Used to avoid if future[FSCMOVE] within time */
 //	future[FSNOVA] = asave;
     /*fails if game over, quadrant super-novas or we've moved to new quadrant*/
-    if (alldone || game.state.galaxy[quadx][quady].supernova || justin != 0) return 1;
+    if (game.alldone || game.state.galaxy[game.quadx][game.quady].supernova || game.justin != 0) return 1;
     return 0;
 }
 
@@ -32,15 +32,15 @@
     chew();
     prout(&quot;Spock-  \&quot;Planet report follows, Captain.\&quot;&quot;);
     skip(1);
-    for (i = 0; i &lt; inplan; i++) {
+    for (i = 0; i &lt; game.inplan; i++) {
 	if (game.state.plnets[i].known != unknown
 #ifdef DEBUG
-	    || ( idebug &amp;&amp; game.state.plnets[i].x !=0)
+	    || ( game.idebug &amp;&amp; game.state.plnets[i].x !=0)
 #endif
 	    ) {
 	    iknow = 1;
 #ifdef DEBUG
-	    if (idebug &amp;&amp; game.state.plnets[i].known==unknown) proutn(&quot;(Unknown) &quot;);
+	    if (game.idebug &amp;&amp; game.state.plnets[i].known==unknown) proutn(&quot;(Unknown) &quot;);
 #endif
 	    proutn(cramlc(quadrant, game.state.plnets[i].x, game.state.plnets[i].y));
 	    proutn(&quot;   class &quot;);
@@ -59,7 +59,7 @@
 {
     skip(1);
     chew();
-    if (inorbit!=0) {
+    if (game.inorbit!=0) {
 	prout(&quot;Already in standard orbit.&quot;);
 	return;
     }
@@ -67,20 +67,20 @@
 	prout(&quot;Both warp and impulse engines damaged.&quot;);
 	return;
     }
-    if (plnetx == 0 || abs(sectx-plnetx) &gt; 1 || abs(secty-plnety) &gt; 1) {
+    if (game.plnetx == 0 || abs(game.sectx-game.plnetx) &gt; 1 || abs(game.secty-game.plnety) &gt; 1) {
 	crmshp();
 	prout(&quot; not adjacent to planet.&quot;);
 	skip(1);
 	return;
     }
-    Time = 0.02+0.03*Rand();
+    game.optime = 0.02+0.03*Rand();
     prout(&quot;Helmsman Sulu-  \&quot;Entering standard orbit, Sir.\&quot;&quot;);
     newcnd();
     if (consumeTime()) return;
     game.height = (1400.0+7200.0*Rand());
     prout(&quot;Sulu-  \&quot;Entered orbit at altitude %.2f kilometers.\&quot;&quot;, game.height);
-    inorbit = 1;
-    ididit=1;
+    game.inorbit = 1;
+    game.ididit=1;
 }
 
 void sensor(void) 
@@ -91,22 +91,22 @@
 	prout(&quot;Short range sensors damaged.&quot;);
 	return;
     }
-    if (!plnetx &amp;&amp; (game.options &amp; OPTION_TTY)) {
+    if (!game.plnetx &amp;&amp; (game.options &amp; OPTION_TTY)) {
 	prout(&quot;Spock- \&quot;No planet in this quadrant, Captain.\&quot;&quot;);
 	return;
     }
-    if ((plnetx != 0)&amp;&amp; (game.state.plnets[iplnet].known == unknown)) {
-	prout(&quot;Spock-  \&quot;Sensor scan for %s-&quot;, cramlc(quadrant, quadx, quady));
+    if ((game.plnetx != 0)&amp;&amp; (game.state.plnets[game.iplnet].known == unknown)) {
+	prout(&quot;Spock-  \&quot;Sensor scan for %s-&quot;, cramlc(quadrant, game.quadx, game.quady));
 	skip(1);
 	prout(&quot;         Planet at %s is of class %s.&quot;, 
-	      cramlc(sector, plnetx, plnety),
-	      classes[game.state.plnets[iplnet].pclass]);
-	if (game.state.plnets[iplnet].known==shuttle_down) 
+	      cramlc(sector, game.plnetx, game.plnety),
+	      classes[game.state.plnets[game.iplnet].pclass]);
+	if (game.state.plnets[game.iplnet].known==shuttle_down) 
 	    prout(&quot;         Sensors show Galileo still on surface.&quot;);
 	proutn(&quot;         Readings indicate&quot;);
-	if (game.state.plnets[iplnet].crystals == 0) proutn(&quot; no&quot;);
+	if (game.state.plnets[game.iplnet].crystals == 0) proutn(&quot; no&quot;);
 	prout(&quot; dilithium crystals present.\&quot;&quot;);
-	if (game.state.plnets[iplnet].known == unknown) game.state.plnets[iplnet].known = known;
+	if (game.state.plnets[game.iplnet].known == unknown) game.state.plnets[game.iplnet].known = known;
     }
 }
 
@@ -116,31 +116,31 @@
     skip(1);
     if (game.damage[DTRANSP] != 0) {
 	prout(&quot;Transporter damaged.&quot;);
-	if (game.damage[DSHUTTL]==0 &amp;&amp; (game.state.plnets[iplnet].known==shuttle_down || iscraft == 1)) {
+	if (game.damage[DSHUTTL]==0 &amp;&amp; (game.state.plnets[game.iplnet].known==shuttle_down || game.iscraft == 1)) {
 	    skip(1);
 	    proutn(&quot;Spock-  \&quot;May I suggest the shuttle craft, Sir?\&quot; &quot;);
 	    if (ja() != 0) shuttle();
 	}
 	return;
     }
-    if (inorbit==0) {
+    if (game.inorbit==0) {
 	crmshp();
 	prout(&quot; not in standard orbit.&quot;);
 	return;
     }
-    if (shldup!=0) {
+    if (game.shldup!=0) {
 	prout(&quot;Impossible to transport through shields.&quot;);
 	return;
     }
-    if (game.state.plnets[iplnet].known==unknown) {
+    if (game.state.plnets[game.iplnet].known==unknown) {
 	prout(&quot;Spock-  \&quot;Captain, we have no information on this planet&quot;);
 	prout(&quot;  and Starfleet Regulations clearly state that in this situation&quot;);
 	prout(&quot;  you may not go down.\&quot;&quot;);
 	return;
     }
-    if (landed==1) {
+    if (game.landed==1) {
 	/* Coming from planet */
-	if (game.state.plnets[iplnet].known==shuttle_down) {
+	if (game.state.plnets[game.iplnet].known==shuttle_down) {
 	    proutn(&quot;Spock-  \&quot;Wouldn't you rather take the Galileo?\&quot; &quot;);
 	    if (ja() != 0) {
 		chew();
@@ -157,7 +157,7 @@
     }
     else {
 	/* Going to planet */
-	if (game.state.plnets[iplnet].crystals==0) {
+	if (game.state.plnets[game.iplnet].crystals==0) {
 	    prout(&quot;Spock-  \&quot;Captain, I fail to see the logic in&quot;);
 	    prout(&quot;  exploring a planet with no dilithium crystals.&quot;);
 	    proutn(&quot;  Are you sure this is wise?\&quot; &quot;);
@@ -172,7 +172,7 @@
 	skip(1);
 	prout(&quot;Kirk-  \&quot;Energize.\&quot;&quot;);
     }
-    ididit=1;
+    game.ididit=1;
     skip(1);
     prouts(&quot;WWHOOOIIIIIRRRRREEEE.E.E.  .  .  .  .   .    .&quot;);
     skip(2);
@@ -186,15 +186,15 @@
     prouts(&quot;.    .   .  .  .  .  .E.E.EEEERRRRRIIIIIOOOHWW&quot;);
     skip(2);
     prout(&quot;Transport complete.&quot;);
-    landed = -landed;
-    if (landed==1 &amp;&amp; game.state.plnets[iplnet].known==shuttle_down) {
+    game.landed = -game.landed;
+    if (game.landed==1 &amp;&amp; game.state.plnets[game.iplnet].known==shuttle_down) {
 	prout(&quot;The shuttle craft Galileo is here!&quot;);
     }
-    if (landed!=1 &amp;&amp; imine==1) {
-	icrystl = 1;
-	cryprob = 0.05;
+    if (game.landed!=1 &amp;&amp; game.imine==1) {
+	game.icrystl = 1;
+	game.cryprob = 0.05;
     }
-    imine = 0;
+    game.imine = 0;
     return;
 }
 
@@ -202,44 +202,44 @@
 {
     skip(1);
     chew();
-    if (landed!= 1) {
+    if (game.landed!= 1) {
 	prout(&quot;Mining party not on planet.&quot;);
 	return;
     }
-    if (game.state.plnets[iplnet].crystals == 0) {
+    if (game.state.plnets[game.iplnet].crystals == 0) {
 	prout(&quot;No dilithium crystals on this planet.&quot;);
 	return;
     }
-    if (imine == 1) {
+    if (game.imine == 1) {
 	prout(&quot;You've already mined enough crystals for this trip.&quot;);
 	return;
     }
-    if (icrystl == 1 &amp;&amp; cryprob == 0.05) {
+    if (game.icrystl == 1 &amp;&amp; game.cryprob == 0.05) {
 	proutn(&quot;With all those fresh crystals aboard the &quot;);
 	crmshp();
 	skip(1);
 	prout(&quot;there's no reason to mine more at this time.&quot;);
 	return;
     }
-    Time = (0.1+0.2*Rand())*game.state.plnets[iplnet].pclass;
+    game.optime = (0.1+0.2*Rand())*game.state.plnets[game.iplnet].pclass;
     if (consumeTime()) return;
     prout(&quot;Mining operation complete.&quot;);
-    imine = 1;
-    ididit=1;
+    game.imine = 1;
+    game.ididit=1;
 }
 
 void usecrystals(void) 
 {
-    ididit=0;
+    game.ididit=0;
     skip(1);
     chew();
-    if (icrystl!=1) {
+    if (game.icrystl!=1) {
 	prout(&quot;No dilithium crystals available.&quot;);
 	return;
     }
-    if (energy &gt;= 1000) {
+    if (game.energy &gt;= 1000) {
 	prout(&quot;Spock-  \&quot;Captain, Starfleet Regulations prohibit such an operation&quot;);
-	prout(&quot;  except when condition Yellow exists.&quot;);
+	prout(&quot;  except when game.condition Yellow exists.&quot;);
 	return;
     }
     prout(&quot;Spock- \&quot;Captain, I must warn you that loading&quot;);
@@ -259,7 +259,7 @@
     skip(1);
     prouts(&quot;Scotty-  \&quot;Keep your fingers crossed, Sir!\&quot;&quot;);
     skip(1);
-    if (Rand() &lt;= cryprob) {
+    if (Rand() &lt;= game.cryprob) {
 	prouts(&quot;  \&quot;Activating now! - - No good!  It's***&quot;);
 	skip(2);
 	prouts(&quot;***RED ALERT!  RED A*L********************************&quot;);
@@ -270,13 +270,13 @@
 	kaboom();
 	return;
     }
-    energy += 5000.0*(1.0 + 0.9*Rand());
+    game.energy += 5000.0*(1.0 + 0.9*Rand());
     prouts(&quot;  \&quot;Activating now! - - &quot;);
     prout(&quot;The instruments&quot;);
     prout(&quot;   are going crazy, but I think it's&quot;);
     prout(&quot;   going to work!!  Congratulations, Sir!\&quot;&quot;);
-    cryprob *= 2.0;
-    ididit=1;
+    game.cryprob *= 2.0;
+    game.ididit=1;
 }
 
 void shuttle(void) 
@@ -285,7 +285,7 @@
     skip(1);
     if(game.damage[DSHUTTL] != 0.0) {
 	if (game.damage[DSHUTTL] == -1.0) {
-	    if (inorbit &amp;&amp; game.state.plnets[iplnet].known == shuttle_down)
+	    if (game.inorbit &amp;&amp; game.state.plnets[game.iplnet].known == shuttle_down)
 		prout(&quot;Ye Faerie Queene has no shuttle craft bay to dock it at.&quot;);
 	    else
 		prout(&quot;Ye Faerie Queene had no shuttle craft.&quot;);
@@ -295,44 +295,44 @@
 	else prout(&quot;Shuttle craft is now serving Big Macs.&quot;);
 	return;
     }
-    if (inorbit==0) {
+    if (game.inorbit==0) {
 	crmshp();
 	prout(&quot; not in standard orbit.&quot;);
 	return;
     }
-    if ((game.state.plnets[iplnet].known != shuttle_down) &amp;&amp; iscraft != 1) {
+    if ((game.state.plnets[game.iplnet].known != shuttle_down) &amp;&amp; game.iscraft != 1) {
 	prout(&quot;Shuttle craft not currently available.&quot;);
 	return;
     }
-    if (landed==-1 &amp;&amp; game.state.plnets[iplnet].known==shuttle_down) {
+    if (game.landed==-1 &amp;&amp; game.state.plnets[game.iplnet].known==shuttle_down) {
 	prout(&quot;You will have to beam down to retrieve the shuttle craft.&quot;);
 	return;
     }
-    if (shldup!=0 || condit == IHDOCKED) {
+    if (game.shldup!=0 || game.condit == IHDOCKED) {
 	prout(&quot;Shuttle craft cannot pass through shields.&quot;);
 	return;
     }
-    if (game.state.plnets[iplnet].known==unknown) {
+    if (game.state.plnets[game.iplnet].known==unknown) {
 	prout(&quot;Spock-  \&quot;Captain, we have no information on this planet&quot;);
 	prout(&quot;  and Starfleet Regulations clearly state that in this situation&quot;);
 	prout(&quot;  you may not fly down.\&quot;&quot;);
 	return;
     }
-    Time = 3.0e-5*game.height;
-    if (Time &gt;= 0.8*game.state.remtime) {
+    game.optime = 3.0e-5*game.height;
+    if (game.optime &gt;= 0.8*game.state.remtime) {
 	prout(&quot;First Officer Spock-  \&quot;Captain, I compute that such&quot;);
 	proutn(&quot;  a maneuver would require approximately 2d%% of our&quot;,
-	       (int)(100*Time/game.state.remtime));
+	       (int)(100*game.optime/game.state.remtime));
 	prout(&quot;remaining time.&quot;);
 	proutn(&quot;Are you sure this is wise?\&quot; &quot;);
 	if (ja()==0) {
-	    Time = 0.0;
+	    game.optime = 0.0;
 	    return;
 	}
     }
-    if (landed == 1) {
+    if (game.landed == 1) {
 	/* Kirk on planet */
-	if (iscraft==1) {
+	if (game.iscraft==1) {
 	    /* Galileo on ship! */
 	    if (game.damage[DTRANSP]==0) {
 		proutn(&quot;Spock-  \&quot;Would you rather use the transporter?\&quot; &quot;);
@@ -345,10 +345,10 @@
 	    else
 		proutn(&quot;Rescue party&quot;);
 	    prout(&quot; boards Galileo and swoops toward planet surface.&quot;);
-	    iscraft = 0;
+	    game.iscraft = 0;
 	    skip(1);
 	    if (consumeTime()) return;
-	    game.state.plnets[iplnet].known=shuttle_down;
+	    game.state.plnets[game.iplnet].known=shuttle_down;
 	    prout(&quot;Trip complete.&quot;);
 	    return;
 	}
@@ -358,18 +358,18 @@
 	    prout(&quot;shuttle craft for the trip back to the Enterprise.&quot;);
 	    skip(1);
 	    prout(&quot;The short hop begins . . .&quot;);
-	    game.state.plnets[iplnet].known=known;
-	    icraft = 1;
+	    game.state.plnets[game.iplnet].known=known;
+	    game.icraft = 1;
 	    skip(1);
-	    landed = -1;
+	    game.landed = -1;
 	    if (consumeTime()) return;
-	    iscraft = 1;
-	    icraft = 0;
-	    if (imine!=0) {
-		icrystl = 1;
-		cryprob = 0.05;
+	    game.iscraft = 1;
+	    game.icraft = 0;
+	    if (game.imine!=0) {
+		game.icrystl = 1;
+		game.cryprob = 0.05;
 	    }
-	    imine = 0;
+	    game.imine = 0;
 	    prout(&quot;Trip complete.&quot;);
 	    return;
 	}
@@ -382,12 +382,12 @@
 	skip(1);
 	prouts(&quot;The hangar doors open; the trip begins.&quot;);
 	skip(1);
-	icraft = 1;
-	iscraft = 0;
+	game.icraft = 1;
+	game.iscraft = 0;
 	if (consumeTime()) return;
-	game.state.plnets[iplnet].known = shuttle_down;
-	landed = 1;
-	icraft = 0;
+	game.state.plnets[game.iplnet].known = shuttle_down;
+	game.landed = 1;
+	game.icraft = 0;
 	prout(&quot;Trip complete&quot;);
 	return;
     }
@@ -397,14 +397,14 @@
 {
     double dprob, r = Rand();
 	
-    ididit = 0;
+    game.ididit = 0;
     skip(1);
     chew();
-    if (ship != IHE) {
+    if (game.ship != IHE) {
 	prout(&quot;Ye Faerie Queene has no death ray.&quot;);
 	return;
     }
-    if (nenhere==0) {
+    if (game.nenhere==0) {
 	prout(&quot;Sulu-  \&quot;But Sir, there are no enemies in this quadrant.\&quot;&quot;);
 	return;
     }
@@ -418,7 +418,7 @@
     if (ja()==0) return;
     prout(&quot;Spock-  \&quot;Acknowledged.\&quot;&quot;);
     skip(1);
-    ididit=1;
+    game.ididit=1;
     prouts(&quot;WHOOEE ... WHOOEE ... WHOOEE ... WHOOEE&quot;);
     skip(1);
     prout(&quot;Crew scrambles in emergency preparation.&quot;);
@@ -436,7 +436,7 @@
     if (r &gt; dprob) {
 	prouts(&quot;Sulu- \&quot;Captain!  It's working!\&quot;&quot;);
 	skip(2);
-	while (nenhere &gt; 0)
+	while (game.nenhere &gt; 0)
 	    deadkl(game.kx[1],game.ky[1],game.quad[game.kx[1]][game.ky[1]],game.kx[1],game.ky[1]);
 	prout(&quot;Ensign Chekov-  \&quot;Congratulations, Captain!\&quot;&quot;);
 	if (KLINGREM == 0) finish(FWON);

Modified: trunk/src/reports.c
===================================================================
--- trunk/src/reports.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/reports.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -8,11 +8,11 @@
     if (!curt) {
 	if (game.future[FCDBAS] &lt; FOREVER) {
 	    prout(&quot;Starbase in %s is currently under Commander attack.&quot;,
-		  cramlc(quadrant, batx, baty));
+		  cramlc(quadrant, game.batx, game.baty));
 	    prout(&quot;It can hold out until Stardate %d.&quot;, 
 		  (int)game.future[FCDBAS]);
 	}
-	if (isatb == 1) {
+	if (game.isatb == 1) {
 	    prout(&quot;Starbase in %s is under Super-commander attack.&quot;,
 		  cramlc(quadrant, game.state.isx, game.state.isy));
 	    prout(&quot;It can hold out until Stardate %d.&quot;, 
@@ -20,8 +20,8 @@
 	}
     } else {
         if (game.future[FCDBAS] &lt; FOREVER)
-	    proutn(&quot;Base in %i - %i attacked by C. Alive until %.1f&quot;, batx, baty, game.future[FCDBAS]);
-        if (isatb == 1)
+	    proutn(&quot;Base in %i - %i attacked by C. Alive until %.1f&quot;, game.batx, game.baty, game.future[FCDBAS]);
+        if (game.isatb == 1)
 	    proutn(&quot;Base in %i - %i attacked by S. Alive until %.1f&quot;, game.state.isx, game.state.isy, game.future[FSCDBAS]);
     }
     clreol();
@@ -33,14 +33,14 @@
     char *s1,*s2,*s3;
 
     chew();
-    s1 = (thawed?&quot;thawed &quot;:&quot;&quot;);
-    switch (length) {
+    s1 = (game.thawed?&quot;game.thawed &quot;:&quot;&quot;);
+    switch (game.length) {
     case 1: s2=&quot;short&quot;; break;
     case 2: s2=&quot;medium&quot;; break;
     case 4: s2=&quot;long&quot;; break;
     default: s2=&quot;unknown length&quot;; break;
     }
-    switch (skill) {
+    switch (game.skill) {
     case SKILL_NOVICE: s3=&quot;novice&quot;; break;
     case SKILL_FAIR: s3=&quot;fair&quot;; break;
     case SKILL_GOOD: s3=&quot;good&quot;; break;
@@ -50,59 +50,59 @@
     }
     prout(&quot;&quot;);
     prout(&quot;You %s playing a %s%s %s game.&quot;,
-	  alldone? &quot;were&quot;: &quot;are now&quot;, s1, s2, s3);
-    if (skill&gt;SKILL_GOOD &amp;&amp; thawed &amp;&amp; !alldone) prout(&quot;No plaque is allowed.&quot;);
-    if (tourn) prout(&quot;This is tournament game %d.&quot;, tourn);
+	  game.alldone? &quot;were&quot;: &quot;are now&quot;, s1, s2, s3);
+    if (game.skill&gt;SKILL_GOOD &amp;&amp; game.thawed &amp;&amp; !game.alldone) prout(&quot;No plaque is allowed.&quot;);
+    if (game.tourn) prout(&quot;This is tournament game %d.&quot;, game.tourn);
     prout(&quot;Your secret password is \&quot;%s\&quot;&quot;,game.passwd);
     proutn(&quot;%d of %d Klingons have been killed&quot;, KLINGKILLED, INKLINGTOT);
     if (NKILLC) prout(&quot;, including %d Commander%s.&quot;, NKILLC, NKILLC==1?&quot;&quot;:&quot;s&quot;);
     else if (NKILLK + NKILLSC &gt; 0) prout(&quot;, but no Commanders.&quot;);
     else prout(&quot;.&quot;);
-    if (skill &gt; SKILL_FAIR) prout(&quot;The Super Commander has %sbeen destroyed.&quot;,
+    if (game.skill &gt; SKILL_FAIR) prout(&quot;The Super Commander has %sbeen destroyed.&quot;,
 				  game.state.nscrem?&quot;not &quot;:&quot;&quot;);
-    if (game.state.rembase != inbase) {
+    if (game.state.rembase != game.inbase) {
 	proutn(&quot;There &quot;);
-	if (inbase-game.state.rembase==1) proutn(&quot;has been 1 base&quot;);
+	if (game.inbase-game.state.rembase==1) proutn(&quot;has been 1 base&quot;);
 	else {
-	    proutn(&quot;have been %d bases&quot;, inbase-game.state.rembase);
+	    proutn(&quot;have been %d bases&quot;, game.inbase-game.state.rembase);
 	}
 	prout(&quot; destroyed, %d remaining.&quot;, game.state.rembase);
     }
-    else prout(&quot;There are %d bases.&quot;, inbase);
-    if (game.damage[DRADIO] == 0.0 || condit == IHDOCKED || iseenit) {
+    else prout(&quot;There are %d bases.&quot;, game.inbase);
+    if (game.damage[DRADIO] == 0.0 || game.condit == IHDOCKED || game.iseenit) {
 	/* Don't report this if not seen and
 	   either the radio is dead or not at base! */
 	attakreport(0);
-	iseenit = 1;
+	game.iseenit = 1;
     }
-    if (casual) prout(&quot;%d casualt%s suffered so far.&quot;,
-		      casual, casual==1? &quot;y&quot; : &quot;ies&quot;);
-    if (nhelp) prout(&quot;There were %d call%s for help.&quot;,
-		     nhelp, nhelp==1 ? &quot;&quot; : &quot;s&quot;);
-    if (ship == IHE) {
+    if (game.casual) prout(&quot;%d casualt%s suffered so far.&quot;,
+		      game.casual, game.casual==1? &quot;y&quot; : &quot;ies&quot;);
+    if (game.nhelp) prout(&quot;There were %d call%s for help.&quot;,
+		     game.nhelp, game.nhelp==1 ? &quot;&quot; : &quot;s&quot;);
+    if (game.ship == IHE) {
 	proutn(&quot;You have &quot;);
-	if (nprobes) proutn(&quot;%d&quot;, nprobes);
+	if (game.nprobes) proutn(&quot;%d&quot;, game.nprobes);
 	else proutn(&quot;no&quot;);
 	proutn(&quot; deep space probe&quot;);
-	if (nprobes!=1) proutn(&quot;s&quot;);
+	if (game.nprobes!=1) proutn(&quot;s&quot;);
 	prout(&quot;.&quot;);
     }
-    if ((game.damage[DRADIO] == 0.0 || condit == IHDOCKED)&amp;&amp;
+    if ((game.damage[DRADIO] == 0.0 || game.condit == IHDOCKED)&amp;&amp;
 	game.future[FDSPROB] != FOREVER) {
-	if (isarmed) 
+	if (game.isarmed) 
 	    proutn(&quot;An armed deep space probe is in&quot;);
 	else
 	    proutn(&quot;A deep space probe is in&quot;);
-	proutn(cramlc(quadrant, probecx, probecy));
+	proutn(cramlc(quadrant, game.probecx, game.probecy));
 	prout(&quot;.&quot;);
     }
-    if (icrystl) {
-	if (cryprob &lt;= .05)
+    if (game.icrystl) {
+	if (game.cryprob &lt;= .05)
 	    prout(&quot;Dilithium crystals aboard ship... not yet used.&quot;);
 	else {
 	    int i=0;
 	    double ai = 0.05;
-	    while (cryprob &gt; ai) {
+	    while (game.cryprob &gt; ai) {
 		ai *= 2.0;
 		i++;
 	    }
@@ -119,7 +119,7 @@
     chew();
     if (game.damage[DLRSENS] != 0.0) {
 	/* Now allow base's sensors if docked */
-	if (condit != IHDOCKED) {
+	if (game.condit != IHDOCKED) {
 	    prout(&quot;LONG-RANGE SENSORS DAMAGED.&quot;);
 	    return;
 	}
@@ -128,9 +128,9 @@
     else {
 	prout(&quot;Long-range scan&quot;);
     }
-    for (x = quadx-1; x &lt;= quadx+1; x++) {
+    for (x = game.quadx-1; x &lt;= game.quadx+1; x++) {
 	proutn(&quot; &quot;);
-	for (y = quady-1; y &lt;= quady+1; y++) {
+	for (y = game.quady-1; y &lt;= game.quady+1; y++) {
 	    if (!VALID_QUADRANT(x, y))
 		proutn(&quot;  -1&quot;);
 	    else {
@@ -164,7 +164,7 @@
 	    prout(&quot;  %16s %8.2f  %8.2f&quot;, 
 		  device[i],
 		  game.damage[i]+0.05,
-		  docfac*game.damage[i]+0.005);
+		  game.docfac*game.damage[i]+0.005);
 	}
     }
     if (!jdam) prout(&quot;All devices functional.&quot;);
@@ -174,7 +174,7 @@
 /* update the chart in the Enterprise's computer from galaxy data */
 {
     int i, j;
-    lastchart = game.state.date;
+    game.lastchart = game.state.date;
     for_quadrants(i)
 	for_quadrants(j) 
 	    if (game.state.galaxy[i][j].charted) {
@@ -192,21 +192,21 @@
     if (game.damage[DRADIO] == 0.0)
 	rechart();
 
-    if (lastchart &lt; game.state.date &amp;&amp; condit == IHDOCKED) {
+    if (game.lastchart &lt; game.state.date &amp;&amp; game.condit == IHDOCKED) {
 	prout(&quot;Spock-  \&quot;I revised the Star Chart from the starbase's records.\&quot;&quot;);
 	rechart();
     }
 
     if (nn == 0) prout(&quot;       STAR CHART FOR THE KNOWN GALAXY&quot;);
-    if (game.state.date &gt; lastchart)
+    if (game.state.date &gt; game.lastchart)
 	prout(&quot;(Last surveillance update %d stardates ago).&quot;,
-	      (int)(game.state.date-lastchart));
+	      (int)(game.state.date-game.lastchart));
     prout(&quot;      1    2    3    4    5    6    7    8&quot;);
     for_quadrants(i) {
 	proutn(&quot;%d |&quot;, i);
 	for_quadrants(j) {
 	    char buf[4];
-	    if ((game.options &amp; OPTION_SHOWME) &amp;&amp; i == quadx &amp;&amp; j == quady)
+	    if ((game.options &amp; OPTION_SHOWME) &amp;&amp; i == game.quadx &amp;&amp; j == game.quady)
 		proutn(&quot;&lt;&quot;);
 	    else
 		proutn(&quot; &quot;);
@@ -219,7 +219,7 @@
 	    else
 		strcpy(buf, &quot;...&quot;);
 	    proutn(buf);
-	    if ((game.options &amp; OPTION_SHOWME) &amp;&amp; i == quadx &amp;&amp; j == quady)
+	    if ((game.options &amp; OPTION_SHOWME) &amp;&amp; i == game.quadx &amp;&amp; j == game.quady)
 		proutn(&quot;&gt;&quot;);
 	    else
 		proutn(&quot; &quot;);
@@ -231,16 +231,16 @@
 
 static void sectscan(int goodScan, int i, int j) 
 {
-    if (goodScan || (abs(i-sectx)&lt;= 1 &amp;&amp; abs(j-secty) &lt;= 1)){
+    if (goodScan || (abs(i-game.sectx)&lt;= 1 &amp;&amp; abs(j-game.secty) &lt;= 1)){
 	if ((game.quad[i][j]==IHMATER0)||(game.quad[i][j]==IHMATER1)||(game.quad[i][j]==IHMATER2)||(game.quad[i][j]==IHE)||(game.quad[i][j]==IHF)){
-	    switch (condit) {
+	    switch (game.condit) {
 	    case IHRED: textcolor(RED); break;
 	    case IHGREEN: textcolor(GREEN); break;
 	    case IHYELLOW: textcolor(YELLOW); break;
 	    case IHDOCKED: textcolor(CYAN); break;
 	    case IHDEAD: textcolor(BROWN);
 	    }
-	    if (game.quad[i][j] != ship) 
+	    if (game.quad[i][j] != game.ship) 
 		highvideo();
 	}
 	proutn(&quot;%c &quot;,game.quad[i][j]);
@@ -259,8 +259,8 @@
 	proutn(&quot;Stardate      %.1f, Time Left %.2f&quot;, game.state.date, game.state.remtime);
 	break;
     case 2:
-	if (condit != IHDOCKED) newcnd();
-	switch (condit) {
+	if (game.condit != IHDOCKED) newcnd();
+	switch (game.condit) {
 	case IHRED: cp = &quot;RED&quot;; break;
 	case IHGREEN: cp = &quot;GREEN&quot;; break;
 	case IHYELLOW: cp = &quot;YELLOW&quot;; break;
@@ -274,40 +274,40 @@
 	break;
     case 3:
 	proutn(&quot;Position      %d - %d , %d - %d&quot;,
-	       quadx, quady, sectx, secty);
+	       game.quadx, game.quady, game.sectx, game.secty);
 	break;
     case 4:
 	proutn(&quot;Life Support  &quot;);
 	if (game.damage[DLIFSUP] != 0.0) {
-	    if (condit == IHDOCKED)
+	    if (game.condit == IHDOCKED)
 		proutn(&quot;DAMAGED, Base provides&quot;);
 	    else
-		proutn(&quot;DAMAGED, reserves=%4.2f&quot;, lsupres);
+		proutn(&quot;DAMAGED, reserves=%4.2f&quot;, game.lsupres);
 	}
 	else
 	    proutn(&quot;ACTIVE&quot;);
 	break;
     case 5:
-	proutn(&quot;Warp Factor   %.1f&quot;, warpfac);
+	proutn(&quot;Warp Factor   %.1f&quot;, game.warpfac);
 	break;
     case 6:
-	proutn(&quot;Energy        %.2f&quot;, energy);
-	if (icrystl &amp;&amp; (game.options &amp; OPTION_SHOWME))	/* ESR */
+	proutn(&quot;Energy        %.2f&quot;, game.energy);
+	if (game.icrystl &amp;&amp; (game.options &amp; OPTION_SHOWME))	/* ESR */
 	    proutn(&quot; (have crystals)&quot;);
 	break;
     case 7:
-	proutn(&quot;Torpedoes     %d&quot;, torps);
+	proutn(&quot;Torpedoes     %d&quot;, game.torps);
 	break;
     case 8:
 	proutn(&quot;Shields       &quot;);
 	if (game.damage[DSHIELD] != 0)
 	    proutn(&quot;DAMAGED,&quot;);
-	else if (shldup)
+	else if (game.shldup)
 	    proutn(&quot;UP,&quot;);
 	else
 	    proutn(&quot;DOWN,&quot;);
 	proutn(&quot; %d%% %.1f units&quot;,
-	       (int)((100.0*shield)/inshld + 0.5), shield);
+	       (int)((100.0*game.shield)/game.inshld + 0.5), game.shield);
 	break;
     case 9:
 	proutn(&quot;Klingons Left %d&quot;, KLINGREM);
@@ -328,7 +328,7 @@
     case SCAN_FULL: // SRSCAN
 	if (game.damage[DSRSENS] != 0) {
 	    /* Allow base's sensors if docked */
-	    if (condit != IHDOCKED) {
+	    if (game.condit != IHDOCKED) {
 		prout(&quot;   S.R. SENSORS DAMAGED!&quot;);
 		goodScan=FALSE;
 	    }
@@ -337,10 +337,10 @@
 	}
 	else prout(&quot;     Short-range scan&quot;);
 	if (goodScan &amp;&amp; !game.damage[DRADIO]) { 
-	    game.state.chart[quadx][quady].klingons = game.state.galaxy[quadx][quady].klingons;
-	    game.state.chart[quadx][quady].starbase = game.state.galaxy[quadx][quady].starbase;
-	    game.state.chart[quadx][quady].stars = game.state.galaxy[quadx][quady].stars;
-	    game.state.galaxy[quadx][quady].charted = TRUE;
+	    game.state.chart[game.quadx][game.quady].klingons = game.state.galaxy[game.quadx][game.quady].klingons;
+	    game.state.chart[game.quadx][game.quady].starbase = game.state.galaxy[game.quadx][game.quady].starbase;
+	    game.state.chart[game.quadx][game.quady].stars = game.state.galaxy[game.quadx][game.quady].stars;
+	    game.state.galaxy[game.quadx][game.quady].charted = TRUE;
 	}
 	scan();
 	if (isit(&quot;chart&quot;)) nn = TRUE;
@@ -357,7 +357,7 @@
 		break;
 	if (req &gt; sizeof(requests)/sizeof(requests[0])) {
 	    prout(&quot;UNRECOGNIZED REQUEST. Legal requests are:&quot;);
-	    prout(&quot;  date, condition, position, lsupport, warpfactor,&quot;);
+	    prout(&quot;  date, game.condition, position, lsupport, game.warpfactor,&quot;);
 	    prout(&quot;  energy, torpedoes, shields, klingons, time, bases.&quot;);
 	    return FALSE;
 	}
@@ -371,7 +371,7 @@
 	leftside=FALSE;
 	break;
     }
-    if (condit != IHDOCKED) newcnd();
+    if (game.condit != IHDOCKED) newcnd();
     for (i = 1; i &lt;= max(QUADSIZE, sizeof(requests)/sizeof(requests[0])); i++) {
 	jj = (req!=0 ? req : i);
 	if (leftside &amp;&amp; i &lt;= QUADSIZE) {
@@ -425,9 +425,9 @@
 	ix2 = aaitem + 0.5;
     }
     else {
-	if (quady&gt;ix1) ix2 = 1;
+	if (game.quady&gt;ix1) ix2 = 1;
 	else ix2=QUADSIZE;
-	if (quadx&gt;iy1) iy2 = 1;
+	if (game.quadx&gt;iy1) iy2 = 1;
 	else iy2=QUADSIZE;
     }
 
@@ -435,8 +435,8 @@
 	huh();
 	return;
     }
-    dist = sqrt(square(iy1-quadx+0.1*(iy2-sectx))+
-		square(ix1-quady+0.1*(ix2-secty)));
+    game.dist = sqrt(square(iy1-game.quadx+0.1*(iy2-game.sectx))+
+		square(ix1-game.quady+0.1*(ix2-game.secty)));
     wfl = FALSE;
 
     if (prompt) prout(&quot;Answer \&quot;no\&quot; if you don't know the value:&quot;);
@@ -447,7 +447,7 @@
 	    ttime = aaitem;
 	    if (ttime &gt; game.state.date) ttime -= game.state.date; // Actually a star date
 	    if (ttime &lt;= 1e-10 ||
-		(twarp=(floor(sqrt((10.0*dist)/ttime)*10.0)+1.0)/10.0) &gt; 10) {
+		(twarp=(floor(sqrt((10.0*game.dist)/ttime)*10.0)+1.0)/10.0) &gt; 10) {
 		prout(&quot;We'll never make it, sir.&quot;);
 		chew();
 		return;
@@ -470,11 +470,11 @@
     }
     while (TRUE) {
 	chew();
-	ttime = (10.0*dist)/square(twarp);
-	tpower = dist*twarp*twarp*twarp*(shldup+1);
-	if (tpower &gt;= energy) {
+	ttime = (10.0*game.dist)/square(twarp);
+	tpower = game.dist*twarp*twarp*twarp*(game.shldup+1);
+	if (tpower &gt;= game.energy) {
 	    prout(&quot;Insufficient energy, sir.&quot;);
-	    if (shldup==0 || tpower &gt; energy*2.0) {
+	    if (game.shldup==0 || tpower &gt; game.energy*2.0) {
 		if (!wfl) return;
 		proutn(&quot;New warp factor to try? &quot;);
 		if (scan() == IHREAL) {
@@ -498,7 +498,7 @@
 	}
 	else
 	    proutn(&quot;Remaining&quot;);
-	prout(&quot; energy will be %.2f.&quot;, energy-tpower);
+	prout(&quot; game.energy will be %.2f.&quot;, game.energy-tpower);
 	if (wfl) {
 	    prout(&quot;And we will arrive at stardate %.2f.&quot;,
 		  game.state.date+ttime);
@@ -514,9 +514,9 @@
 	    prout(&quot;Unfortunately, the Federation will be destroyed by then.&quot;);
 	if (twarp &gt; 6.0)
 	    prout(&quot;You'll be taking risks at that speed, Captain&quot;);
-	if ((isatb==1 &amp;&amp; game.state.isy == ix1 &amp;&amp; game.state.isx == iy1 &amp;&amp;
+	if ((game.isatb==1 &amp;&amp; game.state.isy == ix1 &amp;&amp; game.state.isx == iy1 &amp;&amp;
 	     game.future[FSCDBAS]&lt; ttime+game.state.date)||
-	    (game.future[FCDBAS]&lt;ttime+game.state.date &amp;&amp; baty==ix1 &amp;&amp; batx == iy1))
+	    (game.future[FCDBAS]&lt;ttime+game.state.date &amp;&amp; game.baty==ix1 &amp;&amp; game.batx == iy1))
 	    prout(&quot;The starbase there will be destroyed by then.&quot;);
 	proutn(&quot;New warp factor to try? &quot;);
 	if (scan() == IHREAL) {

Modified: trunk/src/setup.c
===================================================================
--- trunk/src/setup.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/setup.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -97,8 +97,8 @@
     int nb, l;
 
     chew();
-    if (condit==IHDOCKED) {
-	if (ship!=IHE) {
+    if (game.condit==IHDOCKED) {
+	if (game.ship!=IHE) {
 	    prout(&quot;You cannot abandon Ye Faerie Queene.&quot;);
 	    return;
 	}
@@ -117,11 +117,11 @@
 	    prout(&quot;Shuttle craft damaged.&quot;);
 	    return;
 	}
-	if (landed==1) {
+	if (game.landed==1) {
 	    prout(&quot;You must be aboard the Enterprise.&quot;);
 	    return;
 	}
-	if (iscraft!=1) {
+	if (game.iscraft!=1) {
 	    prout(&quot;Shuttle craft not currently available.&quot;);
 	    return;
 	}
@@ -141,53 +141,53 @@
 	}
 	/* If at least one base left, give 'em the Faerie Queene */
 	skip(1);
-	icrystl = 0; /* crystals are lost */
-	nprobes = 0; /* No probes */
+	game.icrystl = 0; /* crystals are lost */
+	game.nprobes = 0; /* No probes */
 	prout(&quot;You are captured by Klingons and released to&quot;);
 	prout(&quot;the Federation in a prisoner-of-war exchange.&quot;);
 	nb = Rand()*game.state.rembase+1;
 	/* Set up quadrant and position FQ adjacient to base */
-	if (quadx!=game.state.baseqx[nb] || quady!=game.state.baseqy[nb]) {
-	    quadx = game.state.baseqx[nb];
-	    quady = game.state.baseqy[nb];
-	    sectx = secty = 5;
+	if (game.quadx!=game.state.baseqx[nb] || game.quady!=game.state.baseqy[nb]) {
+	    game.quadx = game.state.baseqx[nb];
+	    game.quady = game.state.baseqy[nb];
+	    game.sectx = game.secty = 5;
 	    newqad(1);
 	}
 	for (;;) {
 	    /* position next to base by trial and error */
-	    game.quad[sectx][secty] = IHDOT;
+	    game.quad[game.sectx][game.secty] = IHDOT;
 	    for_sectors(l) {
-		sectx = 3.0*Rand() - 1.0 + basex;
-		secty = 3.0*Rand() - 1.0 + basey;
-		if (VALID_SECTOR(sectx, secty) &amp;&amp;
-		    game.quad[sectx][secty] == IHDOT) break;
+		game.sectx = 3.0*Rand() - 1.0 + game.basex;
+		game.secty = 3.0*Rand() - 1.0 + game.basey;
+		if (VALID_SECTOR(game.sectx, game.secty) &amp;&amp;
+		    game.quad[game.sectx][game.secty] == IHDOT) break;
 	    }
 	    if (l &lt; QUADSIZE+1) break; /* found a spot */
-	    sectx=QUADSIZE/2;
-	    secty=QUADSIZE/2;
+	    game.sectx=QUADSIZE/2;
+	    game.secty=QUADSIZE/2;
 	    newqad(1);
 	}
     }
     /* Get new commission */
-    game.quad[sectx][secty] = ship = IHF;
+    game.quad[game.sectx][game.secty] = game.ship = IHF;
     prout(&quot;Starfleet puts you in command of another ship,&quot;);
     prout(&quot;the Faerie Queene, which is antiquated but,&quot;);
     prout(&quot;still useable.&quot;);
-    if (icrystl!=0) prout(&quot;The dilithium crystals have been moved.&quot;);
-    imine=0;
-    iscraft=0; /* Gallileo disappears */
+    if (game.icrystl!=0) prout(&quot;The dilithium crystals have been moved.&quot;);
+    game.imine=0;
+    game.iscraft=0; /* Gallileo disappears */
     /* Resupply ship */
-    condit=IHDOCKED;
+    game.condit=IHDOCKED;
     for (l = 0; l &lt; NDEVICES; l++) 
 	game.damage[l] = 0.0;
     game.damage[DSHUTTL] = -1;
-    energy = inenrg = 3000.0;
-    shield = inshld = 1250.0;
-    torps = intorps = 6;
-    lsupres=inlsr=3.0;
-    shldup=0;
-    warpfac=5.0;
-    wfacsq=25.0;
+    game.energy = game.inenrg = 3000.0;
+    game.shield = game.inshld = 1250.0;
+    game.torps = game.intorps = 6;
+    game.lsupres=game.inlsr=3.0;
+    game.shldup=0;
+    game.warpfac=5.0;
+    game.wfacsq=25.0;
     return;
 }
 	
@@ -196,36 +196,36 @@
     int i,j, krem, klumper;
     int ix, iy;
 #ifdef DEBUG
-    idebug = 0;
+    game.idebug = 0;
 #endif
     //  Decide how many of everything
     if (choose(needprompt)) return; // frozen game
     // Prepare the Enterprise
-    alldone = gamewon = 0;
-    ship = IHE;
-    energy = inenrg = 5000.0;
-    shield = inshld = 2500.0;
-    shldchg = shldup = 0;
-    inlsr = 4.0;
-    lsupres = 4.0;
-    iran(GALSIZE, &amp;quadx, &amp;quady);
-    iran(QUADSIZE, &amp;sectx, &amp;secty);
-    torps = intorps = 10;
-    nprobes = (int)(3.0*Rand() + 2.0);	/* Give them 2-4 of these wonders */
-    warpfac = 5.0;
-    wfacsq = warpfac * warpfac;
+    game.alldone = game.gamewon = 0;
+    game.ship = IHE;
+    game.energy = game.inenrg = 5000.0;
+    game.shield = game.inshld = 2500.0;
+    game.shldchg = game.shldup = 0;
+    game.inlsr = 4.0;
+    game.lsupres = 4.0;
+    iran(GALSIZE, &amp;game.quadx, &amp;game.quady);
+    iran(QUADSIZE, &amp;game.sectx, &amp;game.secty);
+    game.torps = game.intorps = 10;
+    game.nprobes = (int)(3.0*Rand() + 2.0);	/* Give them 2-4 of these wonders */
+    game.warpfac = 5.0;
+    game.wfacsq = game.warpfac * game.warpfac;
     for (i=0; i &lt; NDEVICES; i++) 
 	game.damage[i] = 0.0;
     // Set up assorted game parameters
-    batx = baty = 0;
-    game.state.date = indate = 100.0*(int)(31.0*Rand()+20.0);
-    nkinks = nhelp = resting = casual = 0;
-    isatb = iscate = imine = icrystl = icraft = game.state.nplankl = 0;
+    game.batx = game.baty = 0;
+    game.state.date = game.indate = 100.0*(int)(31.0*Rand()+20.0);
+    game.nkinks = game.nhelp = game.resting = game.casual = 0;
+    game.isatb = game.iscate = game.imine = game.icrystl = game.icraft = game.state.nplankl = 0;
     game.state.starkl = game.state.basekl = 0;
-    iscraft = 1;
-    landed = -1;
-    alive = 1;
-    docfac = 0.25;
+    game.iscraft = 1;
+    game.landed = -1;
+    game.alive = 1;
+    game.docfac = 0.25;
     for_quadrants(i)
 	for_quadrants(j) {
 	    game.state.galaxy[i][j].charted = 0;
@@ -236,26 +236,26 @@
 	    game.state.galaxy[i][j].supernova = 0;
 	}
     // Initialize times for extraneous events
-    game.future[FSNOVA] = game.state.date + expran(0.5 * intime);
-    game.future[FTBEAM] = game.state.date + expran(1.5 * (intime / game.state.remcom));
+    game.future[FSNOVA] = game.state.date + expran(0.5 * game.intime);
+    game.future[FTBEAM] = game.state.date + expran(1.5 * (game.intime / game.state.remcom));
     game.future[FSNAP] = game.state.date + 1.0 + Rand(); // Force an early snapshot
-    game.future[FBATTAK] = game.state.date + expran(0.3*intime);
+    game.future[FBATTAK] = game.state.date + expran(0.3*game.intime);
     game.future[FCDBAS] = FOREVER;
     game.future[FSCMOVE] = game.state.nscrem ? game.state.date+0.2777 : FOREVER;
     game.future[FSCDBAS] = FOREVER;
     game.future[FDSPROB] = FOREVER;
     // Starchart is functional but we've never seen it
-    lastchart = FOREVER;
+    game.lastchart = FOREVER;
     // Put stars in the galaxy
-    instar = 0;
+    game.instar = 0;
     for_quadrants(i)
 	for_quadrants(j) {
 	    int k = Rand()*9.0 + 1.0;
-	    instar += k;
+	    game.instar += k;
 	    game.state.galaxy[i][j].stars = k;
 	}
     // Locate star bases in galaxy
-    for (i = 1; i &lt;= inbase; i++) {
+    for (i = 1; i &lt;= game.inbase; i++) {
 	int contflag;
 	do {
 	    do iran(GALSIZE, &amp;ix, &amp;iy);
@@ -264,7 +264,7 @@
 	    for (j = i-1; j &gt; 0; j--) {
 		/* Improved placement algorithm to spread out bases */
 		double distq = square(ix-game.state.baseqx[j]) + square(iy-game.state.baseqy[j]);
-		if (distq &lt; 6.0*(BASEMAX+1-inbase) &amp;&amp; Rand() &lt; 0.75) {
+		if (distq &lt; 6.0*(BASEMAX+1-game.inbase) &amp;&amp; Rand() &lt; 0.75) {
 		    contflag = TRUE;
 #ifdef DEBUG
 		    prout(&quot;DEBUG: Abandoning base #%d at %d-%d&quot;, i, ix, iy);
@@ -272,7 +272,7 @@
 		    break;
 		}
 #ifdef DEBUG
-		else if (distq &lt; 6.0 * (BASEMAX+1-inbase)) {
+		else if (distq &lt; 6.0 * (BASEMAX+1-game.inbase)) {
 		    prout(&quot;DEBUG: saving base #%d, close to #%d&quot;, i, j);
 		}
 #endif
@@ -285,8 +285,8 @@
 	game.state.chart[ix][iy].starbase = 1;
     }
     // Position ordinary Klingon Battle Cruisers
-    krem = inkling;
-    klumper = 0.25*skill*(9.0-length)+1.0;
+    krem = game.inkling;
+    klumper = 0.25*game.skill*(9.0-game.length)+1.0;
     if (klumper &gt; 9) klumper = 9; // Can't have more than 9 in quadrant
     do {
 	double r = Rand();
@@ -302,11 +302,11 @@
 #ifdef DEBUG
     klumper = 1;
 #endif
-    for (i = 1; i &lt;= incom; i++) {
+    for (i = 1; i &lt;= game.incom; i++) {
 	do {
 	    do { /* IF debugging, put commanders by bases, always! */
 #ifdef DEBUG
-		if (idebug &amp;&amp; klumper &lt;= inbase) {
+		if (game.idebug &amp;&amp; klumper &lt;= game.inbase) {
 		    ix = game.state.baseqx[klumper];
 		    iy = game.state.baseqy[klumper];
 		    klumper++;
@@ -327,7 +327,7 @@
 	game.state.cy[i] = iy;
     }
     // Locate planets in galaxy
-    for (i = 0; i &lt; inplan; i++) {
+    for (i = 0; i &lt; game.inplan; i++) {
 	do iran(GALSIZE, &amp;ix, &amp;iy); while (game.state.galaxy[ix][iy].planets);
 	game.state.galaxy[ix][iy].planets = 1;
 	game.state.plnets[i].x = ix;
@@ -361,17 +361,17 @@
     skip(2);
     game.state.snap = 0;
 		
-    if (skill == SKILL_NOVICE) {
+    if (game.skill == SKILL_NOVICE) {
 	prout(&quot;It is stardate %d. The Federation is being attacked by&quot;,
 	      (int)game.state.date);
 	prout(&quot;a deadly Klingon invasion force. As captain of the United&quot;);
 	prout(&quot;Starship U.S.S. Enterprise, it is your mission to seek out&quot;);
 	prout(&quot;and destroy this invasion force of %d battle cruisers.&quot;,
 	      INKLINGTOT);
-	prout(&quot;You have an initial allotment of %d stardates to complete&quot;, (int)intime);
+	prout(&quot;You have an initial allotment of %d stardates to complete&quot;, (int)game.intime);
 	prout(&quot;your mission.  As you proceed you may be given more time.&quot;);
 	prout(&quot;&quot;);
-	prout(&quot;You will have %d supporting starbases.&quot;, inbase);
+	prout(&quot;You will have %d supporting starbases.&quot;, game.inbase);
 	proutn(&quot;Starbase locations-  &quot;);
     }
     else {
@@ -380,34 +380,34 @@
 	prout(&quot;%d Klingons.&quot;, INKLINGTOT);
 	prout(&quot;An unknown number of Romulans.&quot;);
 	if (game.state.nscrem) prout(&quot;and one (GULP) Super-Commander.&quot;);
-	prout(&quot;%d stardates.&quot;,(int)intime);
-	proutn(&quot;%d starbases in &quot;, inbase);
+	prout(&quot;%d stardates.&quot;,(int)game.intime);
+	proutn(&quot;%d starbases in &quot;, game.inbase);
     }
-    for (i = 1; i &lt;= inbase; i++) {
+    for (i = 1; i &lt;= game.inbase; i++) {
 	proutn(cramlc(0, game.state.baseqx[i], game.state.baseqy[i]));
 	proutn(&quot;  &quot;);
     }
     skip(2);
     proutn(&quot;The Enterprise is currently in &quot;);
-    proutn(cramlc(quadrant, quadx, quady));
+    proutn(cramlc(quadrant, game.quadx, game.quady));
     proutn(&quot; &quot;);
-    proutn(cramlc(sector, sectx, secty));
+    proutn(cramlc(sector, game.sectx, game.secty));
     skip(2);
     prout(&quot;Good Luck!&quot;);
     if (game.state.nscrem) prout(&quot;  YOU'LL NEED IT.&quot;);
     waitfor();
     newqad(0);
-    if (nenhere-iqhere-ithere) shldup=1.0;
-    if (neutz) attack(0);	// bad luck to start in a Romulan Neutral Zone
+    if (game.nenhere-iqhere-game.ithere) game.shldup=1.0;
+    if (game.neutz) attack(0);	// bad luck to start in a Romulan Neutral Zone
 }
 
 int choose(int needprompt) 
 {
     while (TRUE) {
-	tourn = 0;
-	thawed = 0;
-	skill = SKILL_NONE;
-	length = 0;
+	game.tourn = 0;
+	game.thawed = 0;
+	game.skill = SKILL_NONE;
+	game.length = 0;
 	if (needprompt) /* Can start with command line options */
 	    proutn(&quot;Would you like a regular, tournament, or saved game? &quot;);
 	scan();
@@ -420,7 +420,7 @@
 		chew();
 		continue; // We don't want a blank entry
 	    }
-	    tourn = (int)aaitem;
+	    game.tourn = (int)aaitem;
 	    thingx = -1;
 	    srand((unsigned int)(int)aaitem);
 	    break;
@@ -429,7 +429,7 @@
 	    if (thaw()) continue;
 	    chew();
 	    if (*game.passwd==0) continue;
-	    if (!alldone) thawed = 1; // No plaque if not finished
+	    if (!game.alldone) game.thawed = 1; // No plaque if not finished
 	    report();
 	    waitfor();
 	    return TRUE;
@@ -440,16 +440,16 @@
 	prout(&quot;\&quot;?&quot;);
 	chew();
     }
-    while (length==0 || skill==SKILL_NONE) {
+    while (game.length==0 || game.skill==SKILL_NONE) {
 	if (scan() == IHALPHA) {
-	    if (isit(&quot;short&quot;)) length = 1;
-	    else if (isit(&quot;medium&quot;)) length = 2;
-	    else if (isit(&quot;long&quot;)) length = 4;
-	    else if (isit(&quot;novice&quot;)) skill = SKILL_NOVICE;
-	    else if (isit(&quot;fair&quot;)) skill = SKILL_FAIR;
-	    else if (isit(&quot;good&quot;)) skill = SKILL_GOOD;
-	    else if (isit(&quot;expert&quot;)) skill = SKILL_EXPERT;
-	    else if (isit(&quot;emeritus&quot;)) skill = SKILL_EMERITUS;
+	    if (isit(&quot;short&quot;)) game.length = 1;
+	    else if (isit(&quot;medium&quot;)) game.length = 2;
+	    else if (isit(&quot;long&quot;)) game.length = 4;
+	    else if (isit(&quot;novice&quot;)) game.skill = SKILL_NOVICE;
+	    else if (isit(&quot;fair&quot;)) game.skill = SKILL_FAIR;
+	    else if (isit(&quot;good&quot;)) game.skill = SKILL_GOOD;
+	    else if (isit(&quot;expert&quot;)) game.skill = SKILL_EXPERT;
+	    else if (isit(&quot;emeritus&quot;)) game.skill = SKILL_EMERITUS;
 	    else {
 		proutn(&quot;What is \&quot;&quot;);
 		proutn(citem);
@@ -458,8 +458,8 @@
 	}
 	else {
 	    chew();
-	    if (length==0) proutn(&quot;Would you like a Short, Medium, or Long game? &quot;);
-	    else if (skill == SKILL_NONE) proutn(&quot;Are you a Novice, Fair, Good, Expert, or Emeritus player? &quot;);
+	    if (game.length==0) proutn(&quot;Would you like a Short, Medium, or Long game? &quot;);
+	    else if (game.skill == SKILL_NONE) proutn(&quot;Are you a Novice, Fair, Good, Expert, or Emeritus player? &quot;);
 	}
     }
     // Choose game options -- added by ESR for SST2K
@@ -487,27 +487,27 @@
     }
     setpassword();
 #ifdef DEBUG
-    if (strcmp(game.passwd, &quot;debug&quot;)==0) idebug = 1;
+    if (strcmp(game.passwd, &quot;debug&quot;)==0) game.idebug = 1;
 #endif
 
     // Use parameters to generate initial values of things
-    damfac = 0.5 * skill;
+    game.damfac = 0.5 * game.skill;
     game.state.rembase = 2.0 + Rand()*(BASEMAX-2.0);
-    inbase = game.state.rembase;
+    game.inbase = game.state.rembase;
     if (game.options &amp; OPTION_PLANETS)
-	inplan = (PLNETMAX/2) + (PLNETMAX/2+1)*Rand();
-    game.state.nromrem = inrom = (2.0+Rand())*skill;
-    game.state.nscrem = inscom = (skill &gt; SKILL_FAIR ? 1 : 0);
-    game.state.remtime = 7.0 * length;
-    intime = game.state.remtime;
-    game.state.remkl = inkling = 2.0*intime*((skill+1 - 2*Rand())*skill*0.1+.15);
-    incom = skill + 0.0625*inkling*Rand();
-    game.state.remcom = min(10, incom);
-    incom = game.state.remcom;
-    game.state.remres = (inkling+4*incom)*intime;
-    inresor = game.state.remres;
-    if (inkling &gt; 50) {
-	inbase = (game.state.rembase += 1);
+	game.inplan = (PLNETMAX/2) + (PLNETMAX/2+1)*Rand();
+    game.state.nromrem = game.inrom = (2.0+Rand())*game.skill;
+    game.state.nscrem = game.inscom = (game.skill &gt; SKILL_FAIR ? 1 : 0);
+    game.state.remtime = 7.0 * game.length;
+    game.intime = game.state.remtime;
+    game.state.remkl = game.inkling = 2.0*game.intime*((game.skill+1 - 2*Rand())*game.skill*0.1+.15);
+    game.incom = game.skill + 0.0625*game.inkling*Rand();
+    game.state.remcom = min(10, game.incom);
+    game.incom = game.state.remcom;
+    game.state.remres = (game.inkling+4*game.incom)*game.intime;
+    game.inresor = game.state.remres;
+    if (game.inkling &gt; 50) {
+	game.inbase = (game.state.rembase += 1);
     }
     return FALSE;
 }
@@ -521,11 +521,11 @@
 
 void newcnd(void) 
 {
-    condit = IHGREEN;
-    if (energy &lt; 1000.0) condit = IHYELLOW;
-    if (game.state.galaxy[quadx][quady].klingons || game.state.galaxy[quadx][quady].romulans)
-	condit = IHRED;
-    if (!alive) condit=IHDEAD;
+    game.condit = IHGREEN;
+    if (game.energy &lt; 1000.0) game.condit = IHYELLOW;
+    if (game.state.galaxy[game.quadx][game.quady].klingons || game.state.galaxy[game.quadx][game.quady].romulans)
+	game.condit = IHRED;
+    if (!game.alive) game.condit=IHDEAD;
 }
 
 
@@ -533,101 +533,101 @@
 {
     int i, j, ix, iy, nplan;
 
-    iattak = 1;
-    justin = 1;
-    basex = basey = 0;
-    klhere = 0;
-    comhere = 0;
-    plnetx = plnety = 0;
-    ishere = 0;
-    irhere = 0;
-    iplnet = 0;
-    nenhere = 0;
-    neutz = 0;
-    inorbit = 0;
-    landed = -1;
-    ientesc = 0;
-    ithere = 0;
+    game.iattak = 1;
+    game.justin = 1;
+    game.basex = game.basey = 0;
+    game.klhere = 0;
+    game.comhere = 0;
+    game.plnetx = game.plnety = 0;
+    game.ishere = 0;
+    game.irhere = 0;
+    game.iplnet = 0;
+    game.nenhere = 0;
+    game.neutz = 0;
+    game.inorbit = 0;
+    game.landed = -1;
+    game.ientesc = 0;
+    game.ithere = 0;
     iqhere=0;
     iqengry=0;
-    iseenit = 0;
-    if (iscate) {
+    game.iseenit = 0;
+    if (game.iscate) {
 	// Attempt to escape Super-commander, so tbeam back!
-	iscate = 0;
-	ientesc = 1;
+	game.iscate = 0;
+	game.ientesc = 1;
     }
     // Clear quadrant
     for_sectors(i)
 	for_sectors(j) 
 	    game.quad[i][j] = IHDOT;
     // cope with supernova
-    if (game.state.galaxy[quadx][quady].supernova)
+    if (game.state.galaxy[game.quadx][game.quady].supernova)
 	return;
-    klhere = game.state.galaxy[quadx][quady].klingons;
-    irhere = game.state.galaxy[quadx][quady].romulans;
-    nplan  = game.state.galaxy[quadx][quady].planets;
-    nenhere = klhere + irhere;
+    game.klhere = game.state.galaxy[game.quadx][game.quady].klingons;
+    game.irhere = game.state.galaxy[game.quadx][game.quady].romulans;
+    nplan  = game.state.galaxy[game.quadx][game.quady].planets;
+    game.nenhere = game.klhere + game.irhere;
 
     // Position Starship
-    game.quad[sectx][secty] = ship;
+    game.quad[game.sectx][game.secty] = game.ship;
 
-    if (game.state.galaxy[quadx][quady].klingons) {
+    if (game.state.galaxy[game.quadx][game.quady].klingons) {
 	// Position ordinary Klingons
-	for (i = 1; i &lt;= klhere; i++) {
+	for (i = 1; i &lt;= game.klhere; i++) {
 	    dropin(IHK, &amp;ix, &amp;iy);
 	    game.kx[i] = ix;
 	    game.ky[i] = iy;
-	    game.kdist[i] = game.kavgd[i] = sqrt(square(sectx-ix) + square(secty-iy));
-	    game.kpower[i] = Rand()*150.0 +300.0 +25.0*skill;
+	    game.kdist[i] = game.kavgd[i] = sqrt(square(game.sectx-ix) + square(game.secty-iy));
+	    game.kpower[i] = Rand()*150.0 +300.0 +25.0*game.skill;
 	}
 	// If we need a commander, promote a Klingon
 	for_commanders(i)
-	    if (game.state.cx[i]==quadx &amp;&amp; game.state.cy[i]==quady) break;
+	    if (game.state.cx[i]==game.quadx &amp;&amp; game.state.cy[i]==game.quady) break;
 			
 	if (i &lt;= game.state.remcom) {
 	    game.quad[ix][iy] = IHC;
-	    game.kpower[klhere] = 950.0+400.0*Rand()+50.0*skill;
-	    comhere = 1;
+	    game.kpower[game.klhere] = 950.0+400.0*Rand()+50.0*game.skill;
+	    game.comhere = 1;
 	}
 
 	// If we need a super-commander, promote a Klingon
-	if (quadx == game.state.isx &amp;&amp; quady == game.state.isy) {
+	if (game.quadx == game.state.isx &amp;&amp; game.quady == game.state.isy) {
 	    game.quad[game.kx[1]][game.ky[1]] = IHS;
-	    game.kpower[1] = 1175.0 + 400.0*Rand() + 125.0*skill;
-	    iscate = game.state.remkl&gt;1;
-	    ishere = 1;
+	    game.kpower[1] = 1175.0 + 400.0*Rand() + 125.0*game.skill;
+	    game.iscate = game.state.remkl&gt;1;
+	    game.ishere = 1;
 	}
     }
     // Put in Romulans if needed
-    for (i = klhere+1; i &lt;= nenhere; i++) {
+    for (i = game.klhere+1; i &lt;= game.nenhere; i++) {
 	dropin(IHR, &amp;ix, &amp;iy);
 	game.kx[i] = ix;
 	game.ky[i] = iy;
-	game.kdist[i] = game.kavgd[i] = sqrt(square(sectx-ix) + square(secty-iy));
-	game.kpower[i] = Rand()*400.0 + 450.0 + 50.0*skill;
+	game.kdist[i] = game.kavgd[i] = sqrt(square(game.sectx-ix) + square(game.secty-iy));
+	game.kpower[i] = Rand()*400.0 + 450.0 + 50.0*game.skill;
     }
     // If quadrant needs a starbase, put it in
-    if (game.state.galaxy[quadx][quady].starbase)
-	dropin(IHB, &amp;basex, &amp;basey);
+    if (game.state.galaxy[game.quadx][game.quady].starbase)
+	dropin(IHB, &amp;game.basex, &amp;game.basey);
 	
     if (nplan) {
 	// If quadrant needs a planet, put it in
-	for (i=0; i &lt; inplan; i++)
-	    if (game.state.plnets[i].x == quadx &amp;&amp; game.state.plnets[i].y == quady) break;
-	if (i &lt; inplan) {
-	    iplnet = i;
-	    dropin(IHP, &amp;plnetx, &amp;plnety);
+	for (i=0; i &lt; game.inplan; i++)
+	    if (game.state.plnets[i].x == game.quadx &amp;&amp; game.state.plnets[i].y == game.quady) break;
+	if (i &lt; game.inplan) {
+	    game.iplnet = i;
+	    dropin(IHP, &amp;game.plnetx, &amp;game.plnety);
 	}
     }
-    // Check for condition
+    // Check for game.condition
     newcnd();
     // And finally the stars
-    for (i = 1; i &lt;= game.state.galaxy[quadx][quady].stars; i++) 
+    for (i = 1; i &lt;= game.state.galaxy[game.quadx][game.quady].stars; i++) 
 	dropin(IHSTAR, &amp;ix, &amp;iy);
 
     // Check for RNZ
-    if (irhere &gt; 0 &amp;&amp; klhere == 0) {
-	neutz = 1;
+    if (game.irhere &gt; 0 &amp;&amp; game.klhere == 0) {
+	game.neutz = 1;
 	if (game.damage[DRADIO] &lt;= 0.0) {
 	    skip(1);
 	    prout(&quot;LT. Uhura- \&quot;Captain, an urgent message.&quot;);
@@ -640,16 +640,16 @@
 
     if (shutup==0) {
 	// Put in THING if needed
-	if (thingx == quadx &amp;&amp; thingy == quady) {
+	if (thingx == game.quadx &amp;&amp; thingy == game.quady) {
 	    dropin(IHQUEST, &amp;ix, &amp;iy);
 	    iran(GALSIZE, &amp;thingx, &amp;thingy);
-	    nenhere++;
+	    game.nenhere++;
 	    iqhere=1;
-	    game.kx[nenhere] = ix;
-	    game.ky[nenhere] = iy;
-	    game.kdist[nenhere] = game.kavgd[nenhere] =
-		sqrt(square(sectx-ix) + square(secty-iy));
-	    game.kpower[nenhere] = Rand()*6000.0 +500.0 +250.0*skill;
+	    game.kx[game.nenhere] = ix;
+	    game.ky[game.nenhere] = iy;
+	    game.kdist[game.nenhere] = game.kavgd[game.nenhere] =
+		sqrt(square(game.sectx-ix) + square(game.secty-iy));
+	    game.kpower[game.nenhere] = Rand()*6000.0 +500.0 +250.0*game.skill;
 	    if (game.damage[DSRSENS] == 0.0) {
 		skip(1);
 		prout(&quot;MR. SPOCK- \&quot;Captain, this is most unusual.&quot;);
@@ -660,25 +660,25 @@
 
     // Decide if quadrant needs a Tholian
     if (game.options &amp; OPTION_THOLIAN) {
-	if ((skill &lt; SKILL_GOOD &amp;&amp; Rand() &lt;= 0.02) ||   /* Lighten up if skill is low */
-	    (skill == SKILL_GOOD &amp;&amp; Rand() &lt;= 0.05) ||
-	    (skill &gt; SKILL_GOOD &amp;&amp; Rand() &lt;= 0.08)
+	if ((game.skill &lt; SKILL_GOOD &amp;&amp; Rand() &lt;= 0.02) ||   /* Lighten up if skill is low */
+	    (game.skill == SKILL_GOOD &amp;&amp; Rand() &lt;= 0.05) ||
+	    (game.skill &gt; SKILL_GOOD &amp;&amp; Rand() &lt;= 0.08)
     #ifdef DEBUG
 	    || strcmp(game.passwd, &quot;tholianx&quot;)==0
     #endif
 	    ) {
 	    do {
-		ithx = Rand() &gt; 0.5 ? QUADSIZE : 1;
-		ithy = Rand() &gt; 0.5 ? QUADSIZE : 1;
-	    } while (game.quad[ithx][ithy] != IHDOT);
-	    game.quad[ithx][ithy] = IHT;
-	    ithere = 1;
-	    nenhere++;
-	    game.kx[nenhere] = ithx;
-	    game.ky[nenhere] = ithy;
-	    game.kdist[nenhere] = game.kavgd[nenhere] =
-		sqrt(square(sectx-ithx) + square(secty-ithy));
-	    game.kpower[nenhere] = Rand()*400.0 +100.0 +25.0*skill;
+		game.ithx = Rand() &gt; 0.5 ? QUADSIZE : 1;
+		game.ithy = Rand() &gt; 0.5 ? QUADSIZE : 1;
+	    } while (game.quad[game.ithx][game.ithy] != IHDOT);
+	    game.quad[game.ithx][game.ithy] = IHT;
+	    game.ithere = 1;
+	    game.nenhere++;
+	    game.kx[game.nenhere] = game.ithx;
+	    game.ky[game.nenhere] = game.ithy;
+	    game.kdist[game.nenhere] = game.kavgd[game.nenhere] =
+		sqrt(square(game.sectx-game.ithx) + square(game.secty-game.ithy));
+	    game.kpower[game.nenhere] = Rand()*400.0 +100.0 +25.0*game.skill;
 	    /* Reserve unocupied corners */
 	    if (game.quad[1][1]==IHDOT) game.quad[1][1] = 'X';
 	    if (game.quad[1][QUADSIZE]==IHDOT) game.quad[1][QUADSIZE] = 'X';
@@ -695,7 +695,7 @@
 	    dropin(IHBLANK, &amp;ix, &amp;iy);
 
     // Take out X's in corners if Tholian present
-    if (ithere) {
+    if (game.ithere) {
 	if (game.quad[1][1]=='X') game.quad[1][1] = IHDOT;
 	if (game.quad[1][QUADSIZE]=='X') game.quad[1][QUADSIZE] = IHDOT;
 	if (game.quad[QUADSIZE][1]=='X') game.quad[QUADSIZE][1] = IHDOT;
@@ -710,11 +710,11 @@
 
     // The author liked bubble sort. So we will use it. :-(
 
-    if (nenhere-iqhere-ithere &lt; 2) return;
+    if (game.nenhere-iqhere-game.ithere &lt; 2) return;
 
     do {
 	sw = FALSE;
-	for (j = 1; j &lt; nenhere; j++)
+	for (j = 1; j &lt; game.nenhere; j++)
 	    if (game.kdist[j] &gt; game.kdist[j+1]) {
 		sw = TRUE;
 		t = game.kdist[j];

Modified: trunk/src/sst.c
===================================================================
--- trunk/src/sst.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/sst.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -375,8 +375,8 @@
 	drawmaps(1);
 	while (TRUE)  { /* get a command */
 	    hitme = FALSE;
-	    justin = 0;
-	    Time = 0.0;
+	    game.justin = 0;
+	    game.optime = 0.0;
 	    i = -1;
 	    chew();
 	    setwnd(prompt_window);
@@ -386,7 +386,7 @@
 		makechart();
 		continue;
 	    }
-	    ididit=0;
+	    game.ididit=0;
 	    clrscr();
 	    setwnd(message_window);
 	    clrscr();
@@ -422,25 +422,25 @@
 	    break;
 	case PHASERS:			// phasers
 	    phasers();
-	    if (ididit) hitme = TRUE;
+	    if (game.ididit) hitme = TRUE;
 	    break;
 	case TORPEDO:			// photons
 	    photon();
-	    if (ididit) hitme = TRUE;
+	    if (game.ididit) hitme = TRUE;
 	    break;
 	case MOVE:			// move
 	    warp(1);
 	    break;
 	case SHIELDS:			// shields
 	    doshield(1);
-	    if (ididit) {
+	    if (game.ididit) {
 		hitme=TRUE;
-		shldchg = 0;
+		game.shldchg = 0;
 	    }
 	    break;
 	case DOCK:			// dock
 	    dock(1);
-	    if (ididit) attack(0);
+	    if (game.ididit) attack(0);
 	    break;
 	case DAMAGES:			// damages
 	    dreprt();
@@ -453,7 +453,7 @@
 	    break;
 	case REST:			// rest
 	    wait();
-	    if (ididit) hitme = TRUE;
+	    if (game.ididit) hitme = TRUE;
 	    break;
 	case WARP:			// warp
 	    setwrp();
@@ -466,22 +466,22 @@
 	    break;
 	case ORBIT:			// orbit
 	    orbit();
-	    if (ididit) hitme = TRUE;
+	    if (game.ididit) hitme = TRUE;
 	    break;
 	case TRANSPORT:			// transport &quot;beam&quot;
 	    beam();
 	    break;
 	case MINE:			// mine
 	    mine();
-	    if (ididit) hitme = TRUE;
+	    if (game.ididit) hitme = TRUE;
 	    break;
 	case CRYSTALS:			// crystals
 	    usecrystals();
-	    if (ididit) hitme = TRUE;
+	    if (game.ididit) hitme = TRUE;
 	    break;
 	case SHUTTLE:			// shuttle
 	    shuttle();
-	    if (ididit) hitme = TRUE;
+	    if (game.ididit) hitme = TRUE;
 	    break;
 	case PLANETS:			// Planet list
 	    preport();
@@ -502,7 +502,7 @@
 	    break;
 	case PROBE:
 	    probe();			// Launch probe
-	    if (ididit) hitme = TRUE;
+	    if (game.ididit) hitme = TRUE;
 	    break;
 	case ABANDON:			// Abandon Ship
 	    abandn();
@@ -513,12 +513,12 @@
 	case SAVE:			// Save Game
 	    freeze(FALSE);
 	    clrscr();
-	    if (skill &gt; SKILL_GOOD)
+	    if (game.skill &gt; SKILL_GOOD)
 		prout(&quot;WARNING--Saved games produce no plaques!&quot;);
 	    break;
 	case DEATHRAY:			// Try a desparation measure
 	    deathray();
-	    if (ididit) hitme = TRUE;
+	    if (game.ididit) hitme = TRUE;
 	    break;
 	case DEBUGCMD:			// What do we want for debug???
 #ifdef DEBUG
@@ -527,12 +527,12 @@
 	    break;
 	case MAYDAY:			// Call for help
 	    help();
-	    if (ididit) hitme = TRUE;
+	    if (game.ididit) hitme = TRUE;
 	    break;
 	case QUIT:
-	    alldone = 1;		// quit the game
+	    game.alldone = 1;		// quit the game
 #ifdef DEBUG
-	    if (idebug) score();
+	    if (game.idebug) score();
 #endif
 	    break;
 	case HELP:
@@ -541,22 +541,22 @@
 	}
 	commandhook(commands[i].name, FALSE);
 	for (;;) {
-	    if (alldone) break;		// Game has ended
+	    if (game.alldone) break;		// Game has ended
 #ifdef DEBUG
-	    if (idebug) prout(&quot;2500&quot;);
+	    if (game.idebug) prout(&quot;2500&quot;);
 #endif
-	    if (Time != 0.0) {
+	    if (game.optime != 0.0) {
 		events();
-		if (alldone) break;	// Events did us in
+		if (game.alldone) break;	// Events did us in
 	    }
-	    if (game.state.galaxy[quadx][quady].supernova) { // Galaxy went Nova!
+	    if (game.state.galaxy[game.quadx][game.quady].supernova) { // Galaxy went Nova!
 		atover(0);
 		continue;
 	    }
-	    if (hitme &amp;&amp; justin==0) {
+	    if (hitme &amp;&amp; game.justin==0) {
 		attack(2);
-		if (alldone) break;
-		if (game.state.galaxy[quadx][quady].supernova) {	// went NOVA! 
+		if (game.alldone) break;
+		if (game.state.galaxy[game.quadx][game.quady].supernova) {	// went NOVA! 
 		    atover(0);
 		    hitme = TRUE;
 		    continue;
@@ -564,7 +564,7 @@
 	    }
 	    break;
 	}
-	if (alldone) break;
+	if (game.alldone) break;
     }
 }
 
@@ -607,16 +607,16 @@
 	clrscr();
 	prelim();
 	setup(line[0] == '\0');
-	if (alldone) {
+	if (game.alldone) {
 	    score();
-	    alldone = 0;
+	    game.alldone = 0;
 	}
 	else makemoves();
 	skip(1);
 	stars();
 	skip(1);
 
-	if (tourn &amp;&amp; alldone) {
+	if (game.tourn &amp;&amp; game.alldone) {
 	    proutn(&quot;Do you want your score recorded?&quot;);
 	    if (ja()) {
 		chew2();
@@ -675,7 +675,7 @@
 void crmshp(void) 
 {
     char *s;
-    switch (ship) {
+    switch (game.ship) {
     case IHE: s = &quot;Enterprise&quot;; break;
     case IHF: s = &quot;Faerie Queene&quot;; break;
     default:  s = &quot;Ship???&quot;; break;
@@ -805,10 +805,10 @@
 {
     proutn(&quot;Reset levels? &quot;);
     if (ja() != 0) {
-	if (energy &lt; inenrg) energy = inenrg;
-	shield = inshld;
-	torps = intorps;
-	lsupres = inlsr;
+	if (energy &lt; game.inenrg) energy = game.inenrg;
+	shield = game.inshld;
+	torps = game.intorps;
+	game.lsupres = game.inlsr;
     }
     proutn(&quot;Reset damage? &quot;);
     if (ja() != 0) {
@@ -817,10 +817,10 @@
 	    if (game.damage[i] &gt; 0.0) 
 		game.damage[i] = 0.0;
     }
-    proutn(&quot;Toggle idebug? &quot;);
+    proutn(&quot;Toggle game.idebug? &quot;);
     if (ja() != 0) {
-	idebug = !idebug;
-	if (idebug) prout(&quot;Debug output ON&quot;);
+	game.idebug = !game.idebug;
+	if (game.idebug) prout(&quot;Debug output ON&quot;);
 	else prout(&quot;Debug output OFF&quot;);
     }
     proutn(&quot;Cause selective damage? &quot;);
@@ -864,7 +864,7 @@
     }
     proutn(&quot;Induce supernova here? &quot;);
     if (ja() != 0) {
-	game.state.galaxy[quadx][quady].supernova = TRUE;
+	game.state.galaxy[game.quadx][game.quady].supernova = TRUE;
 	atover(1);
     }
 }

Modified: trunk/src/sst.h
===================================================================
--- trunk/src/sst.h	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/sst.h	2006-09-14 20:42:27 UTC (rev 561)
@@ -32,7 +32,7 @@
 #define for_quadrants(i)	for (i = 1; i &lt;= GALSIZE; i++)
 #define for_sectors(i)		for (i = 1; i &lt;= QUADSIZE; i++)
 #define for_commanders(i)	for (i = 1; i &lt;= game.state.remcom; i++)
-#define for_local_enemies(i)	for (i = 1; i &lt;= nenhere; i++)
+#define for_local_enemies(i)	for (i = 1; i &lt;= game.nenhere; i++)
 #define for_starbases(i)	for (i = 1; i &lt;= game.state.rembase; i++)
 
 typedef struct {
@@ -79,12 +79,12 @@
     } chart[GALSIZE+1][GALSIZE+1]; 	// the starchart (subscript 0 not used)
 } snapshot;				// Data that is snapshot
 
-#define NKILLK (inkling - game.state.remkl)
-#define NKILLC (incom - game.state.remcom)
-#define NKILLSC (inscom - game.state.nscrem)
-#define NKILLROM (inrom - game.state.nromrem)
+#define NKILLK (game.inkling - game.state.remkl)
+#define NKILLC (game.incom - game.state.remcom)
+#define NKILLSC (game.inscom - game.state.nscrem)
+#define NKILLROM (game.inrom - game.state.nromrem)
 #define KLINGREM (game.state.remkl + game.state.remcom + game.state.nscrem)
-#define INKLINGTOT (inkling + incom + inscom)
+#define INKLINGTOT (game.inkling + game.incom + game.inscom)
 #define KLINGKILLED (INKLINGTOT - KLINGREM)
 
 #define SKILL_NONE	0
@@ -167,186 +167,97 @@
     char passwd[10];		// Self Destruct password
     int kx[(QUADSIZE+1)*(QUADSIZE+1)];			// enemy sector locations
     int ky[(QUADSIZE+1)*(QUADSIZE+1)];
-    /* members with macro definitions start here */
-    int inkling,
-	inbase,
-	incom,
-	inscom,
-	inrom,
-	instar,
-	intorps,
-	condit,
-	torps,
-	ship,
-	quadx,
-	quady,
-	sectx,
-	secty,
-	length,
-	skill,
-	basex,
-	basey,
-	klhere,
-	comhere,
-	casual,
-	nhelp,
-	nkinks,
-	ididit,
-	gamewon,
-	alive,
-	justin,
-	alldone,
-	shldchg,
-	plnetx,
-	plnety,
-	inorbit,
-	landed,
-	iplnet,
-	imine,
-	inplan,
-	nenhere,
-	ishere,
-	neutz,
-	irhere,
-	icraft,
-	ientesc,
-	iscraft,
-	isatb,
-	iscate,
+    int inkling,	// Initial number of klingons
+	inbase,		// Initial number of bases
+	incom,		// Initial number of commanders
+	inscom,		// Initial number of commanders
+	inrom,		// Initial number of commanders
+	instar,		// Initial stars
+	intorps,	// Initial/Max torpedoes
+	condit,		// Condition (red/yellow/green/docked)
+	torps,		// number of torpedoes
+	ship,		// Ship type -- 'E' is Enterprise
+	quadx,		// where we are
+	quady,		//
+	sectx,		// where we are
+	secty,		//
+	length,		// length of game
+	skill,		// skill level
+	basex,		// position of base in current quadrant
+	basey,		//
+	klhere,		// klingons here
+	comhere,	// commanders here
+	casual,		// causalties
+	nhelp,		// calls for help
+	nkinks,		// count of energy-barrier crossings
+	ididit,		// Action taken -- allows enemy to attack
+	gamewon,	// Finished!
+	alive,		// We are alive (not killed)
+	justin,		// just entered quadrant
+	alldone,	// game is now finished
+	shldchg,	// shield is changing (affects efficiency)
+	plnetx,		// location of planet in quadrant
+	plnety,		//
+	inorbit,	// orbiting
+	landed,		// party on planet (1), on ship (-1)
+	iplnet,		// planet # in quadrant
+	imine,		// mining
+	inplan,		// initial planets
+	nenhere,	// number of enemies in quadrant
+	ishere,		// super-commander in quandrant
+	neutz,		// Romulan Neutral Zone
+	irhere,		// Romulans in quadrant
+	icraft,		// Kirk in Galileo
+	ientesc,	// attempted escape from supercommander
+	iscraft,	// =1 if craft on ship, -1 if removed from game
+	isatb,		// =1 if super commander is attacking base
+	iscate,		// super commander is here
 #ifdef DEBUG
-	idebug,
+	idebug,		// debug mode
 #endif
-	iattak,
-	icrystl,
-	tourn,
-	thawed,
-	batx,
-	baty,
-	ithere,
-	ithx,
-	ithy,
-	iseenit,
-	probecx,
-	probecy,
-	proben,
-	isarmed,
-	nprobes;
-    double inresor,
-	intime,
-	inenrg,
-	inshld,
-	inlsr,
-	indate,
-	energy,
-	shield,
-	shldup,
-	warpfac,
-	wfacsq,
-	lsupres,
-	dist,
-	direc,
-	Time,
-	docfac,
-	resting,
-	damfac,
-	lastchart,
-	cryprob,
-	probex,
-	probey,
-	probeinx,
-	probeiny,
-	height;
+	iattak,		// attack recursion elimination (was cracks[4])
+	icrystl,	// dilithium crystals aboard
+	tourn,		// tournament number
+	thawed,		// thawed game
+	batx,		// base coordinates being attacked
+	baty,		//
+	ithere,		// Tholian is here 
+	ithx,		// coordinates of Tholian
+	ithy,		//
+	iseenit,	// seen base attack report
+	probecx,	// current probe quadrant
+	probecy,	//
+	proben,		// number of moves for probe
+	isarmed,	// probe is armed
+	nprobes;	// number of probes available
+    double inresor,	// initial resources
+	intime,		// initial time
+	inenrg,		// initial/max energy
+	inshld,		// initial/max shield
+	inlsr,		// initial life support resources
+	indate,		// initial date
+	energy,		// energy level
+	shield,		// shield level
+	shldup,		// shields are up
+	warpfac,	// warp speed
+	wfacsq,		// squared warp factor
+	lsupres,	// life support reserves
+	dist,		// movement distance
+	direc,		// movement direction
+	optime,		// time taken by current operation
+	docfac,		// repair factor when docking (constant?)
+	resting,	// rest time
+	damfac,		// damage factor
+	lastchart,	// time star chart was last updated
+	cryprob,	// probability that crystal will work
+	probex,		// location of probe
+	probey,		//
+	probeinx,	// probe x,y increment
+	probeiny,	//
+	height;		// height of orbit around planet
 };
 extern struct game game;
 
-#define inkling game.inkling		// Initial number of klingons
-#define inbase game.inbase		// Initial number of bases
-#define incom game.incom		// Initian number of commanders
-#define inscom game.inscom		// Initian number of commanders
-#define inrom game.inrom		// Initian number of commanders
-#define instar game.instar		// Initial stars
-#define intorps game.intorps		// Initial/Max torpedoes
-#define condit game.condit		// Condition (red/yellow/green/docked)
-#define torps game.torps		// number of torpedoes
-#define ship game.ship			// Ship type -- 'E' is Enterprise
-#define quadx game.quadx		// where we are
-#define quady game.quady		//
-#define sectx game.sectx		// where we are
-#define secty game.secty		//
-#define length game.length		// length of game
-#define skill game.skill		// skill level
-#define basex game.basex		// position of base in current quad
-#define basey game.basey		//
-#define klhere game.klhere		// klingons here
-#define comhere game.comhere		// commanders here
-#define casual game.casual		// causalties
-#define nhelp game.nhelp		// calls for help
-#define nkinks game.nkinks		//
-#define ididit game.ididit		// Action taken -- allows enemy to attack
-#define gamewon game.gamewon		// Finished!
-#define alive game.alive		// We are alive (not killed)
-#define justin game.justin		// just entered quadrant
-#define alldone game.alldone		// game is now finished
-#define shldchg game.shldchg		// shield is changing (affects efficiency)
-#define plnetx game.plnetx		// location of planet in quadrant
-#define plnety game.plnety		//
-#define inorbit game.inorbit		// orbiting
-#define landed game.landed		// party on planet (1), on ship (-1)
-#define iplnet game.iplnet		// planet # in quadrant
-#define imine game.imine		// mining
-#define inplan game.inplan		// initial planets
-#define nenhere game.nenhere		// Number of enemies in quadrant
-#define ishere game.ishere		// Super-commander in quandrant
-#define neutz game.neutz		// Romulan Neutral Zone
-#define irhere game.irhere		// Romulans in quadrant
-#define icraft game.icraft		// Kirk in Galileo
-#define ientesc game.ientesc		// Attempted escape from supercommander
-#define iscraft game.iscraft		// =1 if craft on ship, -1 if removed from game
-#define isatb game.isatb		// =1 if SuperCommander is attacking base
-#define iscate game.iscate		// Super Commander is here
-#ifdef DEBUG
-#define idebug game.idebug		// Debug mode
-#endif
-#define iattak game.iattak		// attack recursion elimination (was cracks[4])
-#define icrystl game.icrystl		// dilithium crystals aboard
-#define tourn game.tourn		// Tournament number
-#define thawed game.thawed		// Thawed game
-#define batx game.batx			// Base coordinates being attacked
-#define baty game.baty			//
-#define ithere game.ithere		// Tholean is here 
-#define ithx game.ithx			// coordinates of tholean
-#define ithy game.ithy
-#define iseenit game.iseenit		// Seen base attack report
-#define inresor game.inresor		// initial resources
-#define intime game.intime		// initial time
-#define inenrg game.inenrg		// Initial/Max Energy
-#define inshld game.inshld		// Initial/Max Shield
-#define inlsr game.inlsr		// initial life support resources
-#define indate game.indate		// Initial date
-#define energy game.energy		// Energy level
-#define shield game.shield		// Shield level
-#define shldup game.shldup		// Shields are up
-#define warpfac game.warpfac		// Warp speed
-#define wfacsq game.wfacsq		// squared warp factor
-#define lsupres game.lsupres		// life support reserves
-#define dist game.dist			// movement distance
-#define direc game.direc		// movement direction
-#define Time game.Time			// time taken by current operation
-#define docfac game.docfac		// repair factor when docking (constant?)
-#define resting game.resting		// rest time
-#define damfac game.damfac		// damage factor
-#define lastchart game.lastchart	// time star chart was last updated
-#define cryprob game.cryprob		// probability that crystal will work
-#define probex game.probex		// location of probe
-#define probey game.probey
-#define probecx game.probecx		// current probe quadrant
-#define probecy game.probecy	
-#define probeinx game.probeinx		// Probe x,y increment
-#define probeiny game.probeiny		
-#define proben game.proben		// number of moves for probe
-#define isarmed game.isarmed		// Probe is armed
-#define nprobes game.nprobes		// number of probes available
-
 /* the following global state doesn't need to be saved */
 extern char *device[NDEVICES];
 extern int iscore, iskill; // Common PLAQ

Modified: trunk/src/xio.c
===================================================================
--- trunk/src/xio.c	2006-09-14 18:25:06 UTC (rev 560)
+++ trunk/src/xio.c	2006-09-14 20:42:27 UTC (rev 561)
@@ -8,8 +8,6 @@
 #include &lt;X11/Xaw/AsciiText.h&gt;
 #include &quot;sst.h&quot;
 
-#undef length	/* ugh -- must get rid of ugly #defines */
-
 static XtAppContext app_context;
 static Widget toplevel, text, form; 
 static Widget navigation, weapons, planets, misc; 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000027.html">[Sst-commit-watch] r560 - trunk/src
</A></li>
	<LI>Next message: <A HREF="000028.html">[Sst-commit-watch] r562 - trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#29">[ date ]</a>
              <a href="thread.html#29">[ thread ]</a>
              <a href="subject.html#29">[ subject ]</a>
              <a href="author.html#29">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/sst-commit-watch">More information about the Sst-commit-watch
mailing list</a><br>
</body></html>
