<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Sst-commit-watch] r784 - in trunk: po src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/sst-commit-watch/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:sst-commit-watch%40lists.berlios.de?Subject=Re%3A%20%5BSst-commit-watch%5D%20r784%20-%20in%20trunk%3A%20po%20src&In-Reply-To=%3C200803141444.m2EEiAAH015119%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Sst-commit-watch] r784 - in trunk: po src</H1>
    <B>stsp at BerliOS</B> 
    <A HREF="mailto:sst-commit-watch%40lists.berlios.de?Subject=Re%3A%20%5BSst-commit-watch%5D%20r784%20-%20in%20trunk%3A%20po%20src&In-Reply-To=%3C200803141444.m2EEiAAH015119%40sheep.berlios.de%3E"
       TITLE="[Sst-commit-watch] r784 - in trunk: po src">stsp at mail.berlios.de
       </A><BR>
    <I>Fri Mar 14 15:44:10 CET 2008</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#251">[ date ]</a>
              <a href="thread.html#251">[ thread ]</a>
              <a href="subject.html#251">[ subject ]</a>
              <a href="author.html#251">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: stsp
Date: 2008-03-14 15:44:09 +0100 (Fri, 14 Mar 2008)
New Revision: 784

Modified:
   trunk/po/ru.po
   trunk/src/finish.c
   trunk/src/setup.c
   trunk/src/sst.py
Log:
- Update translation
- Fix score calculation for romulans and worlds
- Rewrite the score calculation of C version


Modified: trunk/po/ru.po
===================================================================
--- trunk/po/ru.po	2007-12-14 00:15:51 UTC (rev 783)
+++ trunk/po/ru.po	2008-03-14 14:44:09 UTC (rev 784)
@@ -11,7 +11,7 @@
 msgstr &quot;&quot;
 &quot;Project-Id-Version: sst 2.0\n&quot;
 &quot;Report-Msgid-Bugs-To: stsp\n&quot;
-&quot;POT-Creation-Date: 2006-10-23 21:47+0400\n&quot;
+&quot;POT-Creation-Date: 2008-03-13 10:49+0300\n&quot;
 &quot;PO-Revision-Date: 2006-09-15 11:01+0400\n&quot;
 &quot;Last-Translator: Stas Sergeev &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/sst-commit-watch">stsp at aknet.ru</A>&gt;\n&quot;
 &quot;Language-Team: Russian &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/sst-commit-watch">ru at li.org</A>&gt;\n&quot;
@@ -590,7 +590,7 @@
 #: src/sst.py:1974
 #, python-format
 msgid &quot; is pulled to Quadrant %s, Sector %s&quot;
-msgstr &quot;&quot;
+msgstr &quot; &#1079;&#1072;&#1090;&#1103;&#1085;&#1091;&#1090; &#1074; &#1050;&#1074;&#1072;&#1076;&#1088;&#1072;&#1085;&#1090; %s, &#1057;&#1077;&#1082;&#1090;&#1086;&#1088; %s&quot;
 
 #: src/sst.py:1977
 msgid &quot;(Remainder of rest/repair period cancelled.)&quot;
@@ -868,7 +868,7 @@
 
 #: src/sst.py:2737
 msgid &quot;  YOUR-SKILL-HAS-EXCEEDED-THE-CAPACITY-OF-THIS-PROGRAM&quot;
-msgstr &quot;  &#1042;&#1040;&#1064;&#1045;-&#1052;&#1040;&#1057;&#1058;&#1045;&#1056;&#1057;&#1058;&#1042;&#1054;-&#1053;&#1045;&#1055;&#1054;&#1044;&#1042;&#1051;&#1040;&#1057;&#1058;&#1053;&#1054;-&#1069;&#1058;&#1054;&#1049;-&#1055;&#1056;&#1054;&#1043;&#1056;&#1040;&#1052;&#1052;&#1045;&quot;
+msgstr &quot;  &#1042;&#1040;&#1064;&#1045;-&#1052;&#1040;&#1057;&#1058;&#1045;&#1056;&#1057;&#1058;&#1042;&#1054;-&#1042;&#1067;&#1064;&#1051;&#1054;-&#1047;&#1040;-&#1056;&#1040;&#1052;&#1050;&#1048;-&#1042;&#1054;&#1047;&#1052;&#1054;&#1046;&#1053;&#1054;&#1057;&#1058;&#1045;&#1049;-&#1055;&#1056;&#1054;&#1043;&#1056;&#1040;&#1052;&#1052;&#1067;&quot;
 
 #: src/sst.py:2739 src/sst.py:2741 src/sst.py:2743
 msgid &quot;  THIS-PROGRAM-MUST-SURVIVE&quot;
@@ -3037,11 +3037,11 @@
 #: src/sst.py:5379
 #, python-format
 msgid &quot;You have an initial allotment of %d stardates to complete&quot;
-msgstr &quot;&#1059; &#1074;&#1072;&#1089; &#1077;&#1089;&#1090;&#1100; %d &#1076;&#1085;&#1077;&#1081; &#1095;&#1090;&#1086;&#1073;&#1099; &#1079;&#1072;&#1074;&#1077;&#1088;&#1096;&#1080;&#1090;&#1100;&quot;
+msgstr &quot;&#1059; &#1074;&#1072;&#1089; &#1077;&#1089;&#1090;&#1100; %d &#1076;&#1085;&#1077;&#1081; &#1095;&#1090;&#1086;&#1073;&#1099; &#1074;&#1099;&#1087;&#1086;&#1083;&#1085;&#1080;&#1090;&#1100;&quot;
 
 #: src/sst.py:5380
 msgid &quot;your mission.  As you proceed you may be given more time.&quot;
-msgstr &quot;&#1101;&#1090;&#1091; &#1084;&#1080;&#1089;&#1089;&#1080;&#1102;.  &#1055;&#1086; &#1093;&#1086;&#1076;&#1091; &#1076;&#1077;&#1083;&#1072; &#1074;&#1072;&#1084; &#1084;&#1086;&#1075;&#1091;&#1090; &#1076;&#1072;&#1090;&#1100; &#1077;&#1097;&#1105; &#1074;&#1088;&#1077;&#1084;&#1077;&#1085;&#1080;.&quot;
+msgstr &quot;&#1101;&#1090;&#1091; &#1084;&#1080;&#1089;&#1089;&#1080;&#1102;.  &#1055;&#1086; &#1093;&#1086;&#1076;&#1091; &#1076;&#1077;&#1083;&#1072; &#1074;&#1072;&#1084; &#1084;&#1086;&#1075;&#1091;&#1090; &#1076;&#1072;&#1090;&#1100; &#1077;&#1097;&#1105; &#1074;&#1088;&#1077;&#1084;&#1103;.&quot;
 
 #: src/sst.py:5382
 #, python-format
@@ -3125,8 +3125,8 @@
 &quot;&#1042;&#1099; &#1085;&#1086;&#1074;&#1080;&#1095;&#1105;&#1082; (n), &#1089;&#1088;&#1077;&#1076;&#1085;&#1080;&#1081; (f), &#1091;&#1084;&#1077;&#1083;&#1099;&#1081; (g), &#1089;&#1087;&#1077;&#1094;&#1080;&#1072;&#1083;&#1080;&#1089;&#1090; (e), &#1080;&#1083;&#1080; &#1054;&#1090;&#1089;&#1090;&#1072;&#1074;&#1085;&#1086;&#1081; (em)? &quot;
 
 #: src/sst.py:5476
-msgid &quot;Choose your game style (or just press enter): &quot;
-msgstr &quot;&#1042;&#1099;&#1073;&#1077;&#1088;&#1080;&#1090;&#1077; &#1089;&#1090;&#1080;&#1090;&#1100; &#1080;&#1075;&#1088;&#1099; (&#1080;&#1083;&#1080; &#1085;&#1072;&#1078;&#1084;&#1080;&#1090;&#1077; &#1074;&#1074;&#1086;&#1076;): &quot;
+msgid &quot;Choose your game style (plain, almy, fancy or just press enter): &quot;
+msgstr &quot;&#1042;&#1099;&#1073;&#1077;&#1088;&#1080;&#1090;&#1077; &#1089;&#1090;&#1080;&#1083;&#1100; &#1080;&#1075;&#1088;&#1099; (plain, almy, fancy &#1080;&#1083;&#1080; &#1085;&#1072;&#1078;&#1084;&#1080;&#1090;&#1077; &#1074;&#1074;&#1086;&#1076;): &quot;
 
 #: src/sst.py:5596
 msgid &quot;LT. Uhura- \&quot;Captain, an urgent message.&quot;
@@ -3174,7 +3174,7 @@
 
 #: src/sst.py:5749
 msgid &quot; and put it in the&quot;
-msgstr &quot;&#1080; &#1087;&#1086;&#1084;&#1077;&#1089;&#1090;&#1080;&#1090;&#1100; &#1077;&#1075;&#1086; &#1074;&quot;
+msgstr &quot; &#1080; &#1087;&#1086;&#1084;&#1077;&#1089;&#1090;&#1080;&#1090;&#1100; &#1077;&#1075;&#1086; &#1074;&quot;
 
 #: src/sst.py:5750
 msgid &quot;   current directory or to &quot;

Modified: trunk/src/finish.c
===================================================================
--- trunk/src/finish.c	2007-12-14 00:15:51 UTC (rev 783)
+++ trunk/src/finish.c	2008-03-14 14:44:09 UTC (rev 784)
@@ -328,17 +328,37 @@
     score();
 }
 
+static void score_item(const char *str, int num, int score)
+{
+    if (num) {
+	prout(str, num, score);
+	iscore += score;
+    }
+}
+
+static void score_item1(const char *str, int score)
+{
+    prout(str, score);
+    iscore += score;
+}
+
+static void score_itemf(const char *str, float num, int score)
+{
+    if (num &gt; 0) {
+	prout(str, num, score);
+	iscore += score;
+    }
+}
+
 void score(void) 
 /* compute player's score */
 {
     double timused = game.state.date - game.indate;
-    int ithperd, iwon, klship;
+    int iwon, klship, num;
 
     iskill = game.skill;
     if ((timused == 0 || (game.state.remkl + game.state.remcom + game.state.nscrem) != 0) &amp;&amp; timused &lt; 5.0)
 	timused = 5.0;
-    perdate = ((game.inkling + game.incom + game.inscom) - (game.state.remkl + game.state.remcom + game.state.nscrem))/timused;
-    ithperd = 500*perdate + 0.5;
     iwon = 0;
     if (game.gamewon)
 	iwon = 100*game.skill;
@@ -348,59 +368,43 @@
 	klship = 1;
     else
 	klship = 2;
-    if (!game.gamewon)
-	game.state.nromrem = 0; // None captured if no win
-    iscore = 10*(game.inkling - game.state.remkl) + 50*(game.incom - game.state.remcom) + ithperd + iwon
-	- 100*game.state.basekl - 100*klship - 45*game.nhelp -5*game.state.starkl - game.casual
-	+ 20*(game.inrom - game.state.nromrem) + 200*(game.inscom - game.state.nscrem) - 10*game.state.nplankl - 300*game.state.nworldkl + game.state.nromrem;
-    if (!game.alive)
-	iscore -= 200;
+    iscore = 0;
     skip(2);
     prout(_(&quot;Your score --&quot;));
-    if (game.inrom - game.state.nromrem)
-	prout(_(&quot;%6d Romulans destroyed                 %5d&quot;),
-	      game.inrom - game.state.nromrem, 20*(game.inrom - game.state.nromrem));
-    if (game.state.nromrem)
-	prout(_(&quot;%6d Romulans captured                  %5d&quot;),
+    num = game.inrom - game.state.nromrem;
+    score_item(_(&quot;%6d Romulans destroyed                 %5d&quot;), num, 20 * num);
+    if (game.gamewon)
+	score_item(_(&quot;%6d Romulans captured                  %5d&quot;),
 	      game.state.nromrem, game.state.nromrem);
-    if (game.inkling - game.state.remkl)
-	prout(_(&quot;%6d ordinary Klingons destroyed        %5d&quot;),
-	      game.inkling - game.state.remkl, 10*(game.inkling - game.state.remkl));
-    if (game.incom - game.state.remcom)
-	prout(_(&quot;%6d Klingon commanders destroyed       %5d&quot;),
-	      game.incom - game.state.remcom, 50*(game.incom - game.state.remcom));
-    if (game.inscom - game.state.nscrem)
-	prout(_(&quot;%6d Super-Commander destroyed          %5d&quot;),
-	      game.inscom - game.state.nscrem, 200*(game.inscom - game.state.nscrem));
-    if (ithperd)
-	prout(_(&quot;%6.2f Klingons per stardate              %5d&quot;),
-	      perdate, ithperd);
-    if (game.state.starkl)
-	prout(_(&quot;%6d stars destroyed by your action     %5d&quot;),
-	      game.state.starkl, -5*game.state.starkl);
-    if (game.state.nplankl)
-	prout(_(&quot;%6d planets destroyed by your action   %5d&quot;),
-	      game.state.nplankl, -10*game.state.nplankl);
-    if ((game.options &amp; OPTION_WORLDS) &amp;&amp; game.state.nworldkl)
-	prout(_(&quot;%6d inhabited planets destroyed by your action   %5d&quot;),
-	      game.state.nplankl, -300*game.state.nworldkl);
-    if (game.state.basekl)
-	prout(_(&quot;%6d bases destroyed by your action     %5d&quot;),
-	      game.state.basekl, -100*game.state.basekl);
-    if (game.nhelp)
-	prout(_(&quot;%6d calls for help from starbase       %5d&quot;),
-	      game.nhelp, -45*game.nhelp);
-    if (game.casual)
-	prout(_(&quot;%6d casualties incurred                %5d&quot;),
-	      game.casual, -game.casual);
-    if (game.abandoned)
-	prout(_(&quot;%6d crew abandoned in space            %5d&quot;),
-	      game.abandoned, -3*game.abandoned);
-    if (klship)
-	prout(_(&quot;%6d ship(s) lost or destroyed          %5d&quot;),
-	      klship, -100*klship);
+    num = game.inkling - game.state.remkl;
+    score_item(_(&quot;%6d ordinary Klingons destroyed        %5d&quot;), num, 10 * num);
+    num = game.incom - game.state.remcom;
+    score_item(_(&quot;%6d Klingon commanders destroyed       %5d&quot;), num, 50 * num);
+    num = game.inscom - game.state.nscrem;
+    score_item(_(&quot;%6d Super-Commander destroyed          %5d&quot;), num, 200 * num);
+    perdate = ((game.inkling + game.incom + game.inscom) -
+	    (game.state.remkl + game.state.remcom + game.state.nscrem))/timused;
+    score_itemf(_(&quot;%6.2f Klingons per stardate              %5d&quot;), perdate,
+	    500 * perdate + 0.5);
+    score_item(_(&quot;%6d stars destroyed by your action     %5d&quot;),
+	    game.state.starkl, -5*game.state.starkl);
+    score_item(_(&quot;%6d planets destroyed by your action   %5d&quot;),
+	    game.state.nplankl, -10*game.state.nplankl);
+    if (game.options &amp; OPTION_WORLDS)
+	score_item(_(&quot;%6d inhabited planets destroyed by your action   %5d&quot;),
+		game.state.nworldkl, -300*game.state.nworldkl);
+    score_item(_(&quot;%6d bases destroyed by your action     %5d&quot;),
+	    game.state.basekl, -100*game.state.basekl);
+    score_item(_(&quot;%6d calls for help from starbase       %5d&quot;),
+	    game.nhelp, -45*game.nhelp);
+    score_item(_(&quot;%6d casualties incurred                %5d&quot;),
+	    game.casual, -game.casual);
+    score_item(_(&quot;%6d crew abandoned in space            %5d&quot;),
+	    game.abandoned, -3*game.abandoned);
+    score_item(_(&quot;%6d ship(s) lost or destroyed          %5d&quot;),
+	    klship, -100*klship);
     if (!game.alive)
-	prout(_(&quot;Penalty for getting yourself killed        -200&quot;));
+	score_item1(_(&quot;Penalty for getting yourself killed        %5d&quot;), -200);
     if (game.gamewon) {
 	proutn(_(&quot;Bonus for winning &quot;));
 	switch (game.skill) {

Modified: trunk/src/setup.c
===================================================================
--- trunk/src/setup.c	2007-12-14 00:15:51 UTC (rev 783)
+++ trunk/src/setup.c	2008-03-14 14:44:09 UTC (rev 784)
@@ -495,7 +495,7 @@
     // Choose game options -- added by ESR for SST2K
     if (scan() != IHALPHA) {
 	chew();
-	proutn(_(&quot;Choose your game style (or just press enter): &quot;));
+	proutn(_(&quot;Choose your game style (plain, almy, fancy or just press enter): &quot;));
 	scan();
     }
     if (isit(&quot;plain&quot;)) {

Modified: trunk/src/sst.py
===================================================================
--- trunk/src/sst.py	2007-12-14 00:15:51 UTC (rev 783)
+++ trunk/src/sst.py	2008-03-14 14:44:09 UTC (rev 784)
@@ -2904,8 +2904,6 @@
 	klship = 1
     else:
 	klship = 2
-    if not game.gamewon:
-	game.state.nromrem = 0 # None captured if no win
     iscore = 10*(game.inkling - game.state.remkl) \
              + 50*(game.incom - len(game.state.kcmdr)) \
              + ithperd + iwon \
@@ -2920,7 +2918,7 @@
     if game.inrom - game.state.nromrem:
 	prout(_(&quot;%6d Romulans destroyed                 %5d&quot;) %
 	      (game.inrom - game.state.nromrem, 20*(game.inrom - game.state.nromrem)))
-    if game.state.nromrem:
+    if game.state.nromrem and game.gamewon:
 	prout(_(&quot;%6d Romulans captured                  %5d&quot;) %
 	      (game.state.nromrem, game.state.nromrem))
     if game.inkling - game.state.remkl:
@@ -2943,7 +2941,7 @@
 	      (game.state.nplankl, -10*game.state.nplankl))
     if (game.options &amp; OPTION_WORLDS) and game.state.nworldkl:
 	prout(_(&quot;%6d inhabited planets destroyed by your action   %5d&quot;) %
-	      (game.state.nplankl, -300*game.state.nworldkl))
+	      (game.state.nworldkl, -300*game.state.nworldkl))
     if game.state.basekl:
 	prout(_(&quot;%6d bases destroyed by your action     %5d&quot;) %
 	      (game.state.basekl, -100*game.state.basekl))
@@ -5473,7 +5471,7 @@
     # Choose game options -- added by ESR for SST2K
     if scanner.next() != &quot;IHALPHA&quot;:
 	scanner.chew()
-	proutn(_(&quot;Choose your game style (or just press enter): &quot;))
+	proutn(_(&quot;Choose your game style (plain, almy, fancy or just press enter): &quot;))
 	scanner.next()
     if scanner.sees(&quot;plain&quot;):
 	# Approximates the UT FORTRAN version.


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#251">[ date ]</a>
              <a href="thread.html#251">[ thread ]</a>
              <a href="subject.html#251">[ subject ]</a>
              <a href="author.html#251">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/sst-commit-watch">More information about the Sst-commit-watch
mailing list</a><br>
</body></html>
